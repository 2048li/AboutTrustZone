<!DOCTYPE html>
<html class='v2' dir='ltr'>
<head>
<link href='https://www.blogger.com/static/v1/widgets/2437439463-css_bundle_v2.css' rel='stylesheet' type='text/css'/>
<meta content='width=1100' name='viewport'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<meta content='blogger' name='generator'/>
<link href='https://bits-please.blogspot.it/favicon.ico' rel='icon' type='image/x-icon'/>
<link href='http://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="Bits, Please! - Atom" href="https://bits-please.blogspot.com/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Bits, Please! - RSS" href="https://bits-please.blogspot.com/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Bits, Please! - Atom" href="https://www.blogger.com/feeds/2029700426505953971/posts/default" />

<link rel="alternate" type="application/atom+xml" title="Bits, Please! - Atom" href="https://bits-please.blogspot.com/feeds/4923895734931327947/comments/default" />
<!--[if IE]><script type="text/javascript" src="https://www.blogger.com/static/v1/jsbin/3061962209-ieretrofit.js"></script>
<![endif]-->
<link href='https://3.bp.blogspot.com/-lDwYrS4KH4Y/V2R6l3cEkxI/AAAAAAAAEDY/wdtH87j5vtgxeFzGIVi81iIh0xFgUEx4QCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B01%253A29%253A24.png' rel='image_src'/>
<meta content='http://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html' property='og:url'/>
<meta content='Extracting Qualcomm&#39;s KeyMaster Keys - Breaking Android Full Disk Encryption' property='og:title'/>
<meta content='A security blog focusing on Android, the Linux Kernel and everything nice.' property='og:description'/>
<meta content='https://3.bp.blogspot.com/-lDwYrS4KH4Y/V2R6l3cEkxI/AAAAAAAAEDY/wdtH87j5vtgxeFzGIVi81iIh0xFgUEx4QCLcB/w1200-h630-p-k-no-nu/Screenshot%2Bfrom%2B2016-06-18%2B01%253A29%253A24.png' property='og:image'/>
<!--[if IE]> <script> (function() { var html5 = ("abbr,article,aside,audio,canvas,datalist,details," + "figure,footer,header,hgroup,mark,menu,meter,nav,output," + "progress,section,time,video").split(','); for (var i = 0; i < html5.length; i++) { document.createElement(html5[i]); } try { document.execCommand('BackgroundImageCache', false, true); } catch(e) {} })(); </script> <![endif]-->
<title>Bits, Please!: Extracting Qualcomm's KeyMaster Keys - Breaking Android Full Disk Encryption</title>
<style id='page-skin-1' type='text/css'><!--
/*-----------------------------------------------
Blogger Template Style
Name:     Picture Window
Designer: Blogger
URL:      www.blogger.com
----------------------------------------------- */

/* Content
----------------------------------------------- */
body {
font: normal normal 15px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #333333;
background: #dddddd url(//themes.googleusercontent.com/image?id=1fupio4xM9eVxyr-k5QC5RiCJlYR35r9dXsp63RKsKt64v33poi2MvnjkX_1MULBY8BsT) repeat-x fixed bottom center;
}
html body .region-inner {
min-width: 0;
max-width: 100%;
width: auto;
}
.content-outer {
font-size: 90%;
}
a:link {
text-decoration:none;
color: #992211;
}
a:visited {
text-decoration:none;
color: #771100;
}
a:hover {
text-decoration:underline;
color: #cc4411;
}
.content-outer {
background: transparent url(//www.blogblog.com/1kt/transparent/white80.png) repeat scroll top left;
-moz-border-radius: 15px;
-webkit-border-radius: 15px;
-goog-ms-border-radius: 15px;
border-radius: 15px;
-moz-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
box-shadow: 0 0 3px rgba(0, 0, 0, .15);
margin: 30px auto;
}
.content-inner {
padding: 15px;
}
/* Header
----------------------------------------------- */
.header-outer {
background: #992211 url(//www.blogblog.com/1kt/transparent/header_gradient_shade.png) repeat-x scroll top left;
_background-image: none;
color: #ffffff;
-moz-border-radius: 10px;
-webkit-border-radius: 10px;
-goog-ms-border-radius: 10px;
border-radius: 10px;
}
.Header img, .Header #header-inner {
-moz-border-radius: 10px;
-webkit-border-radius: 10px;
-goog-ms-border-radius: 10px;
border-radius: 10px;
}
.header-inner .Header .titlewrapper,
.header-inner .Header .descriptionwrapper {
padding-left: 30px;
padding-right: 30px;
}
.Header h1 {
font: normal normal 36px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
}
.Header h1 a {
color: #ffffff;
}
.Header .description {
font-size: 130%;
}
/* Tabs
----------------------------------------------- */
.tabs-inner {
margin: .5em 0 0;
padding: 0;
}
.tabs-inner .section {
margin: 0;
}
.tabs-inner .widget ul {
padding: 0;
background: #f5f5f5 url(//www.blogblog.com/1kt/transparent/tabs_gradient_shade.png) repeat scroll bottom;
-moz-border-radius: 10px;
-webkit-border-radius: 10px;
-goog-ms-border-radius: 10px;
border-radius: 10px;
}
.tabs-inner .widget li {
border: none;
}
.tabs-inner .widget li a {
display: inline-block;
padding: .5em 1em;
margin-right: 0;
color: #992211;
font: normal normal 15px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
-moz-border-radius: 0 0 0 0;
-webkit-border-top-left-radius: 0;
-webkit-border-top-right-radius: 0;
-goog-ms-border-radius: 0 0 0 0;
border-radius: 0 0 0 0;
background: transparent none no-repeat scroll top left;
border-right: 1px solid #cccccc;
}
.tabs-inner .widget li:first-child a {
padding-left: 1.25em;
-moz-border-radius-topleft: 10px;
-moz-border-radius-bottomleft: 10px;
-webkit-border-top-left-radius: 10px;
-webkit-border-bottom-left-radius: 10px;
-goog-ms-border-top-left-radius: 10px;
-goog-ms-border-bottom-left-radius: 10px;
border-top-left-radius: 10px;
border-bottom-left-radius: 10px;
}
.tabs-inner .widget li.selected a,
.tabs-inner .widget li a:hover {
position: relative;
z-index: 1;
background: #ffffff url(//www.blogblog.com/1kt/transparent/tabs_gradient_shade.png) repeat scroll bottom;
color: #000000;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
box-shadow: 0 0 0 rgba(0, 0, 0, .15);
}
/* Headings
----------------------------------------------- */
h2 {
font: bold normal 13px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
text-transform: uppercase;
color: #666666;
margin: .5em 0;
}
/* Main
----------------------------------------------- */
.main-outer {
background: transparent none repeat scroll top center;
-moz-border-radius: 0 0 0 0;
-webkit-border-top-left-radius: 0;
-webkit-border-top-right-radius: 0;
-webkit-border-bottom-left-radius: 0;
-webkit-border-bottom-right-radius: 0;
-goog-ms-border-radius: 0 0 0 0;
border-radius: 0 0 0 0;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
box-shadow: 0 0 0 rgba(0, 0, 0, .15);
}
.main-inner {
padding: 15px 5px 20px;
}
.main-inner .column-center-inner {
padding: 0 0;
}
.main-inner .column-left-inner {
padding-left: 0;
}
.main-inner .column-right-inner {
padding-right: 0;
}
/* Posts
----------------------------------------------- */
h3.post-title {
margin: 0;
font: normal normal 18px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
}
.comments h4 {
margin: 1em 0 0;
font: normal normal 18px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
}
.date-header span {
color: #333333;
}
.post-outer {
background-color: #ffffff;
border: solid 1px #dddddd;
-moz-border-radius: 10px;
-webkit-border-radius: 10px;
border-radius: 10px;
-goog-ms-border-radius: 10px;
padding: 15px 20px;
margin: 0 -20px 20px;
}
.post-body {
line-height: 1.4;
font-size: 110%;
position: relative;
}
.post-header {
margin: 0 0 1.5em;
color: #999999;
line-height: 1.6;
}
.post-footer {
margin: .5em 0 0;
color: #999999;
line-height: 1.6;
}
#blog-pager {
font-size: 140%
}
#comments .comment-author {
padding-top: 1.5em;
border-top: dashed 1px #ccc;
border-top: dashed 1px rgba(128, 128, 128, .5);
background-position: 0 1.5em;
}
#comments .comment-author:first-child {
padding-top: 0;
border-top: none;
}
.avatar-image-container {
margin: .2em 0 0;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #cc4411;
border-bottom: 1px solid #cc4411;
}
.comments .continue {
border-top: 2px solid #cc4411;
}
/* Widgets
----------------------------------------------- */
.widget ul, .widget #ArchiveList ul.flat {
padding: 0;
list-style: none;
}
.widget ul li, .widget #ArchiveList ul.flat li {
border-top: dashed 1px #ccc;
border-top: dashed 1px rgba(128, 128, 128, .5);
}
.widget ul li:first-child, .widget #ArchiveList ul.flat li:first-child {
border-top: none;
}
.widget .post-body ul {
list-style: disc;
}
.widget .post-body ul li {
border: none;
}
/* Footer
----------------------------------------------- */
.footer-outer {
color:#eeeeee;
background: transparent url(https://resources.blogblog.com/blogblog/data/1kt/transparent/black50.png) repeat scroll top left;
-moz-border-radius: 10px 10px 10px 10px;
-webkit-border-top-left-radius: 10px;
-webkit-border-top-right-radius: 10px;
-webkit-border-bottom-left-radius: 10px;
-webkit-border-bottom-right-radius: 10px;
-goog-ms-border-radius: 10px 10px 10px 10px;
border-radius: 10px 10px 10px 10px;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
box-shadow: 0 0 0 rgba(0, 0, 0, .15);
}
.footer-inner {
padding: 10px 5px 20px;
}
.footer-outer a {
color: #ffffdd;
}
.footer-outer a:visited {
color: #cccc99;
}
.footer-outer a:hover {
color: #ffffff;
}
.footer-outer .widget h2 {
color: #bbbbbb;
}
/* Mobile
----------------------------------------------- */
html body.mobile {
height: auto;
}
html body.mobile {
min-height: 480px;
background-size: 100% auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
html .mobile .mobile-date-outer, html .mobile .blog-pager {
border-bottom: none;
background: transparent none repeat scroll top center;
margin-bottom: 10px;
}
.mobile .date-outer {
background: transparent none repeat scroll top center;
}
.mobile .header-outer, .mobile .main-outer,
.mobile .post-outer, .mobile .footer-outer {
-moz-border-radius: 0;
-webkit-border-radius: 0;
-goog-ms-border-radius: 0;
border-radius: 0;
}
.mobile .content-outer,
.mobile .main-outer,
.mobile .post-outer {
background: inherit;
border: none;
}
.mobile .content-outer {
font-size: 100%;
}
.mobile-link-button {
background-color: #992211;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile-index-contents {
color: #333333;
}
.mobile .tabs-inner .PageList .widget-content {
background: #ffffff url(//www.blogblog.com/1kt/transparent/tabs_gradient_shade.png) repeat scroll bottom;
color: #000000;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #cccccc;
}

--></style>
<style id='template-skin-1' type='text/css'><!--
body {
min-width: 1020px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 1020px;
max-width: 1020px;
_width: 1020px;
}
.main-inner .columns {
padding-left: 0px;
padding-right: 0px;
}
.main-inner .fauxcolumn-center-outer {
left: 0px;
right: 0px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0px") -
parseInt("0px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0px;
}
.main-inner .fauxcolumn-right-outer {
width: 0px;
}
.main-inner .column-left-outer {
width: 0px;
right: 100%;
margin-left: -0px;
}
.main-inner .column-right-outer {
width: 0px;
margin-right: -0px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
body#layout div.add_widget {
padding: 8px;
}
body#layout div.add_widget a {
margin-left: 32px;
}
--></style>
<style>
    body {background-image:url(\/\/themes.googleusercontent.com\/image?id=1fupio4xM9eVxyr-k5QC5RiCJlYR35r9dXsp63RKsKt64v33poi2MvnjkX_1MULBY8BsT);}
    
@media (max-width: 200px) { body {background-image:url(\/\/themes.googleusercontent.com\/image?id=1fupio4xM9eVxyr-k5QC5RiCJlYR35r9dXsp63RKsKt64v33poi2MvnjkX_1MULBY8BsT&options=w200);}}
@media (max-width: 400px) and (min-width: 201px) { body {background-image:url(\/\/themes.googleusercontent.com\/image?id=1fupio4xM9eVxyr-k5QC5RiCJlYR35r9dXsp63RKsKt64v33poi2MvnjkX_1MULBY8BsT&options=w400);}}
@media (max-width: 800px) and (min-width: 401px) { body {background-image:url(\/\/themes.googleusercontent.com\/image?id=1fupio4xM9eVxyr-k5QC5RiCJlYR35r9dXsp63RKsKt64v33poi2MvnjkX_1MULBY8BsT&options=w800);}}
@media (max-width: 1200px) and (min-width: 801px) { body {background-image:url(\/\/themes.googleusercontent.com\/image?id=1fupio4xM9eVxyr-k5QC5RiCJlYR35r9dXsp63RKsKt64v33poi2MvnjkX_1MULBY8BsT&options=w1200);}}
/* Last tag covers anything over one higher than the previous max-size cap. */
@media (min-width: 1201px) { body {background-image:url(\/\/themes.googleusercontent.com\/image?id=1fupio4xM9eVxyr-k5QC5RiCJlYR35r9dXsp63RKsKt64v33poi2MvnjkX_1MULBY8BsT&options=w1600);}}
  </style>
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2029700426505953971&amp;zx=4dba4df4-0d84-41de-82dd-c8936857bf2f' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2029700426505953971&amp;zx=4dba4df4-0d84-41de-82dd-c8936857bf2f' rel='stylesheet'/></noscript>
</head>
<body class='loading variant-shade'>
<div class='navbar section' id='navbar' name='Navbar'><div class='widget Navbar' data-version='1' id='Navbar1'><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar.g?targetBlogID\x3d2029700426505953971\x26blogName\x3dBits,+Please!\x26publishMode\x3dPUBLISH_MODE_BLOGSPOT\x26navbarType\x3dLIGHT\x26layoutType\x3dLAYOUTS\x26searchRoot\x3dhttps://bits-please.blogspot.com/search\x26blogLocale\x3den_GB\x26v\x3d2\x26homepageUrl\x3dhttps://bits-please.blogspot.com/\x26targetPostID\x3d4923895734931327947\x26blogPostOrPageUrl\x3dhttps://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html\x26vt\x3d-4159022061004834161',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div class='body-fauxcolumns'>
<div class='fauxcolumn-outer body-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content'>
<div class='content-fauxcolumns'>
<div class='fauxcolumn-outer content-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content-outer'>
<div class='content-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left content-fauxborder-left'>
<div class='fauxborder-right content-fauxborder-right'></div>
<div class='content-inner'>
<header>
<div class='header-outer'>
<div class='header-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left header-fauxborder-left'>
<div class='fauxborder-right header-fauxborder-right'></div>
<div class='region-inner header-inner'>
<div class='header section' id='header' name='Header'><div class='widget Header' data-version='1' id='Header1'>
<div id='header-inner'>
<div class='titlewrapper'>
<h1 class='title'>
<a href='https://bits-please.blogspot.it/'>
Bits, Please!
</a>
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span>
</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class='header-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</header>
<div class='tabs-outer'>
<div class='tabs-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left tabs-fauxborder-left'>
<div class='fauxborder-right tabs-fauxborder-right'></div>
<div class='region-inner tabs-inner'>
<div class='tabs no-items section' id='crosscol' name='Cross-column'></div>
<div class='tabs no-items section' id='crosscol-overflow' name='Cross-Column 2'></div>
</div>
</div>
<div class='tabs-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='main-outer'>
<div class='main-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left main-fauxborder-left'>
<div class='fauxborder-right main-fauxborder-right'></div>
<div class='region-inner main-inner'>
<div class='columns fauxcolumns'>
<div class='fauxcolumn-outer fauxcolumn-center-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-left-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-right-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<!-- corrects IE6 width calculation -->
<div class='columns-inner'>
<div class='column-center-outer'>
<div class='column-center-inner'>
<div class='main section' id='main' name='Main'><div class='widget Blog' data-version='1' id='Blog1'>
<div class='blog-posts hfeed'>

          <div class="date-outer">
        
<h2 class='date-header'><span>30/06/2016</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='https://3.bp.blogspot.com/-lDwYrS4KH4Y/V2R6l3cEkxI/AAAAAAAAEDY/wdtH87j5vtgxeFzGIVi81iIh0xFgUEx4QCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B01%253A29%253A24.png' itemprop='image_url'/>
<meta content='2029700426505953971' itemprop='blogId'/>
<meta content='4923895734931327947' itemprop='postId'/>
<a name='4923895734931327947'></a>
<h3 class='post-title entry-title' itemprop='name'>
Extracting Qualcomm's KeyMaster Keys - Breaking Android Full Disk Encryption
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-4923895734931327947' itemprop='description articleBody'>
After covering a TrustZone kernel vulnerability and exploit in the <a href="http://bits-please.blogspot.co.il/2016/05/qsee-privilege-escalation-vulnerability.html">previous blog post</a>, I thought this time it might be interesting to explore some of the implications of code-execution within the TrustZone kernel. In this blog post, I'll demonstrate how TrustZone kernel code-execution can be used to effectively break Android's <b>F</b>ull <b>D</b>isk <b>E</b>ncryption (<b>FDE</b>) scheme. We'll also see some of the inherent issues stemming from the design of Android's FDE scheme, even without any TrustZone vulnerability.<br />
<br />
I've been in contact with Qualcomm regarding the issue prior to the release of this post, and have let them review the blog post. As always, they've been very helpful and fast to respond. Unfortunately, it seems as though fixing the issue is not simple, and might require hardware changes. <br />
<br />
If you aren't interested in the technical details and just want to read the conclusions - feel free to jump right to the "<b>Conclusions</b>" section. In the same vein, if you're only interested in the code, jump directly to the "<b>Code</b>" section.<br />
<br />
<i>[UPDATE: I've made a factual mistake in the original blog post, and have corrected it in the post below. Apparently Qualcomm are <u>not</u> able to sign firmware images, only OEMs can do so. As such, they cannot be coerced to create a custom TrustZone image. I apologise for the mistake.]</i><br />
<br />
And now without further ado, let's get to it!<br />
<br />
<h2>
Setting the Stage&nbsp; </h2>
<br />
A couple of months ago the highly-publicised case of&nbsp;<a href="http://www.cnbc.com/2016/03/29/apple-vs-fbi-all-you-need-to-know.html">Apple vs. FBI</a> brought attention to the topic of privacy - especially in the context of mobile devices. Following the <a href="https://en.wikipedia.org/wiki/2015_San_Bernardino_attack">2015 San Bernardino terrorist attack</a>, the FBI seized a mobile phone belonging to the shooter, Syed Farook, with the intent to search it for any additional evidence or leads related to the ongoing investigation. However, despite being in possession of the device, the FBI were unable to unlock the phone and access its contents. <br />
<br />
This may sound puzzling at first. "Surely if the FBI has access to the phone, could they not extract the user data stored on it using forensic tools?". Well, the answer is not that simple. You see, the device in question was an iPhone 5c, running iOS 9.<br />
<br />
As you may well know, starting with iOS 8, Apple has automatically enabled <b>F</b>ull <b>D</b>isk <b>E</b>ncryption (<b>FDE</b>) using an encryption key which is <u>derived from the user's password</u>. In order to access the data on the device, the FBI would have to crack that encryption. Barring any errors in cryptographic design, this would most probably be achieved by cracking the user's password.<br />
<br />
"So why not just brute-force the password?". That sounds like a completely valid approach - especially since most users are notoriously bad at choosing strong passwords, even more so when it comes to mobile devices.<br />
<br />
However, the engineers at Apple were not oblivious to this concern when designing their FDE scheme. In order to try and mitigate this kind of attack, they've designed the encryption scheme so that the generated encryption key is <u>bound to the hardware of the device.</u>&nbsp; <br />
<br />
In short, each device has an immutable 256-bit unique key called the UID, which is randomly generated and fused into the device's hardware at the factory. The key is stored in a way which completely prevents access to it using software or firmware (it can only be set as a key for the AES Engine), meaning that <u>even Apple cannot extract it from the device</u> once it's been set. This device-specific key is then used in combination with the provided user's password in order to generate the resulting encryption key used to protect the data on the device. This effectively 'tangles' the password and the UID key.<br />
<br />
<br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody>
<tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-lDwYrS4KH4Y/V2R6l3cEkxI/AAAAAAAAEDY/wdtH87j5vtgxeFzGIVi81iIh0xFgUEx4QCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B01%253A29%253A24.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="https://3.bp.blogspot.com/-lDwYrS4KH4Y/V2R6l3cEkxI/AAAAAAAAEDY/wdtH87j5vtgxeFzGIVi81iIh0xFgUEx4QCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B01%253A29%253A24.png" /></a></td></tr>
<tr><td class="tr-caption" style="text-align: center;">Apple's FDE KDF</td></tr>
</tbody></table>
Binding the encryption key to the device's hardware allows Apple to make the job <u>much harder</u> for would-be attackers. It essentially forces attackers to use the device for each cracking attempt. This, in turn, allows Apple to introduce a whole array of defences that would make cracking attempts on the device unattractive.<br />
<br />
For starters, the key-derivation function shown above is engineered in such a way so that it would take a substantial amount of time to compute on the device. Specifically, Apple chose the function's parameters so that a single key derivation would take approximately 80 milliseconds. This delay would make cracking short alphanumeric passwords slow (~2 weeks for a 4-character alphanumeric password), and cracking longer passwords completely infeasible.<br />
<br />
In order to further mitigate brute-force attacks on the device itself, Apple has also introduced an incrementally increasingly delay between subsequent password guesses. On the iPhone 5c, this delay was facilitated completely using software. Lastly, Apple has allowed for an option to completely erase all of the 
information stored on the device after 10 failed password attempts. This
 configuration, coupled with the software-induced delays, made cracking 
the password on the device itself rather infeasible as well.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://4.bp.blogspot.com/-wcxQCcM2ekc/V2SCseehdaI/AAAAAAAAEDo/XGWsuVVMu1sZHXQyddOniJq2nRUDXUu4gCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B02%253A05%253A42.png" imageanchor="1"><img border="0" src="https://4.bp.blogspot.com/-wcxQCcM2ekc/V2SCseehdaI/AAAAAAAAEDo/XGWsuVVMu1sZHXQyddOniJq2nRUDXUu4gCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B02%253A05%253A42.png" /></a></div>
<br />
With this in mind, it's a lot more reasonable that the FBI were unable to crack the device's encryption.<br />
<br />
Had they been able to extract the UID key, they could have used as much (specialized) hardware as needed in order to rapidly guess many passwords, which would most probably allow them to eventually guess the correct password. However, seeing as the UID key cannot be extracted by means of software or firmware, that option is ruled out.<br />
<br />
As for cracking the password on the device, the software-induced delays between password attempts and the possibility of obliterating all the data on the device made that option rather unattractive. That is, unless they could bypass the software protections... However, this is where the story gets rather irrelevant to this blog post, so we'll keep it at that.<br />
<br />
If you'd like to read more, you can check out <a href="https://blog.trailofbits.com/2016/02/17/apple-can-comply-with-the-fbi-court-order/">Dan Guido's superb post about the technical aspects of Apple v. FBI</a>, or <a href="http://blog.cryptographyengineering.com/2014/10/why-cant-apple-decrypt-your-iphone.html">Matthew Green's great overview on Apple's FDE</a>, or better yet, the <a href="http://www.apple.com/business/docs/iOS_Security_Guide.pdf">iOS Security Guide</a>.<br />
<br />
Going back to the issue at hand - we can see that Apple has cleverly designed their FDE scheme in order to make it very difficult to crack. Android, being the mature operating system that it is, was not one to lag behind. In fact, Android has also offered full disk encryption, which has been enabled by default since Android 5.0.<br />
<br />
So how does Android's FDE scheme fare? Let's find out.<br />
<br />
<h2>
Android Full Disk Encryption</h2>
<br />
Starting with Android 5.0, Android devices automatically protect all of the user's information by enabling full disk encryption.<br />
<br />
Android FDE is based on a Linux Kernel subsystem called <a href="https://en.wikipedia.org/wiki/Dm-crypt">dm-crypt</a>, which is widely deployed and researched. Off the bat, this is already good news - <i>dm-crypt</i> has withstood the test of time, and as such seems like a great candidate for an FDE implementation. However, while the encryption scheme may be robust, the system is only as strong as the key being used to encrypt the information. Additionally, mobile devices tend to cause users to choose poorer passwords in general. This means the key derivation function is hugely important in this setting.<br />
<br />
So how is the encryption key generated?<br />
<br />
This process is described in great detail in the <a href="https://source.android.com/security/encryption/">official documentation of Android FDE</a>, and in even greater detail in <a href="https://nelenkov.blogspot.co.il/2014/10/revisiting-android-disk-encryption.html">Nikolay Elenkov's blog, "Android Explorations"</a>. In short, the device generates a randomly-chosen 128-bit master key (which we'll refer to as the Device Encryption Key - DEK) and a 128-bit randomly-chosen salt. The DEK is then protected using an elaborate key derivation scheme, which uses the user's provided unlock credentials (PIN/Password/Pattern) in order to derive a key which will ultimately encrypt the DEK. The encrypted DEK is then stored on the device, inside a special <i>unencrypted</i> structure called the "<i>crypto footer</i>".<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://3.bp.blogspot.com/-NywtrnafKBs/V2V3zOOGKZI/AAAAAAAAEEg/QLXjh75BDfoS1IHXt6H0GvdX7sbUjlNVQCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B19%253A33%253A10.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-NywtrnafKBs/V2V3zOOGKZI/AAAAAAAAEEg/QLXjh75BDfoS1IHXt6H0GvdX7sbUjlNVQCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B19%253A33%253A10.png" /></a></div>
<br />
The encrypted disk can then be decrypted by simply taking the user's provided credentials, passing them through the key derivation function, and using the resulting key to decrypt the stored DEK. Once the DEK is decrypted, it can be used to decrypt user's information.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://1.bp.blogspot.com/-Gc3bMHKF1t8/V2V61jFnSuI/AAAAAAAAEEs/nGISfhbZwzEBsUQ7iTCMuIWQaZh9Wd-mwCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B19%253A46%253A00.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://1.bp.blogspot.com/-Gc3bMHKF1t8/V2V61jFnSuI/AAAAAAAAEEs/nGISfhbZwzEBsUQ7iTCMuIWQaZh9Wd-mwCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B19%253A46%253A00.png" /></a></div>
<br />
<br />
However, this is where it gets interesting! Just like Apple's FDE scheme, Android FDE seeks to prevent brute-force cracking attacks; both on the device and especially off of it.<br />
<br />
Naturally, in order to prevent on-device cracking attacks, Android introduced delays between decryption attempts and an option to wipe the user's information after a few subsequent failed decryption attempts (just like iOS). But what about preventing off-device brute-force attacks? Well, this is achieved by introducing a step in the key derivation scheme which <u>binds the key to the device's hardware</u>. This binding is performed using Android's <a href="https://source.android.com/security/keystore/">Hardware-Backed Keystore</a> - KeyMaster.<br />
<br />
<h2>
KeyMaster</h2>
<br />
The KeyMaster module is intended to assure the protection of cryptographic keys generated by applications. In order to guarantee that this protection cannot be tampered with, the KeyMaster module runs in a <b>T</b>rusted <b>E</b>xecution <b>E</b>nvironment (<b>TEE</b>), which is completely separate from the Android operating system. In keeping with the TrustZone terminology, we'll refer to the Android operating system as the "Non-Secure World", and to the TEE as the "Secure World".<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://4.bp.blogspot.com/-g3201mWwF6M/V2V8puASLaI/AAAAAAAAEE4/2D0kG9hFEMMGc42qIAu15wA1UQdSh62pQCLcB/s1600/access-to-keymaster.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-g3201mWwF6M/V2V8puASLaI/AAAAAAAAEE4/2D0kG9hFEMMGc42qIAu15wA1UQdSh62pQCLcB/s1600/access-to-keymaster.png" /></a></div>
<br />
Put simply, the KeyMaster module can be used to generate encryption keys, and to perform cryptographic operations on them, without ever revealing the keys to the <i>Non-Secure World</i>.<br />
<br />
Once the keys are generated in the KeyMaster module, they are encrypted using a hardware-backed encryption key, and returned to <i>Non-Secure World</i>. Whenever the <i>Non-Secure World</i> wishes to perform an operation using the generated keys, it must supply the encrypted "<i>key blob</i>" to the KeyMaster module. The KeyMaster module can then decrypt the stored key, use it to perform the wanted cryptographic operation, and finally return the result to the <i>Non-Secure World</i>.<br />
<br />
Since this is all done without ever revealing the cryptographic keys used to protect the key blobs to the <i>Non-Secure World</i>, this means that all cryptographic operations performed using <i>key blobs</i> must be handled by the KeyMaster module, directly on the device itself. <br />
<br />
With this in mind, let's see exactly how KeyMaster is used in Android's FDE scheme. We'll do so by taking a closer look at the hardware-bound key derivation function used in Android's FDE scheme. Here's a short schematic detailing the KDF (based on a similar schematic created by Nikolay Elenkov):<br />
<br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody>
<tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-iU6vXBS892I/V3PlRckEDKI/AAAAAAAAEMA/Ex-3qeqSTfQ_N4JpJ5sYzryhOhyR0Dq_ACLcB/s1600/Screenshot%2Bfrom%2B2016-06-29%2B18%253A11%253A55.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="https://3.bp.blogspot.com/-iU6vXBS892I/V3PlRckEDKI/AAAAAAAAEMA/Ex-3qeqSTfQ_N4JpJ5sYzryhOhyR0Dq_ACLcB/s1600/Screenshot%2Bfrom%2B2016-06-29%2B18%253A11%253A55.png" /></a></td></tr>
<tr><td class="tr-caption" style="text-align: center;">Android FDE's KDF</td></tr>
</tbody></table>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://1.bp.blogspot.com/-EXv6HDbCpcw/V3Pk3u6lseI/AAAAAAAAEL4/flv6WQydIbwPMNVFzpaA51HpCkDPa9WrQCLcB/s1600/Screenshot%2Bfrom%2B2016-06-29%2B18%253A06%253A22.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><br /></a></div>
As you can see, in order to bind the KDF to the hardware of the device, an additional field is stored in the <i>crypto footer </i>- a KeyMaster-generated <i>key blob</i>. This key blob contains a KeyMaster-encrypted RSA-2048 private key, which is used to sign the encryption key in an intermediate step in the KDF - thus requiring the use of the KeyMaster module in order to produce the intermediate key used decrypt the DEK in each decryption attempt.<br />
<br />
Moreover, the <i>crypto footer</i> also contains an additional field that doesn't serve any direct purpose in the decryption process; the value returned from running <i>scrypt</i> on the final intermediate key (IK3). This value is referred to as the "scrypted_intermediate_key" (<i>Scrypted IK</i> in the diagram above). It is used to verify the validity of the supplied FDE password in case of errors during the decryption process. This is important since it allows Android to know when a given encryption key is valid but the disk itself is faulty. However, knowing this value still shouldn't help the attacker "reverse" it to retrieve the IK3, so it still can't be used to help attackers aiming to guess the password off the device.<br />
<br />
As we've seen, the Android FDE's KDF is "bound" to the hardware of the device by the intermediate KeyMaster signature. But how secure <i>is</i> the KeyMaster module? How are the key blobs protected? Unfortunately, this is hard to say. The implementation of the KeyMaster module is provided by the SoC OEMs and, as such, is completely undocumented (essentially a black-box). We could try and rely on the official Android documentation, which states that the KeyMaster module: "...offers an opportunity for Android devices to provide <i>hardware-backed</i>, <i>strong
security</i> services...". But surely that's not enough.<br />
<br />
So... Are you pondering what I'm pondering? <br />
<br />
<h2>
Reversing Qualcomm's KeyMaster </h2>
<br />
As we've seen in the previous blog posts, Qualcomm provides a Trusted Execution Environment called <b>QSEE</b> (<b>Q</b>ualcomm <b>S</b>ecure <b>E</b>xecution <b>E</b>nvironment). The QSEE environment allows small applications, called "Trustlets", to execute on a dedicated secured processor within the "Secure World" of TrustZone. One such QSEE trustlet running in the "Secure World" is the <i>KeyMaster</i> application. As we've already seen <a href="https://bits-please.blogspot.com/2016/05/qsee-privilege-escalation-vulnerability.html">how to reverse-engineer QSEE trustlets</a>, we can simply apply the same techniques in order to reverse engineer the KeyMaster module and gain some insight into its inner workings. <br />
<br />
First, let's take a look at the <a href="http://androidxref.com/5.1.1_r6/xref/hardware/qcom/keymaster/keymaster_qcom.h#70">Android source code</a> which is used to interact with the KeyMaster application. Doing so reveals that the trustlet only supports four different commands:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://3.bp.blogspot.com/-monwFIErnkY/V2WuBeQcy6I/AAAAAAAAEFM/7Pd1EM4Srk4onDaBnAGG3-rJHs_9Vj54wCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B23%253A23%253A52.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-monwFIErnkY/V2WuBeQcy6I/AAAAAAAAEFM/7Pd1EM4Srk4onDaBnAGG3-rJHs_9Vj54wCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B23%253A23%253A52.png" /></a></div>
As we're interested in the protections guarding the generated key blobs, let's take a look at the <i>KEYMASTER_SIGN_DATA</i> command. This command receives a previously encrypted key blob and <i>somehow</i> performs an operation using the encapsulated cryptographic key. Ergo, by reverse-engineering this function, we should be able to deduce how the encrypted key blobs are decapsulated by the KeyMaster module.<br />
<br />
The command's signature is exactly as you'd imagine - the user provides an encrypted key blob, the signature parameters, and the address and length of the data to be signed. The trustlet then decapsulates the key, calculates the signature, and writes it into the shared result buffer.<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://4.bp.blogspot.com/-8z8nTv5de88/V2W0fIh9hzI/AAAAAAAAEFw/PAAFsiY_Zd8a42M673mi43Uz_pXzDY7aACLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B23%253A49%253A58.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-8z8nTv5de88/V2W0fIh9hzI/AAAAAAAAEFw/PAAFsiY_Zd8a42M673mi43Uz_pXzDY7aACLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B23%253A49%253A58.png" /></a></div>
<br />
As luck would have it, the key blob's structure is actually defined in the <a href="http://androidxref.com/5.1.1_r6/xref/hardware/qcom/keymaster/keymaster_qcom.h#54">supplied header files</a>. Here's what it looks like:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://2.bp.blogspot.com/-eE94mo7pLDU/V2WxKwDAEMI/AAAAAAAAEFY/jTgb8d3HqfYQUvdTmN8jdld2-0tBBR1JQCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B23%253A37%253A47.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-eE94mo7pLDU/V2WxKwDAEMI/AAAAAAAAEFY/jTgb8d3HqfYQUvdTmN8jdld2-0tBBR1JQCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B23%253A37%253A47.png" /></a></div>
<br />
Okay! This is pretty interesting.<br />
<br />
First, we can see that the key blob contains the unencrypted modulus and public exponent of the generated RSA key. However, the private exponent seems to be encrypted in some way. Not only that, but the whole key blob's authenticity is verified by using an HMAC. So where is the encryption key stored? Where is the HMAC key stored? We'll have to reverse-engineer the KeyMaster module to find out.<br />
<br />
Let's take a look at the KeyMaster trustlet's implementation of the <i>KEYMASTER_SIGN_DATA</i> command. The function starts with some boilerplate validations in order to make sure the supplied parameters are valid. We'll skip those, since they aren't the focus of this post. After verifying all the parameters, the function maps-in the user-supplied data buffer, so that it will be accessible to the "Secure World". Eventually, we reach the "core" logic of the function:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://1.bp.blogspot.com/-pUrOitHwsGk/V2W6_h_bqzI/AAAAAAAAEGU/oUA7xBkkDMMWFAkTM-LMlvgx_qZek5qHQCLcB/s1600/Screenshot%2Bfrom%2B2016-06-19%2B00%253A19%253A50.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://1.bp.blogspot.com/-pUrOitHwsGk/V2W6_h_bqzI/AAAAAAAAEGU/oUA7xBkkDMMWFAkTM-LMlvgx_qZek5qHQCLcB/s1600/Screenshot%2Bfrom%2B2016-06-19%2B00%253A19%253A50.png" /></a></div>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://1.bp.blogspot.com/-hrEM7eLWGhw/V2W5h0FrY7I/AAAAAAAAEGI/8J3LNixWHts0ar0vj_WLEvn_NEUImtENwCLcB/s1600/Screenshot%2Bfrom%2B2016-06-19%2B00%253A12%253A43.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><br /></a></div>
Okay, we're definitely getting somewhere!<br />
<br />
First of all, we can see that the code calls some function which I've taken the liberty of calling <i>get_some_kind_of_buffer</i>, and stores the results in the variables <i>buffer_0</i> and <i>buffer_1</i>. Immediately after retrieving these buffers, the code calls the <i>qsee_hmac</i> function in order to calculate the HMAC of the first 0x624 bytes of the user-supplied key blob. This makes sense, since the size of the key blob structure we've seen before is exactly 0x624 bytes (without the HMAC field).<br />
<br />
But wait! We've already seen the <i>qsee_hmac</i> function before - in the Widevine application. Specifically, we know it receives the following arguments:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://2.bp.blogspot.com/-_FjrnZfLxEY/V2W8dTssaqI/AAAAAAAAEGg/fAAqqAaI42IVv9P8JXL5-_6TCZkhCxRNQCLcB/s1600/Screenshot%2Bfrom%2B2016-06-19%2B00%253A26%253A05.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-_FjrnZfLxEY/V2W8dTssaqI/AAAAAAAAEGg/fAAqqAaI42IVv9P8JXL5-_6TCZkhCxRNQCLcB/s1600/Screenshot%2Bfrom%2B2016-06-19%2B00%253A26%253A05.png" /></a></div>
<br />
The variable that we've called <i>buffer_1</i> is passed in as the fourth argument to <i>qsee_hmac</i>. This can only mean one thing... It is in fact the HMAC key!<br />
<br />
What about <i>buffer_0</i>? We can already see that it is used in the function <i>do_something_with_keyblob</i>. Not only that, but immediately after calling that function, the signature is calculated and written to the destination buffer. However, as we've previously seen, the private exponent is <u>encrypted</u> in the key blob. Obviously the RSA signature cannot be calculated until the private exponent is decrypted... So what does <i>do_something_with_keyblob </i>do? Let's see:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://2.bp.blogspot.com/-0p9sFpH3mHI/V2W-nuk0FoI/AAAAAAAAEG0/N9mjAJliMRQxP8o_XfPqCMQnnFhDOZ-tQCLcB/s1600/Screenshot%2Bfrom%2B2016-06-19%2B00%253A35%253A16.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-0p9sFpH3mHI/V2W-nuk0FoI/AAAAAAAAEG0/N9mjAJliMRQxP8o_XfPqCMQnnFhDOZ-tQCLcB/s1600/Screenshot%2Bfrom%2B2016-06-19%2B00%253A35%253A16.png" /></a></div>
<br />
Aha! Just as we suspected. The function <i>do_something_with_keyblob</i> simply decrypts the private exponent, using <i>buffer_0</i> as the encryption key!<br />
<br />
Finally, let's take a look at the function that was used to retrieve the HMAC and encryption keys (now bearing a more appropriate name):<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://1.bp.blogspot.com/-x-9yk4lRNV0/V2XBlaA59mI/AAAAAAAAEHE/4zIgOchSjkw5al4iXaa_r1zCrhgdnAUwgCLcB/s1600/Screenshot%2Bfrom%2B2016-06-19%2B00%253A47%253A56.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://1.bp.blogspot.com/-x-9yk4lRNV0/V2XBlaA59mI/AAAAAAAAEHE/4zIgOchSjkw5al4iXaa_r1zCrhgdnAUwgCLcB/s1600/Screenshot%2Bfrom%2B2016-06-19%2B00%253A47%253A56.png" /></a></div>
<br />
As we can see in the code above, the HMAC key and the encryption key are <i>both</i> generated using some kind of key derivation function. Each key is generated by invoking the KDF using a pair of hard-coded strings as inputs. The resulting derived key is then stored in the KeyMaster application's global buffer, and the pointer to the key is returned to the caller. Moreover, if we are to trust the provided strings, the internal key derivation function uses an <i>actual</i> hardware key, called the <i>SHK</i>, which would no doubt be hard to extract using software...<br />
<br />
...But this is all irrelevant! The decapsulation code we have just reverse-engineered has revealed a very important fact.<br />
<br />
Instead of creating a scheme which <i>directly</i> uses the hardware key without ever divulging it to software or firmware, the code above performs the encryption and validation of the key blobs using keys which are <u>directly available to the TrustZone software</u>! Note that the keys are also <u>constant</u> - they are directly derived from the SHK (which is fused into the hardware) and from two "hard-coded" strings.<br />
<br />
Let's take a moment to explore some of the implications of this finding.<br />
<br />
<h2>
Conclusions</h2>
<h2>
&nbsp;</h2>
<ul>
<li><b>The key derivation is not hardware bound.</b> Instead of using a real hardware key which cannot be extracted by software (for example, the SHK), the KeyMaster application uses a key <u>derived from the SHK</u> and <u>directly available to TrustZone</u>. </li>
<li><b>OEMs can comply with law enforcement to break Full Disk Encryption.</b> Since the key is available to TrustZone, OEMs could simply create and sign a TrustZone image which extracts the KeyMaster keys and flash it to the target device. This would allow law enforcement to easily brute-force the FDE password off the device using the leaked keys.</li>
<li><b>Patching TrustZone vulnerabilities does not necessarily protect you from this issue.</b> Even on patched devices, if an attacker can obtain the encrypted disk image (e.g. by using forensic tools), they can then "downgrade" the device to a vulnerable version, extract the key by exploiting TrustZone, and use them to brute-force the encryption. Since the key is derived directly from the SHK, and the SHK <u>cannot be modified</u>, this renders all down-gradable devices directly vulnerable.</li>
<li><b>Android FDE is only as strong as the TrustZone kernel or KeyMaster.</b> Finding a TrustZone kernel vulnerability or a vulnerability in the KeyMaster trustlet, directly leads to the disclosure of the KeyMaster keys, thus enabling off-device attacks on Android FDE. </li>
</ul>
<br />
During my communication with Qualcomm I voiced concerns about the usage of a software-accessible key derived from the SHK. I suggested using the SHK (or another hardware key) directly. As far as I know, the SHK <u>cannot be extracted from software</u>, and is only available to the cryptographic processors (similarly to Apple's UID). Therefore, using it would thwart any attempt at off-device brute force attacks (barring the use of specialized hardware to extract the key).<br />
<br />
However, reality is not that simple. The SHK is used for many different purposes. Allowing the user to directly encrypt data using the SHK would compromise those use-cases. Not only that, but the KeyMaster application is widely used in the Android operating-system. Modifying its behaviour could "break" applications which rely on it. Lastly, the current design of the KeyMaster application doesn't differentiate between requests which use the KeyMaster application for Android FDE and other requests for different use-cases. This makes it harder to incorporate a fix which only modifies the KeyMaster application.&nbsp; <br />
<br />
Regardless, I believe this issue underscores the need for a solution that entangles the full disk encryption key with the device's hardware in a way which cannot be bypassed using software. Perhaps that means redesigning the FDE's KDF. Perhaps this can be addressed using additional hardware. I think this is something Google and OEMs should definitely get together and think about.<br />
<br />
<h2>
Extracting the KeyMaster Keys</h2>
<h2>
&nbsp;</h2>
<h2>
</h2>
Now that we've set our sights on the KeyMaster keys, we are still left with the challenge of extracting the keys directly from TrustZone.<br />
<br />
Previously on the zero-to-TrustZone series of blog posts, we've discovered an exploit which allowed us to achieve <a href="https://bits-please.blogspot.com/2016/05/qsee-privilege-escalation-vulnerability.html">code-execution within QSEE</a>, namely, within the Widevine DRM application. However, is that enough?<br />
<br />
Perhaps we could read the keys directly from the KeyMaster trustlet's memory from the context of the hijacked Widevine trustlet? Unfortunately, the answer is no. Any attempt to access a different QSEE application's memory causes an XPU violation, and subsequently crashes the violating trustlet (even when switching to a kernel context). What about calling the same KDF used by the KeyMaster module to generate the keys from the context of the Widevine trustlet? Unfortunately the answer is no once again. The KDF is only present in the KeyMaster application's code segment, and QSEE applications cannot modify their own code or allocate new executable pages.<br />
<br />
Luckily, we've also previously discovered an additional <a href="https://bits-please.blogspot.com/2016/06/trustzone-kernel-privilege-escalation.html">privilege escalation from QSEE to the TrustZone kernel</a>. Surely code execution within the TrustZone kernel would allow us to hijack any QSEE application! Then, once we control the KeyMaster application, we can simply use it to leak the HMAC and encryption keys and call it a day.<br />
<br />
Recall that in the <a href="https://bits-please.blogspot.com/2016/06/trustzone-kernel-privilege-escalation.html">previous blog post</a> we reverse-engineered the mechanism behind the invocation of system calls in the TrustZone kernel. Doing so revealed that most system-calls are invoked indirectly by using a set of globally-stored pointers, each of which pointing to a different table of supported system-calls. Each system-call table simply contained a bunch of consecutive 64-bit entries; a 32-bit value representing the syscall number, followed by a 
32-bit pointer to the syscall handler function itself. Here is one such table:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://3.bp.blogspot.com/-lGUAZb_m4Do/V2XVj1_EEqI/AAAAAAAAEHU/LyzaCCCJbIUJJynZsAzu-5yzuijT0VQtACLcB/s1600/Screenshot%2Bfrom%2B2016-06-12%2B16%253A43%253A49.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-lGUAZb_m4Do/V2XVj1_EEqI/AAAAAAAAEHU/LyzaCCCJbIUJJynZsAzu-5yzuijT0VQtACLcB/s1600/Screenshot%2Bfrom%2B2016-06-12%2B16%253A43%253A49.png" /></a></div>
<br />
Since these tables are used by all QSEE trustlets, they could serve as a highly convenient entry point in order to hijack the code execution within the KeyMaster application!<br />
<br />
All we would need to do is to overwrite a system-call handler entry in the table, and point it to a function of our own. Then, once the KeyMaster application invokes the target system-call, it would execute our own handler instead of the original one! This also enables us not to worry about restoring execution after executing our code, which is a nice added bonus.&nbsp; <br />
<br />
But there's a tiny snag - in order to direct the handler at a function of our own, we need some way to allocate a chunk of code which will be <i>globally available</i> in the "Secure World". This is because, as mentioned above, different QSEE applications cannot access each other's memory segments. This renders our <a href="https://bits-please.blogspot.com/2016/06/trustzone-kernel-privilege-escalation.html">previous method</a> of overwriting the code segments of the Widevine application useless in this case. However, as we've seen in the past, the TrustZone Kernel's code segments (which are accessible to all QSEE application when executing in kernel context) are protected using a special hardware component called an XPU. Therefore, even when running within the TrustZone kernel and disabling access protection faults in the ARM MMU, we are still unable to modify them.<br />
<br />
This is where some brute-force comes in handy... I've written a small snippet of code that quickly iterates over all of the TrustZone Kernel's code segments, and <i>attempt</i>s to modify them. If there is any (mistakenly?) XPU-unprotected region, we will surely find it. Indeed, after iterating through the code segments, one rather large segment, ranging from addresses 0xFE806000 to 0xFE810000, appeared to be unprotected!<br />
<br />
Since we don't want to disrupt the regular operation of the TrustZone kernel, it would be wise to find a small code-cave in that region, or a small chunk of code that would be harmless to overwrite. Searching around for a bit reveals a small bunch of logging strings in the segment - surely we can overwrite them without any adverse effects:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://4.bp.blogspot.com/-7x1o0D2qmW8/V2XabWlXqZI/AAAAAAAAEHk/B3ezI6iKwtQAZF6nVjuV5eTldnh2hEEFwCLcB/s1600/Screenshot%2Bfrom%2B2016-06-19%2B02%253A32%253A48.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-7x1o0D2qmW8/V2XabWlXqZI/AAAAAAAAEHk/B3ezI6iKwtQAZF6nVjuV5eTldnh2hEEFwCLcB/s1600/Screenshot%2Bfrom%2B2016-06-19%2B02%253A32%253A48.png" /></a></div>
Now that we have a modifiable code cave in the TrustZone kernel, we can proceed to write a small stub that, when called, will exfiltrate the KeyMaster keys directly from the KeyMaster trustlet's memory!<br />
<br />
Lastly, we need a simple way to cause the KeyMaster application to execute the hijacked system-call. Remember, we can easily send commands to the KeyMaster application which, in turn, will cause the KeyMaster application to call quite a few system-calls. Reviewing the KeyMaster's key-generation command reveals that one good candidate to hijack would be the "<i>qsee_hmac</i>" system-call:<br />
<br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody>
<tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-HJzMd_XHvzQ/V2vOQ82reoI/AAAAAAAAEJQ/Rya6uqpGjSQHxiFTF7M_sqR068P-pGthgCLcB/s1600/Screenshot%2Bfrom%2B2016-06-23%2B14%253A54%253A42.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="https://2.bp.blogspot.com/-HJzMd_XHvzQ/V2vOQ82reoI/AAAAAAAAEJQ/Rya6uqpGjSQHxiFTF7M_sqR068P-pGthgCLcB/s1600/Screenshot%2Bfrom%2B2016-06-23%2B14%253A54%253A42.png" /></a></td></tr>
<tr><td class="tr-caption" style="text-align: center;">KeyMaster's "Generate Key" Flow</td></tr>
</tbody></table>
Where <i>qsee_hmac</i>'s signature is:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://3.bp.blogspot.com/-2HqgQ66lIC0/V2u9yMWyOnI/AAAAAAAAEIw/B8Bo3XLUm3MByNmJc2uMiTX9vTz1juo4gCLcB/s1600/Screenshot%2Bfrom%2B2016-06-23%2B13%253A38%253A54.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-2HqgQ66lIC0/V2u9yMWyOnI/AAAAAAAAEIw/B8Bo3XLUm3MByNmJc2uMiTX9vTz1juo4gCLcB/s1600/Screenshot%2Bfrom%2B2016-06-23%2B13%253A38%253A54.png" /></a></div>
<br />
This is a good candidate for a few reasons:<br />
<ol>
<li>The "data" argument that's passed in is a buffer that's <u>shared with the non-secure world</u>. This means whatever we write to it can easily retrieved after returning from the "Secure World".</li>
<li>The <i>qsee_hmac</i> function is not called very often, so hijacking it for a couple of seconds would probably be harmless.</li>
<li>The function receives the address of the HMAC key as one of the arguments. This saves us the need to find the KeyMaster application's address dynamically and calculate the addresses of the keys in memory.</li>
</ol>
Finally, all our shellcode would have to do is to read the HMAC and encryption keys from the KeyMaster application's global buffer (at the locations we saw earlier on), and "leak" them into the shared buffer. After returning from the command request, we could then simply fish-out the leaked keys from the shared buffer. Here's a small snippet of THUMB assembly that does just that:<br />
<br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody>
<tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-aMxn4O8ObUQ/V3Po1AbzJuI/AAAAAAAAEMQ/6WivBPlHs5cTGr6Tkxgo8swd0EYNx-r8gCLcB/s1600/Screenshot%2Bfrom%2B2016-06-29%2B18%253A27%253A09.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="https://3.bp.blogspot.com/-aMxn4O8ObUQ/V3Po1AbzJuI/AAAAAAAAEMQ/6WivBPlHs5cTGr6Tkxgo8swd0EYNx-r8gCLcB/s1600/Screenshot%2Bfrom%2B2016-06-29%2B18%253A27%253A09.png" /></a></td></tr>
<tr><td class="tr-caption" style="text-align: center;">Shellcode which leaks KeyMaster Keys</td></tr>
</tbody></table>
<br />
<ol>
</ol>
<h2>
</h2>
<h2>
Putting it all together</h2>
<br />
Finally, we have all the pieces of the puzzle. All we need to do in order to extract the KeyMaster keys is to: <br />
<ul>
<li>Enable the DACR in the TrustZone kernel to allow us to modify the code cave.</li>
<li>Write a small shellcode stub in the code cave which reads the keys from the KeyMaster application.</li>
<li>Hijack the "<i>qsee_hmac</i>" system-call and point it at our shellcode stub.</li>
<li>Call the KeyMaster's key-generation command, causing it to trigger the poisoned system-call and exfiltrate the keys into the shared buffer.</li>
<li>Read the leaked keys from the shared buffer.&nbsp;</li>
</ul>
Here's a diagram detailing all of these steps: <br />
<ul>
</ul>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://4.bp.blogspot.com/-dbSuOf1tYRQ/V3QW8coBMiI/AAAAAAAAEMo/k0rQSL_y_fU9EVJhMYl3F4xu4T6dJ4wpwCLcB/s1600/Screenshot%2Bfrom%2B2016-06-29%2B21%253A43%253A24.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-dbSuOf1tYRQ/V3QW8coBMiI/AAAAAAAAEMo/k0rQSL_y_fU9EVJhMYl3F4xu4T6dJ4wpwCLcB/s1600/Screenshot%2Bfrom%2B2016-06-29%2B21%253A43%253A24.png" /></a></div>
<br />
<ul>
</ul>
<div class="separator" style="clear: both; text-align: center;">
</div>
<div class="separator" style="clear: both; text-align: center;">
</div>
<div class="separator" style="clear: both; text-align: center;">
</div>
<div class="separator" style="clear: both; text-align: center;">
</div>
<ul>
</ul>
<h2>
The Code</h2>
<br />
Finally, as always, I've provided the full source code for the attack described above. The code builds upon the two previously disclosed issues in the zero-to-TrustZone series, and allows you to leak the KeyMaster keys directly from your device! After successfully executing the exploit, the KeyMaster keys should be printed to the console, like so:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://2.bp.blogspot.com/-7V8zmvrKtuk/V3PYPqYpmKI/AAAAAAAAELQ/MrO0bi8oTPomts35cPDdnO0e1hvMZyxogCKgB/s1600/Screenshot%2Bfrom%2B2016-06-29%2B17%253A16%253A23.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-7V8zmvrKtuk/V3PYPqYpmKI/AAAAAAAAELQ/MrO0bi8oTPomts35cPDdnO0e1hvMZyxogCKgB/s1600/Screenshot%2Bfrom%2B2016-06-29%2B17%253A16%253A23.png" /></a></div>
<br />
<br />
You can find the full source code of the exploit here:<br />
<br />
<a href="https://github.com/laginimaineb/ExtractKeyMaster">https://github.com/laginimaineb/ExtractKeyMaster</a><br />
<br />
I've also written a set of python scripts which can be used to brute-force Android full disk encryption off the device. You can find the scripts here:<br />
<br />
<a href="https://github.com/laginimaineb/android_fde_bruteforce">https://github.com/laginimaineb/android_fde_bruteforce</a><br />
<br />
Simply invoke the python script <i>fde_bruteforce.py</i> using:<br />
<ul>
<li>The <i>crypto footer</i> from the device</li>
<li>The leaked KeyMaster keys</li>
<li>The word-list containing possible passwords</li>
</ul>
Currently, the script simply enumerates each password from a given word-list, and attempts to match the encryption result with the "scrypted intermediate key" stored in the <i>crypto footer</i>. That is, it passes each word in the word-list through the Android FDE KDF, <i>scrypt</i>s the result, and compares it to the value stored in the <i>crypto footer</i>. Since the implementation is fully in python, it is rather slow... However, those seeking speed could port it to a much faster platform, such as <a href="https://hashcat.net/hashcat/">hashcat</a>/<a href="https://hashcat.net/oclhashcat/">oclHashcat</a>.<br />
<br />
Here's what it looks like after running it on my own Nexus 6, encrypted using the password "secret":<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://4.bp.blogspot.com/-yGiT2dBq3OQ/V2V0Sh6tjrI/AAAAAAAAEEU/uXSnHPs4tH48h6vz-SollScHHJir6JHtACLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B19%253A18%253A03.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-yGiT2dBq3OQ/V2V0Sh6tjrI/AAAAAAAAEEU/uXSnHPs4tH48h6vz-SollScHHJir6JHtACLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B19%253A18%253A03.png" /></a></div>
<br />
Lastly, I've also written a script which can be used to decrypt already-generated KeyMaster key blobs. If you simply have a KeyMaster<i> key blob</i> that you'd like to decrypt using the leaked keys, you can do so by invoking the script <i>km_keymaster.py</i>, like so:<br />
<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://2.bp.blogspot.com/-p5_Erb_BwEg/V3PcJ9VBM0I/AAAAAAAAELU/Onl8ZgbJqS0P_vzHwxRvsxnUyO5kj7F9gCLcB/s1600/Screenshot%2Bfrom%2B2016-06-29%2B17%253A33%253A03.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-p5_Erb_BwEg/V3PcJ9VBM0I/AAAAAAAAELU/Onl8ZgbJqS0P_vzHwxRvsxnUyO5kj7F9gCLcB/s1600/Screenshot%2Bfrom%2B2016-06-29%2B17%253A33%253A03.png" /></a></div>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://4.bp.blogspot.com/-wSpFvXs57qY/V2vDq87f9WI/AAAAAAAAEJA/8ET8_y5dEJIHlZozRbPLfAe4ma-AFisWwCLcB/s1600/decrypted.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><br /></a></div>
<h2>
Final Thoughts</h2>
<h2>
</h2>
Full disk encryption is used world-wide, and can sometimes be instrumental to ensuring the privacy of people's most intimate pieces of information. As such, I believe the encryption scheme should be designed to be as "bullet-proof" as possible, against all types of adversaries. As we've seen, the current encryption scheme is far from bullet-proof, and can be hacked by an adversary or even broken by the OEMs themselves (if they are coerced to comply with law enforcement).<br />
<br />
I hope that by shedding light on the subject, this research will motivate OEMs and Google to come together and think of a more robust solution for FDE. I realise that in the Android ecosystem this is harder to guarantee, due to the multitude of OEMs. However, I believe a concentrated effort on both sides can help the next generation of Android devices be truly "uncrackable".
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
Posted by
<span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
<meta content='https://www.blogger.com/profile/00867710965331025912' itemprop='url'/>
<a class='g-profile' href='https://www.blogger.com/profile/00867710965331025912' rel='author' title='author profile'>
<span itemprop='name'>laginimaineb</span>
</a>
</span>
</span>
<span class='post-timestamp'>
at
<meta content='http://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html' itemprop='url'/>
<a class='timestamp-link' href='https://bits-please.blogspot.it/2016/06/extracting-qualcomms-keymaster-keys.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2016-06-30T15:00:00+03:00'>15:00</abbr></a>
</span>
<span class='reaction-buttons'>
</span>
<span class='post-comment-link'>
</span>
<span class='post-backlinks post-comment-link'>
</span>
<span class='post-icons'>
<span class='item-control blog-admin pid-1869888142'>
<a href='https://www.blogger.com/post-edit.g?blogID=2029700426505953971&postID=4923895734931327947&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=2029700426505953971&postID=4923895734931327947&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=2029700426505953971&postID=4923895734931327947&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=2029700426505953971&postID=4923895734931327947&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=2029700426505953971&postID=4923895734931327947&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=2029700426505953971&postID=4923895734931327947&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a><div class='goog-inline-block google-plus-share-container'><g:plusone source='blogger:blog:plusone' href='http://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html' size='medium' width='300' annotation='inline'/></div>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='https://bits-please.blogspot.it/search/label/Android' rel='tag'>Android</a>,
<a href='https://bits-please.blogspot.it/search/label/bruteforce' rel='tag'>bruteforce</a>,
<a href='https://bits-please.blogspot.it/search/label/bypass' rel='tag'>bypass</a>,
<a href='https://bits-please.blogspot.it/search/label/exploit' rel='tag'>exploit</a>,
<a href='https://bits-please.blogspot.it/search/label/fde' rel='tag'>fde</a>,
<a href='https://bits-please.blogspot.it/search/label/full%20disk%20encryption' rel='tag'>full disk encryption</a>,
<a href='https://bits-please.blogspot.it/search/label/keymaster' rel='tag'>keymaster</a>,
<a href='https://bits-please.blogspot.it/search/label/qsee' rel='tag'>qsee</a>,
<a href='https://bits-please.blogspot.it/search/label/Qualcomm' rel='tag'>Qualcomm</a>,
<a href='https://bits-please.blogspot.it/search/label/TrustZone' rel='tag'>TrustZone</a>,
<a href='https://bits-please.blogspot.it/search/label/TZ' rel='tag'>TZ</a>,
<a href='https://bits-please.blogspot.it/search/label/vulnerability' rel='tag'>vulnerability</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
<div class='comments' id='comments'>
<a name='comments'></a>
<h4>78 comments:</h4>
<div class='comments-content'>
<script async='async' src='//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js' type='text/javascript'></script>
<script type='text/javascript'>
    (function() {
      var items = [{'id': '7428272354616706188', 'body': 'Hey, I\x26#39;m the developer of hashcat. I\x26#39;d be happy to assist you adding the scrypt cracking portion to hashcat v3.00 to speed up the attack. Could you please create an issue on GitHub for it?', 'timestamp': '1467290026217', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467290026217#c7428272354616706188', 'author': {'name': 'Jens Steube', 'avatarUrl': '//lh5.googleusercontent.com/-cu84Fxo8lH8/AAAAAAAAAAI/AAAAAAAAAJE/B0w_a4mqevY/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/03645865529771558754'}, 'displayTime': '30/06/2016, 15:33', 'deleteclass': 'item-control blog-admin pid-174154407'}, {'id': '7553113789661496014', 'parentId': '7428272354616706188', 'body': 'Hi Jens,\x3cbr /\x3e\x3cbr /\x3eThank you very much! I\x26#39;ll create a feature request right away. Apart from the information in this blog post (regarding the structure of the KDF and how the key can be validated), is there any additional information I should add to the feature request? (Perhaps the crypto footer from my encrypted disk image and the corresponding keys, so that we can make sure the code works as expected). \x3cbr /\x3e\x3cbr /\x3eGal.', 'timestamp': '1467294573211', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467294573211#c7553113789661496014', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '30/06/2016, 16:49', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '2807220850249205492', 'parentId': '7428272354616706188', 'body': 'Hey Gal., from hashcat FAQ:\x3cbr /\x3e\x3cbr /\x3e* name of the algorithm/feature\x3cbr /\x3e* mention where the algorithm is currently being used (software, web app etc) or why the feature should be added\x3cbr /\x3e* source code or source code link\x3cbr /\x3e* mention any restrictions/limits or default lengths (maximum salt length, password length, &#8230;)\x3cbr /\x3e* several full example hash/plain pairs in case of a hashing algorithm\x3cbr /\x3e\x3cbr /\x3eEspecially the password lengths and salt lengths would be good to know and if there\x26#39;s any way for a user to modify existing configuration settings like iterations for cipher bitsizes.\x3cbr /\x3e\x3cbr /\x3eHowever, I was primarily contacting you because I want to make sure the hash format is \x26quot;standartized\x26quot;. The idea is to use your tool as it is but when it comes to the slow scrypt part, instead of cracking, it exports the required data so that hashcat (or any other tool) can work with it. Please add a suggestion, too', 'timestamp': '1467296342217', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467296342217#c2807220850249205492', 'author': {'name': 'Jens Steube', 'avatarUrl': '//lh5.googleusercontent.com/-cu84Fxo8lH8/AAAAAAAAAAI/AAAAAAAAAJE/B0w_a4mqevY/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/03645865529771558754'}, 'displayTime': '30/06/2016, 17:19', 'deleteclass': 'item-control blog-admin pid-174154407'}, {'id': '7991950604794943692', 'body': 'so by using this code you can break most android devices with relative ease? well the encryption part and then brute force the pin/password.... the brute forcing would be insanely quick wouldn\x26#39;t it? :/ this basically means android devices aren\x26#39;t secure at all', 'timestamp': '1467335524310', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467335524310#c7991950604794943692', 'author': {'name': 'Jos Spencer', 'avatarUrl': '//lh6.googleusercontent.com/-TTlKsYarWCg/AAAAAAAAAAI/AAAAAAAAcys/C1hLwKwgJYs/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/05576261429763962668'}, 'displayTime': '01/07/2016, 04:12', 'deleteclass': 'item-control blog-admin pid-2087814879'}, {'id': '5220779407270918135', 'body': 'so by using this code you can break most android devices with relative ease? well the encryption part and then brute force the pin/password.... the brute forcing would be insanely quick wouldn\x26#39;t it? :/ this basically means android devices aren\x26#39;t secure at all', 'timestamp': '1467335868298', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467335868298#c5220779407270918135', 'author': {'name': 'Jos Spencer', 'avatarUrl': '//lh6.googleusercontent.com/-TTlKsYarWCg/AAAAAAAAAAI/AAAAAAAAcys/C1hLwKwgJYs/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/05576261429763962668'}, 'displayTime': '01/07/2016, 04:17', 'deleteclass': 'item-control blog-admin pid-2087814879'}, {'id': '4208183834904439827', 'parentId': '7991950604794943692', 'body': 'ignorant...', 'timestamp': '1467336089892', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467336089892#c4208183834904439827', 'author': {'name': 'Unknown', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/17263817774470840964'}, 'displayTime': '01/07/2016, 04:21', 'deleteclass': 'item-control blog-admin pid-1860488182'}, {'id': '6398768391859686381', 'body': 'Is CopperHeadOS encryption hardening is a good mitigation for this vulnerability?\x3cbr /\x3e\x3cbr /\x3e\x26quot;Encryption and authentication\x3cbr /\x3e\x3cbr /\x3eFull disk encryption is enabled by default on all supported devices, not just those shipping that way with the stock operating system.\x3cbr /\x3eSupport for a separate encryption password\x3cbr /\x3e\x3cbr /\x3eIn vanilla Android, the encryption password is tied to the lockscreen password. That&#8217;s the default in CopperheadOS, but there&#8217;s full support for setting a separate encryption password. This allows for a convenient pattern, pin or password to be used for unlocking the screen while using a very strong encryption passphrase. If desired, the separate encryption password can be removed in favor of coupling it to the lockscreen password again.\x3cbr /\x3e\x3cbr /\x3eWhen a separate encryption password is set, the lockscreen will force a reboot after 5 failed unlocking attempts to force the entry of the encryption passphrase. This makes it possible to use a convenient unlocking method without brute force being feasible. It offers similar benefits as wiping after a given number of failures or using a fingerprint scanner without the associated drawbacks.\x3cbr /\x3eSupport for longer passwords\x3cbr /\x3e\x3cbr /\x3eThe maximum password length is raised from 16 characters to 32 characters.\x26quot;\x3cbr /\x3e\x3cbr /\x3ehttps://copperhead.co/android/docs/technical_overview', 'timestamp': '1467339940620', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467339940620#c6398768391859686381', 'author': {'name': 'CABROL PERALES Alexandre', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/03164300423365590354'}, 'displayTime': '01/07/2016, 05:25', 'deleteclass': 'item-control blog-admin pid-677315912'}, {'id': '815301570550927324', 'body': 'So the attacker still needs to brute force the PIN/PW. Therefore the best (perhaps only?) defense against this is to utilize a long and complex alphanumeric PW that will take an exorbitant amount of time to brute force attack, correct?', 'timestamp': '1467341352195', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467341352195#c815301570550927324', 'author': {'name': 'Alan Alanson', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/16992557022774026418'}, 'displayTime': '01/07/2016, 05:49', 'deleteclass': 'item-control blog-admin pid-1510912494'}, {'id': '4792450200440641518', 'parentId': '6398768391859686381', 'body': 'Very interested in the answer to this as this seems like it\x26#39;s potentially the best of both worlds. A strong encryption PW but relative ease of use is maintained.', 'timestamp': '1467341707398', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467341707398#c4792450200440641518', 'author': {'name': 'Alan Alanson', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/16992557022774026418'}, 'displayTime': '01/07/2016, 05:55', 'deleteclass': 'item-control blog-admin pid-1510912494'}, {'id': '9184694783287996318', 'parentId': '6398768391859686381', 'body': 'https://play.google.com/store/apps/details?id\x3dorg.nick.cryptfs.passwdmanager\x3cbr /\x3e\x3cbr /\x3eThis app appears to work similarly to the CopperheadOS in decoupling the encryption PW from the lock screen PIN or pattern. I\x26#39;m interested to hear any opinions on this app as it claims to work with any device where the CopperheadOS only works with a handful.', 'timestamp': '1467342454525', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467342454525#c9184694783287996318', 'author': {'name': 'Alan Alanson', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/16992557022774026418'}, 'displayTime': '01/07/2016, 06:07', 'deleteclass': 'item-control blog-admin pid-1510912494'}, {'id': '4426298030847558234', 'body': 'would a strong  password/pin protect against this attack?', 'timestamp': '1467348567955', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467348567955#c4426298030847558234', 'author': {'name': 'PWA', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/04567321311673661478'}, 'displayTime': '01/07/2016, 07:49', 'deleteclass': 'item-control blog-admin pid-181834258'}, {'id': '8789274541678392166', 'body': 'Multifactor Security... Something you know, something you have, something you are, someplace you are, etc. will always be more secure than just a password. PARTICULARLY if you get a trillion chances to guess.', 'timestamp': '1467361315120', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467361315120#c8789274541678392166', 'author': {'name': 'Drew', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/01176611245261635304'}, 'displayTime': '01/07/2016, 11:21', 'deleteclass': 'item-control blog-admin pid-732618603'}, {'id': '3992373381397599160', 'body': 'If I read this correctly, any specially crafted exploit code would need to either be signed by Qualcomm or an OEM, or would need to take advantage of an unpatched vulnerability on the device. Is that correct? If so, how is this different from iOS (beyond there being more players involved)?', 'timestamp': '1467381379321', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467381379321#c3992373381397599160', 'author': {'name': 'Unknown', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/11081920965227578697'}, 'displayTime': '01/07/2016, 16:56', 'deleteclass': 'item-control blog-admin pid-88011924'}, {'id': '8214130588717152197', 'parentId': '8789274541678392166', 'body': 'How would that apply to a disk encryption password? (I\x26#39;m curious)', 'timestamp': '1467381825103', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467381825103#c8214130588717152197', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '01/07/2016, 17:03', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '5430038918175272440', 'parentId': '3992373381397599160', 'body': 'In Apple\x26#39;s case you can\x26#39;t extract the hardware key no matter what software attack you carry out (w/ the OEMs or without). At most, you can bypass the software protections, but you\x26#39;ll still have to perform the bruteforce attempt strictly on the device.', 'timestamp': '1467381889696', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467381889696#c5430038918175272440', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '01/07/2016, 17:04', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '2787731266731598587', 'parentId': '4426298030847558234', 'body': 'Yes, if your password is strong enough, it could be infeasible to crack. Admittedly, mobile devices make this a little hard (who wants to type a long unique password on a mobile keyboard? Also, right now the lock screen password is the same password used for FDE. Imagine typing out a long password every time you unlock the device...)', 'timestamp': '1467381984635', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467381984635#c2787731266731598587', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '01/07/2016, 17:06', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '6101511453763884312', 'parentId': '815301570550927324', 'body': 'Definitely.', 'timestamp': '1467381999003', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467381999003#c6101511453763884312', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '01/07/2016, 17:06', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '4749961070907755825', 'parentId': '6398768391859686381', 'body': 'The CopperHeadOS solution is a good one, given that you do, in fact, choose a long complex password. BTW, it uses a feature of Android that\x26#39;s actually supported behind the scenes (vdc cryptfs changepw). This is the same feature that\x26#39;s used by Nikolay\x26#39;s application.', 'timestamp': '1467382100901', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467382100901#c4749961070907755825', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '01/07/2016, 17:08', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '609763366440228659', 'parentId': '5220779407270918135', 'body': 'That depends on the strength of the password you choose. Generally speaking, I wouldn\x26#39;t expect mobile devices to have strong passwords (but I don\x26#39;t have the data to back this claim).', 'timestamp': '1467382148784', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467382148784#c609763366440228659', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '01/07/2016, 17:09', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '8232847344321895013', 'parentId': '4426298030847558234', 'body': 'Nikolay Elenkov has an app that decouples the encryption password from the lockscreen pin/pw: https://play.google.com/store/apps/details?id\x3dorg.nick.cryptfs.passwdmanager\x3cbr /\x3eNeeds root, though.', 'timestamp': '1467409828495', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467409828495#c8232847344321895013', 'author': {'name': 'Unknown', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/03057090240025237860'}, 'displayTime': '02/07/2016, 00:50', 'deleteclass': 'item-control blog-admin pid-13829238'}, {'id': '5254429654910792125', 'parentId': '6398768391859686381', 'body': 'Alan Alamson: I have used that app on all CM versions since CM-11. It works. There was an issue with CM-13, because CM changed the vold cryptfs API call. But they fixed that eventually.\x3cbr /\x3e', 'timestamp': '1467436357186', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467436357186#c5254429654910792125', 'author': {'name': 'Unknown', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/03057090240025237860'}, 'displayTime': '02/07/2016, 08:12', 'deleteclass': 'item-control blog-admin pid-13829238'}, {'id': '8954680755350854855', 'body': 'if i set a long alphanumeric password and use my finger print to unlock the device would this still be vulnerable?\x3cbr /\x3eif i set my finger print to unlock the device i wouldnt have to type my password everytime', 'timestamp': '1467447356083', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467447356083#c8954680755350854855', 'author': {'name': 'Unknown', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/04269089454799671890'}, 'displayTime': '02/07/2016, 11:15', 'deleteclass': 'item-control blog-admin pid-732983686'}, {'id': '8226772719403811215', 'parentId': '8954680755350854855', 'body': 'You still have to enter the password while setting up the finger print on your device. It applies to every device yet!!!', 'timestamp': '1467476896277', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467476896277#c8226772719403811215', 'author': {'name': 'Gagan Jattana', 'avatarUrl': '//lh5.googleusercontent.com/-gQMKHhAUQWQ/AAAAAAAAAAI/AAAAAAAAAfo/gb7SL2zoa-8/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/12181751515421647053'}, 'displayTime': '02/07/2016, 19:28', 'deleteclass': 'item-control blog-admin pid-1123004229'}, {'id': '5330186468804790401', 'body': 'If you can\x26#39;t run this code unless the device is unlocked, should anyone actually worry?', 'timestamp': '1467478608389', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467478608389#c5330186468804790401', 'author': {'name': 'SIG_SEGV', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/11975361198651347062'}, 'displayTime': '02/07/2016, 19:56', 'deleteclass': 'item-control blog-admin pid-1470319324'}, {'id': '1507365853809396473', 'parentId': '8954680755350854855', 'body': '\x3cspan class\x3d\x27deleted-comment\x27\x3eThis comment has been removed by the author.\x3c/span\x3e', 'timestamp': '1467478754315', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467478754315#c1507365853809396473', 'author': {'name': 'Dekel Waxman', 'avatarUrl': '//lh5.googleusercontent.com/-PVAXos57wi0/AAAAAAAAAAI/AAAAAAAAACc/_YWAatmS28k/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/04269089454799671890'}, 'displayTime': '02/07/2016, 19:59', 'deleteclass': 'item-control blog-admin '}, {'id': '1989252048838030394', 'parentId': '8954680755350854855', 'body': 'yes but this vulnerability works because its easy to brute force the password hash.\x3cbr /\x3eso if my password is long it will be harder to brute force it', 'timestamp': '1467478863817', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467478863817#c1989252048838030394', 'author': {'name': 'Dekel Waxman', 'avatarUrl': '//lh5.googleusercontent.com/-PVAXos57wi0/AAAAAAAAAAI/AAAAAAAAACc/_YWAatmS28k/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/04269089454799671890'}, 'displayTime': '02/07/2016, 20:01', 'deleteclass': 'item-control blog-admin pid-732983686'}, {'id': '6855518007809849017', 'body': 'Good to know if we can extract keys for Samsung KNOX Container as well', 'timestamp': '1467581760969', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467581760969#c6855518007809849017', 'author': {'name': 'ss', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/10770973534276913019'}, 'displayTime': '04/07/2016, 00:36', 'deleteclass': 'item-control blog-admin pid-1219841773'}, {'id': '1125824357360897548', 'body': 'Suggestions.\x3cbr /\x3e\x3cbr /\x3e1. Code should be presented in a format allowing it to be copied-and-pasted.\x3cbr /\x3e\x3cbr /\x3e2. Technical terms in text should match those in illustrations. E.g., if text discusses UID, illustrations shold also mention UID.', 'timestamp': '1467591377899', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467591377899#c1125824357360897548', 'author': {'name': 'Administrator', 'avatarUrl': '//4.bp.blogspot.com/-5_otvJmPYDM/UsbrF8Tc3tI/AAAAAAAAABw/6Bxfouk5taE/s35/images%253Fq%253Dtbn%253AANd9GcTpACgA7eVvpZ3qQFKuOKXd-VVsgo7VPzsfjBNZlSjQqPxmiHjR', 'profileUrl': 'https://www.blogger.com/profile/01538572128166005974'}, 'displayTime': '04/07/2016, 03:16', 'deleteclass': 'item-control blog-admin pid-1240838951'}, {'id': '6133233215694854861', 'parentId': '3992373381397599160', 'body': 'Kind of curious about a couple things:\x3cbr /\x3e\x3cbr /\x3e1) How do you run the code for the Qualcomm exploit on a locked device?\x3cbr /\x3e2) With i OS being closed source, how do you know what goes on in the black box secure element?  Why is it impossible to get the hardware key?  You were only able to figure out most of this with Android being open source.', 'timestamp': '1467610870894', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467610870894#c6133233215694854861', 'author': {'name': 'Unknown', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/05247177760989842914'}, 'displayTime': '04/07/2016, 08:41', 'deleteclass': 'item-control blog-admin pid-1133036383'}, {'id': '2739773840051801379', 'body': 'Hi laginimaineb I\x26#39;d be very keen to speak with your regarding your blog writing, can you drop me an email from the contact form found on www.mpc-encryption.com \x3cbr /\x3e\x3cbr /\x3eMany thanks', 'timestamp': '1467647177349', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467647177349#c2739773840051801379', 'author': {'name': 'MPC SECURE', 'avatarUrl': '//lh3.googleusercontent.com/-io57ofafE1c/AAAAAAAAAAI/AAAAAAAAAEU/GACgigqXm18/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/07056794514444876902'}, 'displayTime': '04/07/2016, 18:46', 'deleteclass': 'item-control blog-admin pid-1307464613'}, {'id': '7837833027688303594', 'body': 'Thx a lot for your work and the info.\x3cbr /\x3e\x3cbr /\x3eIs there any additional protection (besides FDE) for data in an Android for Work \x26#39;container\x26#39;?\x3cbr /\x3e', 'timestamp': '1467831142478', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467831142478#c7837833027688303594', 'author': {'name': 'Art', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/03295972990248970162'}, 'displayTime': '06/07/2016, 21:52', 'deleteclass': 'item-control blog-admin pid-103269032'}, {'id': '2111335520043466192', 'body': 'I have a qualcomm processor on my Microsoft Lumia 950XL.  Is my phone easily breakable as well with it\x26#39;s FDE?', 'timestamp': '1467907347439', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467907347439#c2111335520043466192', 'author': {'name': 'Rob Kehl', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/09693294988916745216'}, 'displayTime': '07/07/2016, 19:02', 'deleteclass': 'item-control blog-admin pid-843725457'}, {'id': '1552853459927225926', 'parentId': '2111335520043466192', 'body': 'I don\x26#39;t know, but I don\x26#39;t think so. It depends on how FDE is implemented on Windows 10.', 'timestamp': '1467909879186', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467909879186#c1552853459927225926', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '07/07/2016, 19:44', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '4775212822014651442', 'parentId': '7837833027688303594', 'body': 'Sorry, I haven\x26#39;t done any research into \x26quot;Android for Work\x26quot;. But if you use a strong password for FDE, you should be okay.', 'timestamp': '1467909943152', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467909943152#c4775212822014651442', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '07/07/2016, 19:45', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '4233148242232958161', 'parentId': '1125824357360897548', 'body': 'Agreed, thank you for your input.', 'timestamp': '1467909980572', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467909980572#c4233148242232958161', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '07/07/2016, 19:46', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '2868845052450562897', 'parentId': '6855518007809849017', 'body': 'Who knows what the future holds :)', 'timestamp': '1467910015249', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467910015249#c2868845052450562897', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '07/07/2016, 19:46', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '6254013562092220636', 'body': 'Very fascinating post. There is one thing which I don\x26#39;t quite understand: \x26quot;Patching TrustZone vulnerabilities does not necessarily protect you from this issue.\x26quot; \x3cbr /\x3e\x3cbr /\x3eSuppose, (1) TrustZone is patched, and (2) the KeyMaster keys are derived from new and different hard-coded strings, and (3) user device is re-encrypted using the new KeyMaster keys. Wouldn\x26#39;t that fix the downgrading attack? P.S., I noticed that you used the phrase \x26quot;not necessarily\x26quot;, so I want to confirm with you that this problem can be solved by proper patches.', 'timestamp': '1467917747708', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467917747708#c6254013562092220636', 'author': {'name': 'Clone', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/07040691995913582552'}, 'displayTime': '07/07/2016, 21:55', 'deleteclass': 'item-control blog-admin pid-73355744'}, {'id': '1350483532216861779', 'body': 'Hello. I haven\x26#39;t heard yet about my question. I\x26#39;ve tried somewhat in vain to compile your code for my device, not of any fault of your own.\x3cbr /\x3e\x3cbr /\x3eBut I can\x26#39;t see that code running at fastboot or if the device is locked. While your code works I\x26#39;m sure, why should anyone worry if they can\x26#39;t do this on a locked device? Can you?', 'timestamp': '1467925381758', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467925381758#c1350483532216861779', 'author': {'name': 'SIG_SEGV', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/11975361198651347062'}, 'displayTime': '08/07/2016, 00:03', 'deleteclass': 'item-control blog-admin pid-1470319324'}, {'id': '2672295860129856632', 'parentId': '6254013562092220636', 'body': 'Thank you!\x3cbr /\x3e\x3cbr /\x3eRegarding your proposed patch - that still won\x26#39;t work. Remember that although I only extracted the generated keys in the exploit, you could just as easily modify it to use any pair of hard-coded strings as parameters for the KDF and to leak that result back to the Non-Secure World (since we have arbitrary code-exec in KeyMaster).\x3cbr /\x3e\x3cbr /\x3eThat said, a good patch could fix the issue by using a different scheme to bind the intermediate key (for example, using the hardware AES engine to encrypt the IK1 instead of KeyMaster - this has been proposed by people on droidsec). The problem is that any such patch would require a code change in Android (and some logic to handle transitioning from the old KDF to the new one), and that would break the cross-OEM compatibility of cryptfs.', 'timestamp': '1467925527712', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467925527712#c2672295860129856632', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '08/07/2016, 00:05', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '6185661081432792875', 'parentId': '1350483532216861779', 'body': 'Missed your question. Here are a couple of thoughts:\x3cbr /\x3e\x3cbr /\x3e1. If you can sign an image (you are an OEM/have the OEMs private key) - you don\x26#39;t need to bypass the lock screen.\x3cbr /\x3e2. If you can\x26#39;t sign an image, but can acquire the disk image (using forensic tools/a flash reader/special fastboot oem commands/recovery/etc.), then you can acquire the image, factory reset the device, and now run the full exploit chain to extract the keys and attack the encryption off the device.', 'timestamp': '1467925668149', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467925668149#c6185661081432792875', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '08/07/2016, 00:07', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '2130737123820908281', 'parentId': '5330186468804790401', 'body': '(answered your question below)', 'timestamp': '1467925735483', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467925735483#c2130737123820908281', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '08/07/2016, 00:08', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '8604893011420279123', 'parentId': '6254013562092220636', 'body': 'Thanks for your reply. I see the problem now. My understanding is that the KeyMaster keys are leaked and cannot be fixed by patching due to the reality. So the only approach is to protect the application key (e.g. FDE key) via some other way.\x3cbr /\x3e\x3cbr /\x3eI am wondering if your attack framework can be easily adapted to attack other sensitive data that are (supposedly) being protected by the hardware backed keystore, such as the application created keys in the Android keystore. Do you know the answer? \x3cbr /\x3e\x3cbr /\x3eAnother interesting asset would be the fingerprint template, which I guess is more likely to be protected by the SHK directly (hopefully).', 'timestamp': '1467930328692', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1467930328692#c8604893011420279123', 'author': {'name': 'Clone', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/07040691995913582552'}, 'displayTime': '08/07/2016, 01:25', 'deleteclass': 'item-control blog-admin pid-73355744'}, {'id': '8445032959115161273', 'parentId': '1350483532216861779', 'body': 'Would the key then be the same as last time since it was derived from the SHK instead of it directly? Or is it always constant? I wish I could test it out but I\x26#39;m not a programmer and while I did compile your code I can\x26#39;t figure out how to execute it or package it. I\x26#39;m assuming the same binary you used to test your Nexus 6 would work on my Nexus 7 2013 (no longer have my N5 to test with)? Could you send it to my email joe\x26amp;jstech.us? \x26amp; for at symbol?', 'timestamp': '1468028056371', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1468028056371#c8445032959115161273', 'author': {'name': 'SIG_SEGV', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/11975361198651347062'}, 'displayTime': '09/07/2016, 04:34', 'deleteclass': 'item-control blog-admin pid-1470319324'}, {'id': '1182882731098619550', 'parentId': '1350483532216861779', 'body': 'I suppose it works only for Nexus 6 platform. So called 5X commands of the Widevine trustlet are exploited to read/write arbitrary address of the secure world. Nexus 5/7/5x/6p never have such 5X commands. Hence you are not able to run that exploit on your Nexus 7.    ', 'timestamp': '1468055545389', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1468055545389#c1182882731098619550', 'author': {'name': 'AG', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/07678262743226260373'}, 'displayTime': '09/07/2016, 12:12', 'deleteclass': 'item-control blog-admin pid-1774026574'}, {'id': '5611761242009204786', 'body': 'What device was this tested on?  The manufacturer can limit the patches that are available.', 'timestamp': '1468442190991', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1468442190991#c5611761242009204786', 'author': {'name': 'Craig M', 'avatarUrl': '//lh4.googleusercontent.com/-Xfq17pECw2I/AAAAAAAAAAI/AAAAAAAADpo/INb2TtuDYg4/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/01337303053870570411'}, 'displayTime': '13/07/2016, 23:36', 'deleteclass': 'item-control blog-admin pid-1893217518'}, {'id': '7051752768119605515', 'body': 'This article says that the vulnerability was patched before the exploit was found.\x3cbr /\x3e\x3cbr /\x3ehttp://www.androidheadlines.com/2016/07/full-disk-encryption-vulnerability-found-android-devices.html', 'timestamp': '1468442253309', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1468442253309#c7051752768119605515', 'author': {'name': 'Craig M', 'avatarUrl': '//lh4.googleusercontent.com/-Xfq17pECw2I/AAAAAAAAAAI/AAAAAAAADpo/INb2TtuDYg4/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/01337303053870570411'}, 'displayTime': '13/07/2016, 23:37', 'deleteclass': 'item-control blog-admin pid-1893217518'}, {'id': '4119967819755357706', 'parentId': '5611761242009204786', 'body': 'This exploit was written on my personal Nexus 6. As for your second point - are you referring to the rollback prevention? If so, remember that all Nexus devices don\x26#39;t have it (to enable flashing any factory image), and many OEMs don\x26#39;t either. It\x26#39;s up to OEMs whether to enable it or not.', 'timestamp': '1468598371461', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1468598371461#c4119967819755357706', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '15/07/2016, 18:59', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '2047839198697846095', 'parentId': '7051752768119605515', 'body': 'I\x26#39;ve been informed that the vulnerability was found internally before I found it, but for some reason the OEMs failed to apply the patch.', 'timestamp': '1468598430974', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1468598430974#c2047839198697846095', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '15/07/2016, 19:00', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '2798440194460547273', 'parentId': '6254013562092220636', 'body': 'No problem. First of all, I\x26#39;ve written a script which can be used to decrypt any keystore key (incl. application created keys). You can find it here: https://github.com/laginimaineb/android_fde_bruteforce/blob/master/keymaster_mod.py\x3cbr /\x3e\x3cbr /\x3eAs for the fingerprint template - I believe it should be easily readable using a TrustZone exploit, since the fingerprint application is a trustlet which reads the fingerprint and matches it up to the stored template. I would do so myself but unfortunately I don\x26#39;t own a device with a fingerprint sensor.', 'timestamp': '1468598845319', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1468598845319#c2798440194460547273', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '15/07/2016, 19:07', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '1714214929934176534', 'body': 'Could comment if this vulnerability can be used for Samsung bootloader unlocking? I couldn\x26#39;t find any definitive answer elsewhere.. Thank you.', 'timestamp': '1468947812358', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1468947812358#c1714214929934176534', 'author': {'name': 'Headdy', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/14846181734999742095'}, 'displayTime': '19/07/2016, 20:03', 'deleteclass': 'item-control blog-admin pid-1837925046'}, {'id': '1104985237214076749', 'body': 'Can this code be executed on devices with stock firmware (no root access)?', 'timestamp': '1470724762659', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1470724762659#c1104985237214076749', 'author': {'name': 'Unknown', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/03147683011905503283'}, 'displayTime': '09/08/2016, 09:39', 'deleteclass': 'item-control blog-admin pid-200965700'}, {'id': '4340881369828013714', 'parentId': '1714214929934176534', 'body': 'Sorry, I can\x26#39;t see how this blog post relates to unlocking bootloaders.\x3cbr /\x3e\x3cbr /\x3eDepending on how Samsung\x26#39;s bootloader is locked, perhaps you could use the TrustZone vulnerabilities that I\x26#39;ve disclosed in order to bypass secure boot, but I haven\x26#39;t researched this and so can\x26#39;t provide a definite answer.', 'timestamp': '1471636929791', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1471636929791#c4340881369828013714', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '19/08/2016, 23:02', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '4046802134863219397', 'body': 'My OPO was soft bricked because of the encryption when i was trying to upgrade to CM13. Will this help to bypass the \x26quot;boot\x26quot; screen whereby it requests for password? \x3cbr /\x3e\x3cbr /\x3eI have two years of data that i need to recover, searched for solutions online requested aid from CM but no avail.\x3cbr /\x3e\x3cbr /\x3eRegards', 'timestamp': '1473945522194', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1473945522194#c4046802134863219397', 'author': {'name': 'Slevin Gaius', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/11838610995901259393'}, 'displayTime': '15/09/2016, 16:18', 'deleteclass': 'item-control blog-admin pid-1099775291'}, {'id': '3249746336254256547', 'body': 'Hi Gal , Great post as usual. \x3cbr /\x3e\x3cbr /\x3eI wonder about your philosophy(or conception) behind the act of sharing this code(scripts , mainly) with everyone. Raising awareness to this issue is important. But this is an unfixed  issue, which is definitely explosive and might be used by  \x26quot;script kids\x26quot; .  And it requires not a tiny effort to make it work (based on just the blog). \x3cbr /\x3e\x3cbr /\x3eYou can also reply in private , or not reply at all.\x3cbr /\x3e\x3cbr /\x3eRegards,\x3cbr /\x3eKarni ', 'timestamp': '1476188420049', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1476188420049#c3249746336254256547', 'author': {'name': 'Unknown', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/06917751465682252365'}, 'displayTime': '11/10/2016, 15:20', 'deleteclass': 'item-control blog-admin pid-1868211907'}, {'id': '2009347919869559340', 'body': 'For a complete newb, I\x26#39;ve tried to tinker with this, but there is simply a knowledge gap (programming) that I haven\x26#39;t been able to overcome, let\x26#39;s get straight to it!\x3cbr /\x3e\x3cbr /\x3eSo far, I\x26#39;ve downloaded the following:\x3cbr /\x3e1. Android Studio\x3cbr /\x3e2. Python (command line)\x3cbr /\x3e3. Minimal ADB and fastboot. \x3cbr /\x3e\x3cbr /\x3eI have also done the following:\x3cbr /\x3e1. Downloaded the USB drivers (within Android studio and zip file) \x3cbr /\x3e2. Started in bootloader mode (power button and volume down)\x3cbr /\x3e\x3cbr /\x3eSo here are my main questions:\x3cbr /\x3e1. If you don\x26#39;t have USB debugging turned ahead of time and you\x26#39;re trying to communicate to the phone via USB how do you make that happen? Am I assuming too much why saying communicating via USB? \x3cbr /\x3e2. What tools are used to run the Python scripts on the android phone? \x3cbr /\x3e3. What makes that handshake happen without previously setting something up on the phone? \x3cbr /\x3e\x3cbr /\x3eI\x26#39;m pretty lost and I swear I\x26#39;ve given it my best, but the knowledge gap is huge, just trying to learn. Throw a dog a bone! Thanks! Please help. :) \x3cbr /\x3e \x3cbr /\x3e\x3cbr /\x3e', 'timestamp': '1476742464777', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1476742464777#c2009347919869559340', 'author': {'name': 'Thunder', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/07112700854527761292'}, 'displayTime': '18/10/2016, 01:14', 'deleteclass': 'item-control blog-admin pid-1496786157'}, {'id': '5802345653460816857', 'parentId': '3249746336254256547', 'body': 'Hi Karni,\x3cbr /\x3e\x3cbr /\x3eGood to hear from you! How are you doing?\x3cbr /\x3e\x3cbr /\x3eMy rationale for publishing this kind of research is twofold:\x3cbr /\x3e \x3cbr /\x3e 1. I believe in this case publishing the research could help push for a stronger FDE scheme. Currently, the advertised feature is not working as people would expect it to. Being a security-focused feature, this could have serious consequences for someone relying on FDE for their own personal safety. At the very least, people have the right to be informed. Had there been a fix on the way, I might have postponed publication. However, as you can see, the issue remains, and is present in all current devices. To the best of my knowledge this situation doesn\x26#39;t seem like it\x26#39;s going to change anytime soon.\x3cbr /\x3e\x3cbr /\x3e 2. Research needs to be (fully) verifiable. Just as any academic research paper must publish the complete method along with the results - security research shouldn\x26#39;t be any different. It\x26#39;s hard to do research in vacuum, and publishing results along with methods should help alleviate that.\x3cbr /\x3e\x3cbr /\x3eGal.', 'timestamp': '1476785900531', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1476785900531#c5802345653460816857', 'author': {'name': 'Gal Beniamini', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/01234036203079051373'}, 'displayTime': '18/10/2016, 13:18', 'deleteclass': 'item-control blog-admin pid-152373306'}, {'id': '8855917887345931689', 'body': 'Hi laginimaineb, what a great article !\x3cbr /\x3e\x3cbr /\x3eI\x26#39;ve compiled your sources from github and executed them on my Moto G LTE (MSM 8x26), and obviously it didn\x26#39;t work from the get go.\x3cbr /\x3e\x3cbr /\x3eI\x26#39;ve first had to change the path to the firmware files (no biggie), but now I think I need deeper changes, such as the start address of the secure region, and probably many other constants..\x3cbr /\x3e\x3cbr /\x3eWould you mind explaining how you deducted what the secure app region start address was on shamu ? I would like to apply that process to find the start address on my phone.\x3cbr /\x3e\x3cbr /\x3eThanks!\x3cbr /\x3e', 'timestamp': '1477536485482', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1477536485482#c8855917887345931689', 'author': {'name': 'Maxime Jourdan', 'avatarUrl': '//lh4.googleusercontent.com/-JGEwNJ-8Lak/AAAAAAAAAAI/AAAAAAAAAFc/do2Zaz8-vmk/s35-c/photo.jpg', 'profileUrl': 'https://www.blogger.com/profile/01466040431775523017'}, 'displayTime': '27/10/2016, 05:48', 'deleteclass': 'item-control blog-admin pid-1643073213'}, {'id': '5365896378821373782', 'body': 'hi&#65292;laginimaineb&#65292;There is one thing which I don\x26#39;t quite understand&#65292;how do you know that In Apple\x26#39;s case you can\x26#39;t extract the hardware key no matter what software attack you carry out (w/ the OEMs or without). I don\x26#39;t think the use shk is the key point.if the the encryption scheme&#65288;kemaster&#65289;implemented with software that possibly can be hacked,you are still to get the shk.There is no evidence to prove the encryption scheme&#65288;kemaster&#65289; in ios run in a isolate hardware different from the implemention of tee in arm.', 'timestamp': '1482296810814', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1482296810814#c5365896378821373782', 'author': {'name': 'kingson', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/13817919605757672826'}, 'displayTime': '21/12/2016, 07:06', 'deleteclass': 'item-control blog-admin pid-1624108397'}, {'id': '1489326723981469384', 'parentId': '5365896378821373782', 'body': 'Hi Kingston,\x3cbr /\x3e\x3cbr /\x3eThank you for reading!\x3cbr /\x3e\x3cbr /\x3eRegarding the UID key - Apple claims in the iOS security guide that it is implemented in HW and cannot be accessed via SW or FW in any way. IIRC, Comex has also verified this by inspecting the AES engine.\x3cbr /\x3e\x3cbr /\x3eAs for the SHK - that key is implemented as part of the crypto engine. As the engine\x26#39;s inner working are completely opaque, it\x26#39;s hard to say whether or not it can be extracted by a SW attack. To the best of my knowledge, this should not be possible.\x3cbr /\x3e\x3cbr /\x3eAll the best,\x3cbr /\x3eGal.', 'timestamp': '1483376086295', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1483376086295#c1489326723981469384', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '02/01/2017, 18:54', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '6786798181683600407', 'parentId': '8855917887345931689', 'body': 'Hi Maxime,\x3cbr /\x3e\x3cbr /\x3eThank you for the kind words. You can find the start address of the secapp region by inspecting the dmesg output - the region is a part of the kernel dtb, and its address is printed when the device boots.\x3cbr /\x3e\x3cbr /\x3eAll the best,\x3cbr /\x3eGal.', 'timestamp': '1483376227043', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1483376227043#c6786798181683600407', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '02/01/2017, 18:57', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '5487678922176415947', 'body': 'Hi gal greetings from kerala\x3cbr /\x3e\x3cbr /\x3eYour the man came to break oem closed wall.we can now enter another world.\x3cbr /\x3e\x3cbr /\x3e   I had been trying to decrypt and reflash modem and wifi firmwire.\x3cbr /\x3e\x3cbr /\x3eBut stucked because qcom encryption.\x3cbr /\x3e\x3cbr /\x3eHow i apply your exploit.\x3cbr /\x3e\x3cbr /\x3e\x3cbr /\x3e\x3cbr /\x3e', 'timestamp': '1485119388175', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1485119388175#c5487678922176415947', 'author': {'name': 'thayyil abhi', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/08484840529807605282'}, 'displayTime': '22/01/2017, 23:09', 'deleteclass': 'item-control blog-admin pid-1999604216'}, {'id': '6231510109471167207', 'body': 'Hi, Congrats for your work.\x3cbr /\x3e\x3cbr /\x3eJust one simple question, the key inside the crypto engine is the same for all devices? If yes, and taking into account the two strings are hardcoded, this will mean that all devices will generate the same Master key?\x3cbr /\x3e\x3cbr /\x3eChris', 'timestamp': '1486646229077', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1486646229077#c6231510109471167207', 'author': {'name': 'Chris', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/14718264764584209377'}, 'displayTime': '09/02/2017, 15:17', 'deleteclass': 'item-control blog-admin pid-39349995'}, {'id': '8536421934191064804', 'parentId': '6231510109471167207', 'body': 'Thank you! The SHK is unique per device, so no two devices should generate the same master key (w.h.p).', 'timestamp': '1486656442165', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1486656442165#c8536421934191064804', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '09/02/2017, 18:07', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '8237621152290860920', 'body': 'What about encryption? and is it that easy to break into any cell phone? don\x26#39;t you think this will encourage people to snatch and break into the phone and sale it?.', 'timestamp': '1487105089388', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1487105089388#c8237621152290860920', 'author': {'name': '\x3ca href\x3d\x22http://www.auresumereviews.com/\x22 rel\x3d\x22nofollow\x22\x3eauresumereviews.com\x3c/a\x3e', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/02937694470430285718'}, 'displayTime': '14/02/2017, 22:44', 'deleteclass': 'item-control blog-admin pid-205881921'}, {'id': '920002122688327734', 'parentId': '8237621152290860920', 'body': 'What about encryption? I\x26#39;m not sure what you mean. As for the second point - on the contrary, I believe finding and fixing vulnerabilities is important to help keep devices secure.', 'timestamp': '1487443904047', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1487443904047#c920002122688327734', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '18/02/2017, 20:51', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '4616184270459778115', 'body': 'Hi laginimaineb,\x3cbr /\x3e\x3cbr /\x3ecould please explain how to extract footer.bin (crypto footer) for Nexus 6 device?\x3cbr /\x3e\x3cbr /\x3els -al /dev/block/platform/msm_sdcc.1/by-name/\x3cbr /\x3e   - keystore -\x26gt; /dev/block/mmcblk0p24\x3cbr /\x3e\x3cbr /\x3eShould I just copy this partition as it is?\x3cbr /\x3e\x3cbr /\x3eThank you', 'timestamp': '1488297470505', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1488297470505#c4616184270459778115', 'author': {'name': 'Karthik k', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/18126006082885571330'}, 'displayTime': '28/02/2017, 17:57', 'deleteclass': 'item-control blog-admin pid-22887734'}, {'id': '819366530903306865', 'parentId': '4616184270459778115', 'body': 'Hi Karthik,\x3cbr /\x3e\x3cbr /\x3eYes, it\x26#39;s stored in one of the partitions on the Nexus 6, but unfortunately I can\x26#39;t remember which... If you can dump the ls output for by-name here, I\x26#39;ll tell you which it is.\x3cbr /\x3e\x3cbr /\x3eGal.', 'timestamp': '1488473453053', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1488473453053#c819366530903306865', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '02/03/2017, 18:50', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '1745422176919213593', 'parentId': '4616184270459778115', 'body': 'Hi laginimaineb, \x3cbr /\x3e\x3cbr /\x3eThanks again for the reply. I figured out /dev/block/platform/msm_sdcc.1/by-name/metadata is the crypto footer partition for Nexus 6.\x3cbr /\x3e\x3cbr /\x3eI have another question, could you please help me with this? \x3cbr /\x3e\x3cbr /\x3eI flashed the vulnerable firmware image, and leaked the Encryption key and HMAC key using your exploit. Now I am testing whether it is possible to brutefore pin of a patched Android version say Android 6. \x3cbr /\x3e\x3cbr /\x3e1. So I flashed the Android 6 to my device\x3cbr /\x3e2. set a new password.\x3cbr /\x3e3. extracted the crypto footer from it\x3cbr /\x3e\x3cbr /\x3eThen I was trying to bruteforce the password of Android version 6 using your script, but it failed.\x3cbr /\x3e\x3cbr /\x3e1. First it threw invalid HMAC mismatch! error\x3cbr /\x3e    -\x26gt; Reason for this could be that this version of firmware is using a different HMAC key? correct?\x3cbr /\x3e\x3cbr /\x3eI anyway ignored the HMAC validation part. \x3cbr /\x3e\x3cbr /\x3e2. Then it threw \x26quot;invalid encryption key\x26quot; error. \x3cbr /\x3e   -\x26gt; Does this mean this version of firmware is using a different encryption key? From your blog I understood that the hardware keys cannot be changed; however, they might have changed the salt used to create the master from hardware key for this version? Making it to impossible to bruteforce pin for a patched version? This is a valid patch from Google, correct?\x3cbr /\x3e\x3cbr /\x3eNow we need to either find a new trustzone kernel vuln to leak the encryption key for latest firmware version. Reversing the Keymaster trustlet and figuring out the new encryption key used for a new version is not possible, right?  \x3cbr /\x3e\x3cbr /\x3eThanks again', 'timestamp': '1488723253607', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1488723253607#c1745422176919213593', 'author': {'name': 'Karthik k', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/18126006082885571330'}, 'displayTime': '05/03/2017, 16:14', 'deleteclass': 'item-control blog-admin pid-22887734'}, {'id': '7495006173707630726', 'parentId': '4616184270459778115', 'body': 'Hi Karthik,\x3cbr /\x3e\x3cbr /\x3eYes, you\x26#39;re right that it\x26#39;s the \x26quot;metadata\x26quot; partition, I forgot about that.\x3cbr /\x3e\x3cbr /\x3eI think the reason you\x26#39;re seeing errors is *not* that the key is somehow changed (remember, the SHK is *constant*), but rather that the format of the KeyMaster keyblob may be different in the newer versions. Remember that what I demonstrated was for KeyMaster version 1, which was what was used at the time. I believe the format used in newer versions is slightly different.\x3cbr /\x3e\x3cbr /\x3eHere\x26#39;s what I suggest: take the key-blob and output the second DWORD (version_num), and post that value here. Then we could see whether it\x26#39;s just a matter of adding support in the script itself, or whether the KDF in the KeyMaster TA has been changed in newer versions.\x3cbr /\x3e\x3cbr /\x3eAll the best,\x3cbr /\x3eGal.', 'timestamp': '1489259902829', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1489259902829#c7495006173707630726', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '11/03/2017, 21:18', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '7142259454261294274', 'parentId': '4616184270459778115', 'body': 'Hi laginimaineb,\x3cbr /\x3e\x3cbr /\x3e\x3cbr /\x3e(Pdb) print keyblob\x3cbr /\x3e{\x26#39;version_num\x26#39;: 0, \x26#39;encrypted_private_exponent\x26#39;: \x26quot;\\x1d2\\x13O\\x98\\n`Y\\...\x3cbr /\x3e\x3cbr /\x3eIt says, key blob version is \x26#39;0\x26#39;. Here is the complete output. https://gist.github.com/anonymous/561e6c94bc565f56c48b5b57cc0e684e\x3cbr /\x3e\x3cbr /\x3eAlso, I see keyblob version as \x26#39;0\x26#39; (same) in the vulnerable version (Android 5.1). But private key exponent size is huge for Android version 6. Gist for vulnerable version of Android is here https://gist.github.com/anonymous/b7d11bb76b95a5f03e482ad55dadd039.\x3cbr /\x3e\x3cbr /\x3eYes, I understand SHK is constant, but here we are using KEK. So, KEK might have changed for the newer version of Firmware, right? May be they might have just changed  two hardcoded strings used to generate KEK from SHK. \x3cbr /\x3e\x3cbr /\x3eKEK is here https://gist.github.com/anonymous/44dbe8882693df0accacbb7204711e8e\x3cbr /\x3e\x3cbr /\x3eHere is the metadata partition for Android 6, if you would like to have a look at it.\x3cbr /\x3ehttps://dropfile.to/6YWWg15 accesskey:bAGpDKG \x3cbr /\x3e\x3cbr /\x3eThank you,\x3cbr /\x3eKarthik', 'timestamp': '1489332722739', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1489332722739#c7142259454261294274', 'author': {'name': 'Karthik k', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/18126006082885571330'}, 'displayTime': '12/03/2017, 17:32', 'deleteclass': 'item-control blog-admin pid-22887734'}, {'id': '8153010807281157292', 'parentId': '4616184270459778115', 'body': 'Hi Karthik,\x3cbr /\x3e\x3cbr /\x3eYes, these are all valid options. My initial thought was that the keyblob format must have changed. Anyway, I looked at the trustlet in the newer version, it seems to use the same hardcoded strings, so unless something around the key derivation changed, this is rather strange.\x3cbr /\x3e\x3cbr /\x3eI tried to download the metadata partition in the link you sent, but it already expired. Could you send it over again? I\x26#39;ll take a look.\x3cbr /\x3e\x3cbr /\x3eThanks,\x3cbr /\x3eGal.', 'timestamp': '1489695460331', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1489695460331#c8153010807281157292', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '16/03/2017, 22:17', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '1945434757639676396', 'body': 'Hi laginimaineb,\x3cbr /\x3e\x3cbr /\x3eThis is an incredibly informative article and I admire the effort you\x26#39;ve put in to find this exploit. I\x26#39;m trying to execute it on a Nexus 6P running Marshmallow (specifically 6.0 security patch level Nov 1, 2015). I\x26#39;ve compiled your code and have it running on a rooted device. However, it seems to be failing to find the widevine application in the secure memory region. I\x26#39;ve modified the start address of the secure memory region per my dmesg output:\x3cbr /\x3e\x3cbr /\x3eadb shell dmesg | grep secure\x3cbr /\x3e[    0.000000] cma: Found secure_region@0, memory base 0x0000000000000000, size 300 MiB, limit 0xffffffffffffffff\x3cbr /\x3e[    0.000000] cma: CMA: reserved 300 MiB at 0x00000000cd400000 for secure_mem\x3cbr /\x3e\x3cbr /\x3eHere\x26#39;s the output of the execution:\x3cbr /\x3e/data/local/tmp/extract_keymaster\x3cbr /\x3e[+] Widevine load res: 0\x3cbr /\x3e[+] Keymaster load res: 0\x3cbr /\x3e[+] Trying to probe 0xCD42D000\x3cbr /\x3e[+] Didn\x26#39;t crash, starting to scan linearly\x3cbr /\x3e[+] Scanning page CD42D000 for sync pattern\x3cbr /\x3e[-] Unknown deriviation result: 29, aborting!\x3cbr /\x3e[+] Crashed in linear scan, jumping ahead\x3cbr /\x3e...\x3cbr /\x3e[+] Trying to probe 0xDF1FF000\x3cbr /\x3e[+] Didn\x26#39;t crash, starting to scan linearly\x3cbr /\x3e[+] Scanning page DF1FF000 for sync pattern\x3cbr /\x3e[-] Unknown deriviation result: 29, aborting!\x3cbr /\x3e[+] Crashed in linear scan, jumping ahead\x3cbr /\x3e[-] Failed to find application\x3cbr /\x3e\x3cbr /\x3eHere is my git diff as well:\x3cbr /\x3e\x3cbr /\x3egit diff\x3cbr /\x3ediff --git a/jni/Application.mk b/jni/Application.mk\x3cbr /\x3eindex 4337f7c..f01ebf5 100644\x3cbr /\x3e--- a/jni/Application.mk\x3cbr /\x3e+++ b/jni/Application.mk\x3cbr /\x3e@@ -1 +1,2 @@\x3cbr /\x3e APP_PLATFORM :\x3d android-16\x3cbr /\x3e+APP_ABI :\x3d armeabi #arm64-v8a\x3cbr /\x3ediff --git a/jni/defs.h b/jni/defs.h\x3cbr /\x3eindex 3900bed..8afe874 100644\x3cbr /\x3e--- a/jni/defs.h\x3cbr /\x3e+++ b/jni/defs.h\x3cbr /\x3e@@ -14,12 +14,12 @@\x3cbr /\x3e /**\x3cbr /\x3e  * The path to the widevine application\x3cbr /\x3e  */\x3cbr /\x3e-#define WIDEVINE_PATH (\x26quot;/vendor/firmware\x26quot;)\x3cbr /\x3e+#define WIDEVINE_PATH (\x26quot;/system/vendor/firmware\x26quot;)\x3cbr /\x3e\x3cbr /\x3e /**\x3cbr /\x3e  * The path to the keymaster application.\x3cbr /\x3e  */\x3cbr /\x3e-#define KEYMASTER_PATH (\x26quot;/vendor/firmware/keymaster\x26quot;)\x3cbr /\x3e+#define KEYMASTER_PATH (\x26quot;/dev/block/mmcblk0p24\x26quot;) ///vendor/firmware/keymaster\x3cbr /\x3e\x3cbr /\x3e /**\x3cbr /\x3e  * The name of the widevine application\x3cbr /\x3ediff --git a/jni/symbols.h b/jni/symbols.h\x3cbr /\x3eindex 2f3769b..673b3f4 100644\x3cbr /\x3e--- a/jni/symbols.h\x3cbr /\x3e+++ b/jni/symbols.h\x3cbr /\x3e@@ -14,12 +14,12 @@\x3cbr /\x3e /**\x3cbr /\x3e  * The start address of the secure app region (on shamu)\x3cbr /\x3e  */\x3cbr /\x3e-#define SECURE_APP_REGION_START (0xD600000)\x3cbr /\x3e+#define SECURE_APP_REGION_START (0xcd400000)\x3cbr /\x3e\x3cbr /\x3e /**\x3cbr /\x3e  * The size of the secure app region\x3cbr /\x3e  */\x3cbr /\x3e-#define SECURE_APP_REGION_SIZE (0x500000)\x3cbr /\x3e+#define SECURE_APP_REGION_SIZE (0x11E1A300) // (0x500000)\x3cbr /\x3e\x3cbr /\x3eIt looks like the scan just can\x26#39;t find where it\x26#39;s located in the secure memory region? Am I missing other values I should modify? Is the Nexus 6P being 64bit perhaps causing issues? Would really appreciate some help on this.\x3cbr /\x3e\x3cbr /\x3eThanks', 'timestamp': '1491087860871', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1491087860871#c1945434757639676396', 'author': {'name': 'Unknown', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/17768758405050233161'}, 'displayTime': '02/04/2017, 02:04', 'deleteclass': 'item-control blog-admin pid-269233671'}, {'id': '7489604684026705976', 'body': 'Hello,\x3cbr /\x3ewhen I encrypt my phone using a patched Android version, is the encrpytion still vulnerable for a downgrade attack by flashing to a vulnerable Android version? Then all these Qualcomm CPU&#180;s would be vulnerable forever....', 'timestamp': '1491958570881', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1491958570881#c7489604684026705976', 'author': {'name': 'jimmydo', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/03999668448432084460'}, 'displayTime': '12/04/2017, 03:56', 'deleteclass': 'item-control blog-admin pid-1120927031'}, {'id': '7745830541308941192', 'parentId': '1945434757639676396', 'body': 'Hi,\x3cbr /\x3e\x3cbr /\x3eHave you checked whether the Widevine trustlet on the Nexus 6P is vulnerable to the PRDiag vulnerability? If I recall correctly, the affected code was removed from the trustlet that shipped on the Nexus 6P.\x3cbr /\x3e\x3cbr /\x3eAll the best,\x3cbr /\x3eGal.', 'timestamp': '1497815874870', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1497815874870#c7745830541308941192', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '18/06/2017, 22:57', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '6561628012932100659', 'body': 'Hi, \x3cbr /\x3e   What happens if the motherboard of the phone is replaced. Will this approach work?', 'timestamp': '1507564225476', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1507564225476#c6561628012932100659', 'author': {'name': 'Anirban', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/13726103556438574778'}, 'displayTime': '09/10/2017, 18:50', 'deleteclass': 'item-control blog-admin pid-1408150783'}, {'id': '6425101334167561716', 'parentId': '6561628012932100659', 'body': 'Hi,\x3cbr /\x3e\x3cbr /\x3eI would imagine that replacing the SoC would imply replacing the hardware fuses as well, so the SHK would be different (therefore the approach would not work, as the KDF is bound to the SHK).\x3cbr /\x3e\x3cbr /\x3eAll the best,\x3cbr /\x3eGal.', 'timestamp': '1507564415683', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1507564415683#c6425101334167561716', 'author': {'name': 'laginimaineb', 'avatarUrl': '//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg', 'profileUrl': 'https://www.blogger.com/profile/00867710965331025912'}, 'displayTime': '09/10/2017, 18:53', 'deleteclass': 'item-control blog-admin pid-1869888142'}, {'id': '5406165508474166476', 'parentId': '1945434757639676396', 'body': '\x3cspan class\x3d\x27deleted-comment\x27\x3eThis comment has been removed by the author.\x3c/span\x3e', 'timestamp': '1512533085199', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1512533085199#c5406165508474166476', 'author': {'name': 'Josh Cowan', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/05870681509316487664'}, 'displayTime': '06/12/2017, 06:04', 'deleteclass': 'item-control blog-admin '}, {'id': '6689970706959498264', 'parentId': '1945434757639676396', 'body': 'I tried using \x26quot;grep -r PRDiag /\x26quot; and it didn\x26#39;t work so I believe this won\x26#39;t work on a nexus 6P', 'timestamp': '1512533677659', 'permalink': 'https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment\x3d1512533677659#c6689970706959498264', 'author': {'name': 'Unknown', 'avatarUrl': '//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA\x3ds35', 'profileUrl': 'https://www.blogger.com/profile/17768758405050233161'}, 'displayTime': '06/12/2017, 06:14', 'deleteclass': 'item-control blog-admin pid-269233671'}];
      var msgs = {'loadMore': 'Load more...', 'loading': 'Loading...', 'loaded': 'No more.', 'addComment': 'Add comment', 'reply': 'Reply', 'delete': 'Delete'};
      var config = {'blogId': '2029700426505953971', 'postId': '4923895734931327947', 'feed': 'https://bits-please.blogspot.com/feeds/4923895734931327947/comments/default', 'authorName': 'laginimaineb', 'authorUrl': 'https://www.blogger.com/profile/00867710965331025912', 'baseUri': 'https://www.blogger.com', 'maxThreadDepth': 2};

// <![CDATA[
      var cursor = null;
      if (items && items.length > 0) {
        cursor = parseInt(items[items.length - 1].timestamp) + 1;
      }

      var bodyFromEntry = function(entry) {
        var text = (entry &&
                    ((entry.content && entry.content.$t) ||
                     (entry.summary && entry.summary.$t))) ||
            '';
        if (entry && entry.gd$extendedProperty) {
          for (var k in entry.gd$extendedProperty) {
            if (entry.gd$extendedProperty[k].name == 'blogger.contentRemoved') {
              return '<span class="deleted-comment">' + text + '</span>';
            }
          }
        }
        return text;
      }

      var parse = function(data) {
        cursor = null;
        var comments = [];
        if (data && data.feed && data.feed.entry) {
          for (var i = 0, entry; entry = data.feed.entry[i]; i++) {
            var comment = {};
            // comment ID, parsed out of the original id format
            var id = /blog-(\d+).post-(\d+)/.exec(entry.id.$t);
            comment.id = id ? id[2] : null;
            comment.body = bodyFromEntry(entry);
            comment.timestamp = Date.parse(entry.published.$t) + '';
            if (entry.author && entry.author.constructor === Array) {
              var auth = entry.author[0];
              if (auth) {
                comment.author = {
                  name: (auth.name ? auth.name.$t : undefined),
                  profileUrl: (auth.uri ? auth.uri.$t : undefined),
                  avatarUrl: (auth.gd$image ? auth.gd$image.src : undefined)
                };
              }
            }
            if (entry.link) {
              if (entry.link[2]) {
                comment.link = comment.permalink = entry.link[2].href;
              }
              if (entry.link[3]) {
                var pid = /.*comments\/default\/(\d+)\?.*/.exec(entry.link[3].href);
                if (pid && pid[1]) {
                  comment.parentId = pid[1];
                }
              }
            }
            comment.deleteclass = 'item-control blog-admin';
            if (entry.gd$extendedProperty) {
              for (var k in entry.gd$extendedProperty) {
                if (entry.gd$extendedProperty[k].name == 'blogger.itemClass') {
                  comment.deleteclass += ' ' + entry.gd$extendedProperty[k].value;
                } else if (entry.gd$extendedProperty[k].name == 'blogger.displayTime') {
                  comment.displayTime = entry.gd$extendedProperty[k].value;
                }
              }
            }
            comments.push(comment);
          }
        }
        return comments;
      };

      var paginator = function(callback) {
        if (hasMore()) {
          var url = config.feed + '?alt=json&v=2&orderby=published&reverse=false&max-results=50';
          if (cursor) {
            url += '&published-min=' + new Date(cursor).toISOString();
          }
          window.bloggercomments = function(data) {
            var parsed = parse(data);
            cursor = parsed.length < 50 ? null
                : parseInt(parsed[parsed.length - 1].timestamp) + 1
            callback(parsed);
            window.bloggercomments = null;
          }
          url += '&callback=bloggercomments';
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url;
          document.getElementsByTagName('head')[0].appendChild(script);
        }
      };
      var hasMore = function() {
        return !!cursor;
      };
      var getMeta = function(key, comment) {
        if ('iswriter' == key) {
          var matches = !!comment.author
              && comment.author.name == config.authorName
              && comment.author.profileUrl == config.authorUrl;
          return matches ? 'true' : '';
        } else if ('deletelink' == key) {
          return config.baseUri + '/delete-comment.g?blogID='
               + config.blogId + '&postID=' + comment.id;
        } else if ('deleteclass' == key) {
          return comment.deleteclass;
        }
        return '';
      };

      var replybox = null;
      var replyUrlParts = null;
      var replyParent = undefined;

      var onReply = function(commentId, domId) {
        if (replybox == null) {
          // lazily cache replybox, and adjust to suit this style:
          replybox = document.getElementById('comment-editor');
          if (replybox != null) {
            replybox.height = '250px';
            replybox.style.display = 'block';
            replyUrlParts = replybox.src.split('#');
          }
        }
        if (replybox && (commentId !== replyParent)) {
          replybox.src = '';
          document.getElementById(domId).insertBefore(replybox, null);
          replybox.src = replyUrlParts[0]
              + (commentId ? '&parentID=' + commentId : '')
              + '#' + replyUrlParts[1];
          replyParent = commentId;
        }
      };

      var hash = (window.location.hash || '#').substring(1);
      var startThread, targetComment;
      if (/^comment-form_/.test(hash)) {
        startThread = hash.substring('comment-form_'.length);
      } else if (/^c[0-9]+$/.test(hash)) {
        targetComment = hash.substring(1);
      }

      // Configure commenting API:
      var configJso = {
        'maxDepth': config.maxThreadDepth
      };
      var provider = {
        'id': config.postId,
        'data': items,
        'loadNext': paginator,
        'hasMore': hasMore,
        'getMeta': getMeta,
        'onReply': onReply,
        'rendered': true,
        'initComment': targetComment,
        'initReplyThread': startThread,
        'config': configJso,
        'messages': msgs
      };

      var render = function() {
        if (window.goog && window.goog.comments) {
          var holder = document.getElementById('comment-holder');
          window.goog.comments.render(holder, provider);
        }
      };

      // render now, or queue to render when library loads:
      if (window.goog && window.goog.comments) {
        render();
      } else {
        window.goog = window.goog || {};
        window.goog.comments = window.goog.comments || {};
        window.goog.comments.loadQueue = window.goog.comments.loadQueue || [];
        window.goog.comments.loadQueue.push(render);
      }
    })();
// ]]>
  </script>
<div id='comment-holder'>
<div id='bc_0_79C' kind='c'><div id='bc_0_79CT'><div id='bc_0_78T' class='comment-thread' kind='r'  t='0' u='0'><ol id='bc_0_78TB'><li id='bc_0_2B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh5.googleusercontent.com/-cu84Fxo8lH8/AAAAAAAAAAI/AAAAAAAAAJE/B0w_a4mqevY/s35-c/photo.jpg'></img></div><div id='c7428272354616706188' class='comment-block'><div id='bc_0_2M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/03645865529771558754'>Jens Steube</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467290026217#c7428272354616706188'>30/06/2016, 15:33</a></span></div><p id='bc_0_2MC' class='comment-content'>Hey, I&#39;m the developer of hashcat. I&#39;d be happy to assist you adding the scrypt cracking portion to hashcat v3.00 to speed up the attack. Could you please create an issue on GitHub for it?</p><span id='bc_0_2MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-174154407'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=7428272354616706188'>Delete</a></span></span></div><div id='bc_0_2BR' class='comment-replies'><span id='bc_0_2b+seedB6tPD' kind='d'><div id='bc_0_0T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_0TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_0TA' class='thread-arrow'></span><span id='bc_0_0TN' class='thread-count'><span id='bc_0_0TNT' style='display: none;'></span><span id='bc_0_0TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_0TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_0TC' class='thread-chrome thread-expanded'><div><li id='bc_0_0B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c7553113789661496014' class='comment-block'><div id='bc_0_0M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467294573211#c7553113789661496014'>30/06/2016, 16:49</a></span></div><p id='bc_0_0MC' class='comment-content'>Hi Jens,<br /><br />Thank you very much! I&#39;ll create a feature request right away. Apart from the information in this blog post (regarding the structure of the KDF and how the key can be validated), is there any additional information I should add to the feature request? (Perhaps the crypto footer from my encrypted disk image and the corresponding keys, so that we can make sure the code works as expected). <br /><br />Gal.</p><span id='bc_0_0MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=7553113789661496014'>Delete</a></span></span></div><div id='bc_0_0BR' class='comment-replies'></div><div id='bc_0_0B_box' class='comment-replybox-single'></div></li><li id='bc_0_1B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh5.googleusercontent.com/-cu84Fxo8lH8/AAAAAAAAAAI/AAAAAAAAAJE/B0w_a4mqevY/s35-c/photo.jpg'></img></div><div id='c2807220850249205492' class='comment-block'><div id='bc_0_1M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/03645865529771558754'>Jens Steube</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467296342217#c2807220850249205492'>30/06/2016, 17:19</a></span></div><p id='bc_0_1MC' class='comment-content'>Hey Gal., from hashcat FAQ:<br /><br />* name of the algorithm/feature<br />* mention where the algorithm is currently being used (software, web app etc) or why the feature should be added<br />* source code or source code link<br />* mention any restrictions/limits or default lengths (maximum salt length, password length, &#8230;)<br />* several full example hash/plain pairs in case of a hashing algorithm<br /><br />Especially the password lengths and salt lengths would be good to know and if there&#39;s any way for a user to modify existing configuration settings like iterations for cipher bitsizes.<br /><br />However, I was primarily contacting you because I want to make sure the hash format is &quot;standartized&quot;. The idea is to use your tool as it is but when it comes to the slow scrypt part, instead of cracking, it exports the required data so that hashcat (or any other tool) can work with it. Please add a suggestion, too</p><span id='bc_0_1MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-174154407'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=2807220850249205492'>Delete</a></span></span></div><div id='bc_0_1BR' class='comment-replies'></div><div id='bc_0_1B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_0I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_0T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_2B_box' class='comment-replybox-single'></div></li><li id='bc_0_4B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh6.googleusercontent.com/-TTlKsYarWCg/AAAAAAAAAAI/AAAAAAAAcys/C1hLwKwgJYs/s35-c/photo.jpg'></img></div><div id='c7991950604794943692' class='comment-block'><div id='bc_0_4M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/05576261429763962668'>Jos Spencer</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467335524310#c7991950604794943692'>01/07/2016, 04:12</a></span></div><p id='bc_0_4MC' class='comment-content'>so by using this code you can break most android devices with relative ease? well the encryption part and then brute force the pin/password.... the brute forcing would be insanely quick wouldn&#39;t it? :/ this basically means android devices aren&#39;t secure at all</p><span id='bc_0_4MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-2087814879'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=7991950604794943692'>Delete</a></span></span></div><div id='bc_0_4BR' class='comment-replies'><span id='bc_0_4b+seedB6tTD' kind='d'><div id='bc_0_3T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_3TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_3TA' class='thread-arrow'></span><span id='bc_0_3TN' class='thread-count'><span id='bc_0_3TNT' style='display: none;'></span><span id='bc_0_3TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_3TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_3TC' class='thread-chrome thread-expanded'><div><li id='bc_0_3B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c4208183834904439827' class='comment-block'><div id='bc_0_3M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/17263817774470840964'>Unknown</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467336089892#c4208183834904439827'>01/07/2016, 04:21</a></span></div><p id='bc_0_3MC' class='comment-content'>ignorant...</p><span id='bc_0_3MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1860488182'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=4208183834904439827'>Delete</a></span></span></div><div id='bc_0_3BR' class='comment-replies'></div><div id='bc_0_3B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_3I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_3T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_4B_box' class='comment-replybox-single'></div></li><li id='bc_0_6B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh6.googleusercontent.com/-TTlKsYarWCg/AAAAAAAAAAI/AAAAAAAAcys/C1hLwKwgJYs/s35-c/photo.jpg'></img></div><div id='c5220779407270918135' class='comment-block'><div id='bc_0_6M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/05576261429763962668'>Jos Spencer</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467335868298#c5220779407270918135'>01/07/2016, 04:17</a></span></div><p id='bc_0_6MC' class='comment-content'>so by using this code you can break most android devices with relative ease? well the encryption part and then brute force the pin/password.... the brute forcing would be insanely quick wouldn&#39;t it? :/ this basically means android devices aren&#39;t secure at all</p><span id='bc_0_6MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-2087814879'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=5220779407270918135'>Delete</a></span></span></div><div id='bc_0_6BR' class='comment-replies'><span id='bc_0_6b+seedB6tgD' kind='d'><div id='bc_0_5T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_5TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_5TA' class='thread-arrow'></span><span id='bc_0_5TN' class='thread-count'><span id='bc_0_5TNT' style='display: none;'></span><span id='bc_0_5TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_5TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_5TC' class='thread-chrome thread-expanded'><div><li id='bc_0_5B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c609763366440228659' class='comment-block'><div id='bc_0_5M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467382148784#c609763366440228659'>01/07/2016, 17:09</a></span></div><p id='bc_0_5MC' class='comment-content'>That depends on the strength of the password you choose. Generally speaking, I wouldn&#39;t expect mobile devices to have strong passwords (but I don&#39;t have the data to back this claim).</p><span id='bc_0_5MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=609763366440228659'>Delete</a></span></span></div><div id='bc_0_5BR' class='comment-replies'></div><div id='bc_0_5B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_5I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_5T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_6B_box' class='comment-replybox-single'></div></li><li id='bc_0_11B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c6398768391859686381' class='comment-block'><div id='bc_0_11M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/03164300423365590354'>CABROL PERALES Alexandre</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467339940620#c6398768391859686381'>01/07/2016, 05:25</a></span></div><p id='bc_0_11MC' class='comment-content'>Is CopperHeadOS encryption hardening is a good mitigation for this vulnerability?<br /><br />&quot;Encryption and authentication<br /><br />Full disk encryption is enabled by default on all supported devices, not just those shipping that way with the stock operating system.<br />Support for a separate encryption password<br /><br />In vanilla Android, the encryption password is tied to the lockscreen password. That&#8217;s the default in CopperheadOS, but there&#8217;s full support for setting a separate encryption password. This allows for a convenient pattern, pin or password to be used for unlocking the screen while using a very strong encryption passphrase. If desired, the separate encryption password can be removed in favor of coupling it to the lockscreen password again.<br /><br />When a separate encryption password is set, the lockscreen will force a reboot after 5 failed unlocking attempts to force the entry of the encryption passphrase. This makes it possible to use a convenient unlocking method without brute force being feasible. It offers similar benefits as wiping after a given number of failures or using a fingerprint scanner without the associated drawbacks.<br />Support for longer passwords<br /><br />The maximum password length is raised from 16 characters to 32 characters.&quot;<br /><br />https://copperhead.co/android/docs/technical_overview</p><span id='bc_0_11MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-677315912'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=6398768391859686381'>Delete</a></span></span></div><div id='bc_0_11BR' class='comment-replies'><span id='bc_0_11b+seedB6tWD' kind='d'><div id='bc_0_7T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_7TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_7TA' class='thread-arrow'></span><span id='bc_0_7TN' class='thread-count'><span id='bc_0_7TNT' style='display: none;'></span><span id='bc_0_7TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_7TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_7TC' class='thread-chrome thread-expanded'><div><li id='bc_0_7B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c4792450200440641518' class='comment-block'><div id='bc_0_7M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/16992557022774026418'>Alan Alanson</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467341707398#c4792450200440641518'>01/07/2016, 05:55</a></span></div><p id='bc_0_7MC' class='comment-content'>Very interested in the answer to this as this seems like it&#39;s potentially the best of both worlds. A strong encryption PW but relative ease of use is maintained.</p><span id='bc_0_7MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1510912494'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=4792450200440641518'>Delete</a></span></span></div><div id='bc_0_7BR' class='comment-replies'></div><div id='bc_0_7B_box' class='comment-replybox-single'></div></li><li id='bc_0_8B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c9184694783287996318' class='comment-block'><div id='bc_0_8M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/16992557022774026418'>Alan Alanson</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467342454525#c9184694783287996318'>01/07/2016, 06:07</a></span></div><p id='bc_0_8MC' class='comment-content'>https://play.google.com/store/apps/details?id=org.nick.cryptfs.passwdmanager<br /><br />This app appears to work similarly to the CopperheadOS in decoupling the encryption PW from the lock screen PIN or pattern. I&#39;m interested to hear any opinions on this app as it claims to work with any device where the CopperheadOS only works with a handful.</p><span id='bc_0_8MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1510912494'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=9184694783287996318'>Delete</a></span></span></div><div id='bc_0_8BR' class='comment-replies'></div><div id='bc_0_8B_box' class='comment-replybox-single'></div></li><li id='bc_0_9B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c4749961070907755825' class='comment-block'><div id='bc_0_9M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467382100901#c4749961070907755825'>01/07/2016, 17:08</a></span></div><p id='bc_0_9MC' class='comment-content'>The CopperHeadOS solution is a good one, given that you do, in fact, choose a long complex password. BTW, it uses a feature of Android that&#39;s actually supported behind the scenes (vdc cryptfs changepw). This is the same feature that&#39;s used by Nikolay&#39;s application.</p><span id='bc_0_9MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=4749961070907755825'>Delete</a></span></span></div><div id='bc_0_9BR' class='comment-replies'></div><div id='bc_0_9B_box' class='comment-replybox-single'></div></li><li id='bc_0_10B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c5254429654910792125' class='comment-block'><div id='bc_0_10M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/03057090240025237860'>Unknown</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467436357186#c5254429654910792125'>02/07/2016, 08:12</a></span></div><p id='bc_0_10MC' class='comment-content'>Alan Alamson: I have used that app on all CM versions since CM-11. It works. There was an issue with CM-13, because CM changed the vold cryptfs API call. But they fixed that eventually.<br /></p><span id='bc_0_10MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-13829238'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=5254429654910792125'>Delete</a></span></span></div><div id='bc_0_10BR' class='comment-replies'></div><div id='bc_0_10B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_7I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_7T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_11B_box' class='comment-replybox-single'></div></li><li id='bc_0_13B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c815301570550927324' class='comment-block'><div id='bc_0_13M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/16992557022774026418'>Alan Alanson</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467341352195#c815301570550927324'>01/07/2016, 05:49</a></span></div><p id='bc_0_13MC' class='comment-content'>So the attacker still needs to brute force the PIN/PW. Therefore the best (perhaps only?) defense against this is to utilize a long and complex alphanumeric PW that will take an exorbitant amount of time to brute force attack, correct?</p><span id='bc_0_13MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1510912494'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=815301570550927324'>Delete</a></span></span></div><div id='bc_0_13BR' class='comment-replies'><span id='bc_0_13b+seedB6teD' kind='d'><div id='bc_0_12T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_12TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_12TA' class='thread-arrow'></span><span id='bc_0_12TN' class='thread-count'><span id='bc_0_12TNT' style='display: none;'></span><span id='bc_0_12TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_12TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_12TC' class='thread-chrome thread-expanded'><div><li id='bc_0_12B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c6101511453763884312' class='comment-block'><div id='bc_0_12M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467381999003#c6101511453763884312'>01/07/2016, 17:06</a></span></div><p id='bc_0_12MC' class='comment-content'>Definitely.</p><span id='bc_0_12MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=6101511453763884312'>Delete</a></span></span></div><div id='bc_0_12BR' class='comment-replies'></div><div id='bc_0_12B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_12I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_12T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_13B_box' class='comment-replybox-single'></div></li><li id='bc_0_16B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c4426298030847558234' class='comment-block'><div id='bc_0_16M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/04567321311673661478'>PWA</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467348567955#c4426298030847558234'>01/07/2016, 07:49</a></span></div><p id='bc_0_16MC' class='comment-content'>would a strong  password/pin protect against this attack?</p><span id='bc_0_16MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-181834258'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=4426298030847558234'>Delete</a></span></span></div><div id='bc_0_16BR' class='comment-replies'><span id='bc_0_16b+seedB6tdD' kind='d'><div id='bc_0_14T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_14TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_14TA' class='thread-arrow'></span><span id='bc_0_14TN' class='thread-count'><span id='bc_0_14TNT' style='display: none;'></span><span id='bc_0_14TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_14TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_14TC' class='thread-chrome thread-expanded'><div><li id='bc_0_14B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c2787731266731598587' class='comment-block'><div id='bc_0_14M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467381984635#c2787731266731598587'>01/07/2016, 17:06</a></span></div><p id='bc_0_14MC' class='comment-content'>Yes, if your password is strong enough, it could be infeasible to crack. Admittedly, mobile devices make this a little hard (who wants to type a long unique password on a mobile keyboard? Also, right now the lock screen password is the same password used for FDE. Imagine typing out a long password every time you unlock the device...)</p><span id='bc_0_14MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=2787731266731598587'>Delete</a></span></span></div><div id='bc_0_14BR' class='comment-replies'></div><div id='bc_0_14B_box' class='comment-replybox-single'></div></li><li id='bc_0_15B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c8232847344321895013' class='comment-block'><div id='bc_0_15M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/03057090240025237860'>Unknown</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467409828495#c8232847344321895013'>02/07/2016, 00:50</a></span></div><p id='bc_0_15MC' class='comment-content'>Nikolay Elenkov has an app that decouples the encryption password from the lockscreen pin/pw: https://play.google.com/store/apps/details?id=org.nick.cryptfs.passwdmanager<br />Needs root, though.</p><span id='bc_0_15MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-13829238'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=8232847344321895013'>Delete</a></span></span></div><div id='bc_0_15BR' class='comment-replies'></div><div id='bc_0_15B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_14I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_14T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_16B_box' class='comment-replybox-single'></div></li><li id='bc_0_18B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c8789274541678392166' class='comment-block'><div id='bc_0_18M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/01176611245261635304'>Drew</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467361315120#c8789274541678392166'>01/07/2016, 11:21</a></span></div><p id='bc_0_18MC' class='comment-content'>Multifactor Security... Something you know, something you have, something you are, someplace you are, etc. will always be more secure than just a password. PARTICULARLY if you get a trillion chances to guess.</p><span id='bc_0_18MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-732618603'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=8789274541678392166'>Delete</a></span></span></div><div id='bc_0_18BR' class='comment-replies'><span id='bc_0_18b+seedB6tbD' kind='d'><div id='bc_0_17T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_17TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_17TA' class='thread-arrow'></span><span id='bc_0_17TN' class='thread-count'><span id='bc_0_17TNT' style='display: none;'></span><span id='bc_0_17TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_17TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_17TC' class='thread-chrome thread-expanded'><div><li id='bc_0_17B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c8214130588717152197' class='comment-block'><div id='bc_0_17M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467381825103#c8214130588717152197'>01/07/2016, 17:03</a></span></div><p id='bc_0_17MC' class='comment-content'>How would that apply to a disk encryption password? (I&#39;m curious)</p><span id='bc_0_17MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=8214130588717152197'>Delete</a></span></span></div><div id='bc_0_17BR' class='comment-replies'></div><div id='bc_0_17B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_17I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_17T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_18B_box' class='comment-replybox-single'></div></li><li id='bc_0_21B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c3992373381397599160' class='comment-block'><div id='bc_0_21M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/11081920965227578697'>Unknown</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467381379321#c3992373381397599160'>01/07/2016, 16:56</a></span></div><p id='bc_0_21MC' class='comment-content'>If I read this correctly, any specially crafted exploit code would need to either be signed by Qualcomm or an OEM, or would need to take advantage of an unpatched vulnerability on the device. Is that correct? If so, how is this different from iOS (beyond there being more players involved)?</p><span id='bc_0_21MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-88011924'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=3992373381397599160'>Delete</a></span></span></div><div id='bc_0_21BR' class='comment-replies'><span id='bc_0_21b+seedB6tcD' kind='d'><div id='bc_0_19T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_19TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_19TA' class='thread-arrow'></span><span id='bc_0_19TN' class='thread-count'><span id='bc_0_19TNT' style='display: none;'></span><span id='bc_0_19TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_19TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_19TC' class='thread-chrome thread-expanded'><div><li id='bc_0_19B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c5430038918175272440' class='comment-block'><div id='bc_0_19M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467381889696#c5430038918175272440'>01/07/2016, 17:04</a></span></div><p id='bc_0_19MC' class='comment-content'>In Apple&#39;s case you can&#39;t extract the hardware key no matter what software attack you carry out (w/ the OEMs or without). At most, you can bypass the software protections, but you&#39;ll still have to perform the bruteforce attempt strictly on the device.</p><span id='bc_0_19MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=5430038918175272440'>Delete</a></span></span></div><div id='bc_0_19BR' class='comment-replies'></div><div id='bc_0_19B_box' class='comment-replybox-single'></div></li><li id='bc_0_20B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c6133233215694854861' class='comment-block'><div id='bc_0_20M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/05247177760989842914'>Unknown</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467610870894#c6133233215694854861'>04/07/2016, 08:41</a></span></div><p id='bc_0_20MC' class='comment-content'>Kind of curious about a couple things:<br /><br />1) How do you run the code for the Qualcomm exploit on a locked device?<br />2) With i OS being closed source, how do you know what goes on in the black box secure element?  Why is it impossible to get the hardware key?  You were only able to figure out most of this with Android being open source.</p><span id='bc_0_20MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1133036383'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=6133233215694854861'>Delete</a></span></span></div><div id='bc_0_20BR' class='comment-replies'></div><div id='bc_0_20B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_19I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_19T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_21B_box' class='comment-replybox-single'></div></li><li id='bc_0_25B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c8954680755350854855' class='comment-block'><div id='bc_0_25M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/04269089454799671890'>Unknown</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467447356083#c8954680755350854855'>02/07/2016, 11:15</a></span></div><p id='bc_0_25MC' class='comment-content'>if i set a long alphanumeric password and use my finger print to unlock the device would this still be vulnerable?<br />if i set my finger print to unlock the device i wouldnt have to type my password everytime</p><span id='bc_0_25MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-732983686'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=8954680755350854855'>Delete</a></span></span></div><div id='bc_0_25BR' class='comment-replies'><span id='bc_0_25b+seedB6tkD' kind='d'><div id='bc_0_22T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_22TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_22TA' class='thread-arrow'></span><span id='bc_0_22TN' class='thread-count'><span id='bc_0_22TNT' style='display: none;'></span><span id='bc_0_22TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_22TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_22TC' class='thread-chrome thread-expanded'><div><li id='bc_0_22B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh5.googleusercontent.com/-gQMKHhAUQWQ/AAAAAAAAAAI/AAAAAAAAAfo/gb7SL2zoa-8/s35-c/photo.jpg'></img></div><div id='c8226772719403811215' class='comment-block'><div id='bc_0_22M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/12181751515421647053'>Gagan Jattana</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467476896277#c8226772719403811215'>02/07/2016, 19:28</a></span></div><p id='bc_0_22MC' class='comment-content'>You still have to enter the password while setting up the finger print on your device. It applies to every device yet!!!</p><span id='bc_0_22MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1123004229'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=8226772719403811215'>Delete</a></span></span></div><div id='bc_0_22BR' class='comment-replies'></div><div id='bc_0_22B_box' class='comment-replybox-single'></div></li><li id='bc_0_23B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh5.googleusercontent.com/-PVAXos57wi0/AAAAAAAAAAI/AAAAAAAAACc/_YWAatmS28k/s35-c/photo.jpg'></img></div><div id='c1507365853809396473' class='comment-block'><div id='bc_0_23M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/04269089454799671890'>Dekel Waxman</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467478754315#c1507365853809396473'>02/07/2016, 19:59</a></span></div><p id='bc_0_23MC' class='comment-content'><span class='deleted-comment'>This comment has been removed by the author.</span></p><span id='bc_0_23MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin '><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=1507365853809396473'>Delete</a></span></span></div><div id='bc_0_23BR' class='comment-replies'></div><div id='bc_0_23B_box' class='comment-replybox-single'></div></li><li id='bc_0_24B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh5.googleusercontent.com/-PVAXos57wi0/AAAAAAAAAAI/AAAAAAAAACc/_YWAatmS28k/s35-c/photo.jpg'></img></div><div id='c1989252048838030394' class='comment-block'><div id='bc_0_24M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/04269089454799671890'>Dekel Waxman</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467478863817#c1989252048838030394'>02/07/2016, 20:01</a></span></div><p id='bc_0_24MC' class='comment-content'>yes but this vulnerability works because its easy to brute force the password hash.<br />so if my password is long it will be harder to brute force it</p><span id='bc_0_24MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-732983686'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=1989252048838030394'>Delete</a></span></span></div><div id='bc_0_24BR' class='comment-replies'></div><div id='bc_0_24B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_22I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_22T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_25B_box' class='comment-replybox-single'></div></li><li id='bc_0_27B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c5330186468804790401' class='comment-block'><div id='bc_0_27M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/11975361198651347062'>SIG_SEGV</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467478608389#c5330186468804790401'>02/07/2016, 19:56</a></span></div><p id='bc_0_27MC' class='comment-content'>If you can&#39;t run this code unless the device is unlocked, should anyone actually worry?</p><span id='bc_0_27MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1470319324'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=5330186468804790401'>Delete</a></span></span></div><div id='bc_0_27BR' class='comment-replies'><span id='bc_0_27b+seedB6t2D' kind='d'><div id='bc_0_26T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_26TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_26TA' class='thread-arrow'></span><span id='bc_0_26TN' class='thread-count'><span id='bc_0_26TNT' style='display: none;'></span><span id='bc_0_26TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_26TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_26TC' class='thread-chrome thread-expanded'><div><li id='bc_0_26B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c2130737123820908281' class='comment-block'><div id='bc_0_26M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467925735483#c2130737123820908281'>08/07/2016, 00:08</a></span></div><p id='bc_0_26MC' class='comment-content'>(answered your question below)</p><span id='bc_0_26MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=2130737123820908281'>Delete</a></span></span></div><div id='bc_0_26BR' class='comment-replies'></div><div id='bc_0_26B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_26I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_26T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_27B_box' class='comment-replybox-single'></div></li><li id='bc_0_29B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c6855518007809849017' class='comment-block'><div id='bc_0_29M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/10770973534276913019'>ss</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467581760969#c6855518007809849017'>04/07/2016, 00:36</a></span></div><p id='bc_0_29MC' class='comment-content'>Good to know if we can extract keys for Samsung KNOX Container as well</p><span id='bc_0_29MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1219841773'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=6855518007809849017'>Delete</a></span></span></div><div id='bc_0_29BR' class='comment-replies'><span id='bc_0_29b+seedB6txD' kind='d'><div id='bc_0_28T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_28TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_28TA' class='thread-arrow'></span><span id='bc_0_28TN' class='thread-count'><span id='bc_0_28TNT' style='display: none;'></span><span id='bc_0_28TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_28TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_28TC' class='thread-chrome thread-expanded'><div><li id='bc_0_28B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c2868845052450562897' class='comment-block'><div id='bc_0_28M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467910015249#c2868845052450562897'>07/07/2016, 19:46</a></span></div><p id='bc_0_28MC' class='comment-content'>Who knows what the future holds :)</p><span id='bc_0_28MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=2868845052450562897'>Delete</a></span></span></div><div id='bc_0_28BR' class='comment-replies'></div><div id='bc_0_28B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_28I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_28T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_29B_box' class='comment-replybox-single'></div></li><li id='bc_0_31B' class='comment' kind='b'><div class='avatar-image-container'><img src='//4.bp.blogspot.com/-5_otvJmPYDM/UsbrF8Tc3tI/AAAAAAAAABw/6Bxfouk5taE/s35/images%253Fq%253Dtbn%253AANd9GcTpACgA7eVvpZ3qQFKuOKXd-VVsgo7VPzsfjBNZlSjQqPxmiHjR'></img></div><div id='c1125824357360897548' class='comment-block'><div id='bc_0_31M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/01538572128166005974'>Administrator</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467591377899#c1125824357360897548'>04/07/2016, 03:16</a></span></div><p id='bc_0_31MC' class='comment-content'>Suggestions.<br /><br />1. Code should be presented in a format allowing it to be copied-and-pasted.<br /><br />2. Technical terms in text should match those in illustrations. E.g., if text discusses UID, illustrations shold also mention UID.</p><span id='bc_0_31MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1240838951'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=1125824357360897548'>Delete</a></span></span></div><div id='bc_0_31BR' class='comment-replies'><span id='bc_0_31b+seedB6twD' kind='d'><div id='bc_0_30T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_30TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_30TA' class='thread-arrow'></span><span id='bc_0_30TN' class='thread-count'><span id='bc_0_30TNT' style='display: none;'></span><span id='bc_0_30TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_30TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_30TC' class='thread-chrome thread-expanded'><div><li id='bc_0_30B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c4233148242232958161' class='comment-block'><div id='bc_0_30M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467909980572#c4233148242232958161'>07/07/2016, 19:46</a></span></div><p id='bc_0_30MC' class='comment-content'>Agreed, thank you for your input.</p><span id='bc_0_30MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=4233148242232958161'>Delete</a></span></span></div><div id='bc_0_30BR' class='comment-replies'></div><div id='bc_0_30B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_30I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_30T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_31B_box' class='comment-replybox-single'></div></li><li id='bc_0_32B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/-io57ofafE1c/AAAAAAAAAAI/AAAAAAAAAEU/GACgigqXm18/s35-c/photo.jpg'></img></div><div id='c2739773840051801379' class='comment-block'><div id='bc_0_32M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/07056794514444876902'>MPC SECURE</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467647177349#c2739773840051801379'>04/07/2016, 18:46</a></span></div><p id='bc_0_32MC' class='comment-content'>Hi laginimaineb I&#39;d be very keen to speak with your regarding your blog writing, can you drop me an email from the contact form found on www.mpc-encryption.com <br /><br />Many thanks</p><span id='bc_0_32MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1307464613'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=2739773840051801379'>Delete</a></span></span></div><div id='bc_0_32BR' class='comment-replies'></div><div id='bc_0_32B_box' class='comment-replybox-single'></div></li><li id='bc_0_34B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c7837833027688303594' class='comment-block'><div id='bc_0_34M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/03295972990248970162'>Art</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467831142478#c7837833027688303594'>06/07/2016, 21:52</a></span></div><p id='bc_0_34MC' class='comment-content'>Thx a lot for your work and the info.<br /><br />Is there any additional protection (besides FDE) for data in an Android for Work &#39;container&#39;?<br /></p><span id='bc_0_34MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-103269032'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=7837833027688303594'>Delete</a></span></span></div><div id='bc_0_34BR' class='comment-replies'><span id='bc_0_34b+seedB6tvD' kind='d'><div id='bc_0_33T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_33TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_33TA' class='thread-arrow'></span><span id='bc_0_33TN' class='thread-count'><span id='bc_0_33TNT' style='display: none;'></span><span id='bc_0_33TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_33TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_33TC' class='thread-chrome thread-expanded'><div><li id='bc_0_33B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c4775212822014651442' class='comment-block'><div id='bc_0_33M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467909943152#c4775212822014651442'>07/07/2016, 19:45</a></span></div><p id='bc_0_33MC' class='comment-content'>Sorry, I haven&#39;t done any research into &quot;Android for Work&quot;. But if you use a strong password for FDE, you should be okay.</p><span id='bc_0_33MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=4775212822014651442'>Delete</a></span></span></div><div id='bc_0_33BR' class='comment-replies'></div><div id='bc_0_33B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_33I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_33T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_34B_box' class='comment-replybox-single'></div></li><li id='bc_0_36B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c2111335520043466192' class='comment-block'><div id='bc_0_36M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/09693294988916745216'>Rob Kehl</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467907347439#c2111335520043466192'>07/07/2016, 19:02</a></span></div><p id='bc_0_36MC' class='comment-content'>I have a qualcomm processor on my Microsoft Lumia 950XL.  Is my phone easily breakable as well with it&#39;s FDE?</p><span id='bc_0_36MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-843725457'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=2111335520043466192'>Delete</a></span></span></div><div id='bc_0_36BR' class='comment-replies'><span id='bc_0_36b+seedB6tuD' kind='d'><div id='bc_0_35T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_35TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_35TA' class='thread-arrow'></span><span id='bc_0_35TN' class='thread-count'><span id='bc_0_35TNT' style='display: none;'></span><span id='bc_0_35TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_35TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_35TC' class='thread-chrome thread-expanded'><div><li id='bc_0_35B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c1552853459927225926' class='comment-block'><div id='bc_0_35M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467909879186#c1552853459927225926'>07/07/2016, 19:44</a></span></div><p id='bc_0_35MC' class='comment-content'>I don&#39;t know, but I don&#39;t think so. It depends on how FDE is implemented on Windows 10.</p><span id='bc_0_35MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=1552853459927225926'>Delete</a></span></span></div><div id='bc_0_35BR' class='comment-replies'></div><div id='bc_0_35B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_35I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_35T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_36B_box' class='comment-replybox-single'></div></li><li id='bc_0_40B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c6254013562092220636' class='comment-block'><div id='bc_0_40M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/07040691995913582552'>Clone</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467917747708#c6254013562092220636'>07/07/2016, 21:55</a></span></div><p id='bc_0_40MC' class='comment-content'>Very fascinating post. There is one thing which I don&#39;t quite understand: &quot;Patching TrustZone vulnerabilities does not necessarily protect you from this issue.&quot; <br /><br />Suppose, (1) TrustZone is patched, and (2) the KeyMaster keys are derived from new and different hard-coded strings, and (3) user device is re-encrypted using the new KeyMaster keys. Wouldn&#39;t that fix the downgrading attack? P.S., I noticed that you used the phrase &quot;not necessarily&quot;, so I want to confirm with you that this problem can be solved by proper patches.</p><span id='bc_0_40MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-73355744'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=6254013562092220636'>Delete</a></span></span></div><div id='bc_0_40BR' class='comment-replies'><span id='bc_0_40b+seedB6t0D' kind='d'><div id='bc_0_37T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_37TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_37TA' class='thread-arrow'></span><span id='bc_0_37TN' class='thread-count'><span id='bc_0_37TNT' style='display: none;'></span><span id='bc_0_37TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_37TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_37TC' class='thread-chrome thread-expanded'><div><li id='bc_0_37B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c2672295860129856632' class='comment-block'><div id='bc_0_37M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467925527712#c2672295860129856632'>08/07/2016, 00:05</a></span></div><p id='bc_0_37MC' class='comment-content'>Thank you!<br /><br />Regarding your proposed patch - that still won&#39;t work. Remember that although I only extracted the generated keys in the exploit, you could just as easily modify it to use any pair of hard-coded strings as parameters for the KDF and to leak that result back to the Non-Secure World (since we have arbitrary code-exec in KeyMaster).<br /><br />That said, a good patch could fix the issue by using a different scheme to bind the intermediate key (for example, using the hardware AES engine to encrypt the IK1 instead of KeyMaster - this has been proposed by people on droidsec). The problem is that any such patch would require a code change in Android (and some logic to handle transitioning from the old KDF to the new one), and that would break the cross-OEM compatibility of cryptfs.</p><span id='bc_0_37MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=2672295860129856632'>Delete</a></span></span></div><div id='bc_0_37BR' class='comment-replies'></div><div id='bc_0_37B_box' class='comment-replybox-single'></div></li><li id='bc_0_38B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c8604893011420279123' class='comment-block'><div id='bc_0_38M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/07040691995913582552'>Clone</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467930328692#c8604893011420279123'>08/07/2016, 01:25</a></span></div><p id='bc_0_38MC' class='comment-content'>Thanks for your reply. I see the problem now. My understanding is that the KeyMaster keys are leaked and cannot be fixed by patching due to the reality. So the only approach is to protect the application key (e.g. FDE key) via some other way.<br /><br />I am wondering if your attack framework can be easily adapted to attack other sensitive data that are (supposedly) being protected by the hardware backed keystore, such as the application created keys in the Android keystore. Do you know the answer? <br /><br />Another interesting asset would be the fingerprint template, which I guess is more likely to be protected by the SHK directly (hopefully).</p><span id='bc_0_38MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-73355744'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=8604893011420279123'>Delete</a></span></span></div><div id='bc_0_38BR' class='comment-replies'></div><div id='bc_0_38B_box' class='comment-replybox-single'></div></li><li id='bc_0_39B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c2798440194460547273' class='comment-block'><div id='bc_0_39M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1468598845319#c2798440194460547273'>15/07/2016, 19:07</a></span></div><p id='bc_0_39MC' class='comment-content'>No problem. First of all, I&#39;ve written a script which can be used to decrypt any keystore key (incl. application created keys). You can find it here: https://github.com/laginimaineb/android_fde_bruteforce/blob/master/keymaster_mod.py<br /><br />As for the fingerprint template - I believe it should be easily readable using a TrustZone exploit, since the fingerprint application is a trustlet which reads the fingerprint and matches it up to the stored template. I would do so myself but unfortunately I don&#39;t own a device with a fingerprint sensor.</p><span id='bc_0_39MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=2798440194460547273'>Delete</a></span></span></div><div id='bc_0_39BR' class='comment-replies'></div><div id='bc_0_39B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_37I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_37T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_40B_box' class='comment-replybox-single'></div></li><li id='bc_0_44B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c1350483532216861779' class='comment-block'><div id='bc_0_44M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/11975361198651347062'>SIG_SEGV</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467925381758#c1350483532216861779'>08/07/2016, 00:03</a></span></div><p id='bc_0_44MC' class='comment-content'>Hello. I haven&#39;t heard yet about my question. I&#39;ve tried somewhat in vain to compile your code for my device, not of any fault of your own.<br /><br />But I can&#39;t see that code running at fastboot or if the device is locked. While your code works I&#39;m sure, why should anyone worry if they can&#39;t do this on a locked device? Can you?</p><span id='bc_0_44MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1470319324'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=1350483532216861779'>Delete</a></span></span></div><div id='bc_0_44BR' class='comment-replies'><span id='bc_0_44b+seedB6t1D' kind='d'><div id='bc_0_41T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_41TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_41TA' class='thread-arrow'></span><span id='bc_0_41TN' class='thread-count'><span id='bc_0_41TNT' style='display: none;'></span><span id='bc_0_41TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_41TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_41TC' class='thread-chrome thread-expanded'><div><li id='bc_0_41B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c6185661081432792875' class='comment-block'><div id='bc_0_41M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1467925668149#c6185661081432792875'>08/07/2016, 00:07</a></span></div><p id='bc_0_41MC' class='comment-content'>Missed your question. Here are a couple of thoughts:<br /><br />1. If you can sign an image (you are an OEM/have the OEMs private key) - you don&#39;t need to bypass the lock screen.<br />2. If you can&#39;t sign an image, but can acquire the disk image (using forensic tools/a flash reader/special fastboot oem commands/recovery/etc.), then you can acquire the image, factory reset the device, and now run the full exploit chain to extract the keys and attack the encryption off the device.</p><span id='bc_0_41MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=6185661081432792875'>Delete</a></span></span></div><div id='bc_0_41BR' class='comment-replies'></div><div id='bc_0_41B_box' class='comment-replybox-single'></div></li><li id='bc_0_42B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c8445032959115161273' class='comment-block'><div id='bc_0_42M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/11975361198651347062'>SIG_SEGV</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1468028056371#c8445032959115161273'>09/07/2016, 04:34</a></span></div><p id='bc_0_42MC' class='comment-content'>Would the key then be the same as last time since it was derived from the SHK instead of it directly? Or is it always constant? I wish I could test it out but I&#39;m not a programmer and while I did compile your code I can&#39;t figure out how to execute it or package it. I&#39;m assuming the same binary you used to test your Nexus 6 would work on my Nexus 7 2013 (no longer have my N5 to test with)? Could you send it to my email joe&amp;jstech.us? &amp; for at symbol?</p><span id='bc_0_42MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1470319324'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=8445032959115161273'>Delete</a></span></span></div><div id='bc_0_42BR' class='comment-replies'></div><div id='bc_0_42B_box' class='comment-replybox-single'></div></li><li id='bc_0_43B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c1182882731098619550' class='comment-block'><div id='bc_0_43M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/07678262743226260373'>AG</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1468055545389#c1182882731098619550'>09/07/2016, 12:12</a></span></div><p id='bc_0_43MC' class='comment-content'>I suppose it works only for Nexus 6 platform. So called 5X commands of the Widevine trustlet are exploited to read/write arbitrary address of the secure world. Nexus 5/7/5x/6p never have such 5X commands. Hence you are not able to run that exploit on your Nexus 7.    </p><span id='bc_0_43MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1774026574'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=1182882731098619550'>Delete</a></span></span></div><div id='bc_0_43BR' class='comment-replies'></div><div id='bc_0_43B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_41I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_41T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_44B_box' class='comment-replybox-single'></div></li><li id='bc_0_46B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh4.googleusercontent.com/-Xfq17pECw2I/AAAAAAAAAAI/AAAAAAAADpo/INb2TtuDYg4/s35-c/photo.jpg'></img></div><div id='c5611761242009204786' class='comment-block'><div id='bc_0_46M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/01337303053870570411'>Craig M</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1468442190991#c5611761242009204786'>13/07/2016, 23:36</a></span></div><p id='bc_0_46MC' class='comment-content'>What device was this tested on?  The manufacturer can limit the patches that are available.</p><span id='bc_0_46MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1893217518'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=5611761242009204786'>Delete</a></span></span></div><div id='bc_0_46BR' class='comment-replies'><span id='bc_0_46b+seedB6t8D' kind='d'><div id='bc_0_45T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_45TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_45TA' class='thread-arrow'></span><span id='bc_0_45TN' class='thread-count'><span id='bc_0_45TNT' style='display: none;'></span><span id='bc_0_45TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_45TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_45TC' class='thread-chrome thread-expanded'><div><li id='bc_0_45B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c4119967819755357706' class='comment-block'><div id='bc_0_45M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1468598371461#c4119967819755357706'>15/07/2016, 18:59</a></span></div><p id='bc_0_45MC' class='comment-content'>This exploit was written on my personal Nexus 6. As for your second point - are you referring to the rollback prevention? If so, remember that all Nexus devices don&#39;t have it (to enable flashing any factory image), and many OEMs don&#39;t either. It&#39;s up to OEMs whether to enable it or not.</p><span id='bc_0_45MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=4119967819755357706'>Delete</a></span></span></div><div id='bc_0_45BR' class='comment-replies'></div><div id='bc_0_45B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_45I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_45T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_46B_box' class='comment-replybox-single'></div></li><li id='bc_0_48B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh4.googleusercontent.com/-Xfq17pECw2I/AAAAAAAAAAI/AAAAAAAADpo/INb2TtuDYg4/s35-c/photo.jpg'></img></div><div id='c7051752768119605515' class='comment-block'><div id='bc_0_48M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/01337303053870570411'>Craig M</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1468442253309#c7051752768119605515'>13/07/2016, 23:37</a></span></div><p id='bc_0_48MC' class='comment-content'>This article says that the vulnerability was patched before the exploit was found.<br /><br />http://www.androidheadlines.com/2016/07/full-disk-encryption-vulnerability-found-android-devices.html</p><span id='bc_0_48MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1893217518'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=7051752768119605515'>Delete</a></span></span></div><div id='bc_0_48BR' class='comment-replies'><span id='bc_0_48b+seedB6t9D' kind='d'><div id='bc_0_47T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_47TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_47TA' class='thread-arrow'></span><span id='bc_0_47TN' class='thread-count'><span id='bc_0_47TNT' style='display: none;'></span><span id='bc_0_47TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_47TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_47TC' class='thread-chrome thread-expanded'><div><li id='bc_0_47B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c2047839198697846095' class='comment-block'><div id='bc_0_47M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1468598430974#c2047839198697846095'>15/07/2016, 19:00</a></span></div><p id='bc_0_47MC' class='comment-content'>I&#39;ve been informed that the vulnerability was found internally before I found it, but for some reason the OEMs failed to apply the patch.</p><span id='bc_0_47MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=2047839198697846095'>Delete</a></span></span></div><div id='bc_0_47BR' class='comment-replies'></div><div id='bc_0_47B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_47I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_47T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_48B_box' class='comment-replybox-single'></div></li><li id='bc_0_50B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c1714214929934176534' class='comment-block'><div id='bc_0_50M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/14846181734999742095'>Headdy</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1468947812358#c1714214929934176534'>19/07/2016, 20:03</a></span></div><p id='bc_0_50MC' class='comment-content'>Could comment if this vulnerability can be used for Samsung bootloader unlocking? I couldn&#39;t find any definitive answer elsewhere.. Thank you.</p><span id='bc_0_50MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1837925046'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=1714214929934176534'>Delete</a></span></span></div><div id='bc_0_50BR' class='comment-replies'><span id='bc_0_50b+seedB6uBD' kind='d'><div id='bc_0_49T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_49TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_49TA' class='thread-arrow'></span><span id='bc_0_49TN' class='thread-count'><span id='bc_0_49TNT' style='display: none;'></span><span id='bc_0_49TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_49TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_49TC' class='thread-chrome thread-expanded'><div><li id='bc_0_49B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c4340881369828013714' class='comment-block'><div id='bc_0_49M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1471636929791#c4340881369828013714'>19/08/2016, 23:02</a></span></div><p id='bc_0_49MC' class='comment-content'>Sorry, I can&#39;t see how this blog post relates to unlocking bootloaders.<br /><br />Depending on how Samsung&#39;s bootloader is locked, perhaps you could use the TrustZone vulnerabilities that I&#39;ve disclosed in order to bypass secure boot, but I haven&#39;t researched this and so can&#39;t provide a definite answer.</p><span id='bc_0_49MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=4340881369828013714'>Delete</a></span></span></div><div id='bc_0_49BR' class='comment-replies'></div><div id='bc_0_49B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_49I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_49T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_50B_box' class='comment-replybox-single'></div></li><li id='bc_0_51B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c1104985237214076749' class='comment-block'><div id='bc_0_51M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/03147683011905503283'>Unknown</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1470724762659#c1104985237214076749'>09/08/2016, 09:39</a></span></div><p id='bc_0_51MC' class='comment-content'>Can this code be executed on devices with stock firmware (no root access)?</p><span id='bc_0_51MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-200965700'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=1104985237214076749'>Delete</a></span></span></div><div id='bc_0_51BR' class='comment-replies'></div><div id='bc_0_51B_box' class='comment-replybox-single'></div></li><li id='bc_0_52B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c4046802134863219397' class='comment-block'><div id='bc_0_52M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/11838610995901259393'>Slevin Gaius</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1473945522194#c4046802134863219397'>15/09/2016, 16:18</a></span></div><p id='bc_0_52MC' class='comment-content'>My OPO was soft bricked because of the encryption when i was trying to upgrade to CM13. Will this help to bypass the &quot;boot&quot; screen whereby it requests for password? <br /><br />I have two years of data that i need to recover, searched for solutions online requested aid from CM but no avail.<br /><br />Regards</p><span id='bc_0_52MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1099775291'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=4046802134863219397'>Delete</a></span></span></div><div id='bc_0_52BR' class='comment-replies'></div><div id='bc_0_52B_box' class='comment-replybox-single'></div></li><li id='bc_0_54B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c3249746336254256547' class='comment-block'><div id='bc_0_54M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/06917751465682252365'>Unknown</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1476188420049#c3249746336254256547'>11/10/2016, 15:20</a></span></div><p id='bc_0_54MC' class='comment-content'>Hi Gal , Great post as usual. <br /><br />I wonder about your philosophy(or conception) behind the act of sharing this code(scripts , mainly) with everyone. Raising awareness to this issue is important. But this is an unfixed  issue, which is definitely explosive and might be used by  &quot;script kids&quot; .  And it requires not a tiny effort to make it work (based on just the blog). <br /><br />You can also reply in private , or not reply at all.<br /><br />Regards,<br />Karni </p><span id='bc_0_54MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1868211907'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=3249746336254256547'>Delete</a></span></span></div><div id='bc_0_54BR' class='comment-replies'><span id='bc_0_54b+seedB6uFD' kind='d'><div id='bc_0_53T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_53TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_53TA' class='thread-arrow'></span><span id='bc_0_53TN' class='thread-count'><span id='bc_0_53TNT' style='display: none;'></span><span id='bc_0_53TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_53TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_53TC' class='thread-chrome thread-expanded'><div><li id='bc_0_53B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c5802345653460816857' class='comment-block'><div id='bc_0_53M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/01234036203079051373'>Gal Beniamini</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1476785900531#c5802345653460816857'>18/10/2016, 13:18</a></span></div><p id='bc_0_53MC' class='comment-content'>Hi Karni,<br /><br />Good to hear from you! How are you doing?<br /><br />My rationale for publishing this kind of research is twofold:<br /> <br /> 1. I believe in this case publishing the research could help push for a stronger FDE scheme. Currently, the advertised feature is not working as people would expect it to. Being a security-focused feature, this could have serious consequences for someone relying on FDE for their own personal safety. At the very least, people have the right to be informed. Had there been a fix on the way, I might have postponed publication. However, as you can see, the issue remains, and is present in all current devices. To the best of my knowledge this situation doesn&#39;t seem like it&#39;s going to change anytime soon.<br /><br /> 2. Research needs to be (fully) verifiable. Just as any academic research paper must publish the complete method along with the results - security research shouldn&#39;t be any different. It&#39;s hard to do research in vacuum, and publishing results along with methods should help alleviate that.<br /><br />Gal.</p><span id='bc_0_53MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-152373306'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=5802345653460816857'>Delete</a></span></span></div><div id='bc_0_53BR' class='comment-replies'></div><div id='bc_0_53B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_53I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_53T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_54B_box' class='comment-replybox-single'></div></li><li id='bc_0_55B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c2009347919869559340' class='comment-block'><div id='bc_0_55M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/07112700854527761292'>Thunder</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1476742464777#c2009347919869559340'>18/10/2016, 01:14</a></span></div><p id='bc_0_55MC' class='comment-content'>For a complete newb, I&#39;ve tried to tinker with this, but there is simply a knowledge gap (programming) that I haven&#39;t been able to overcome, let&#39;s get straight to it!<br /><br />So far, I&#39;ve downloaded the following:<br />1. Android Studio<br />2. Python (command line)<br />3. Minimal ADB and fastboot. <br /><br />I have also done the following:<br />1. Downloaded the USB drivers (within Android studio and zip file) <br />2. Started in bootloader mode (power button and volume down)<br /><br />So here are my main questions:<br />1. If you don&#39;t have USB debugging turned ahead of time and you&#39;re trying to communicate to the phone via USB how do you make that happen? Am I assuming too much why saying communicating via USB? <br />2. What tools are used to run the Python scripts on the android phone? <br />3. What makes that handshake happen without previously setting something up on the phone? <br /><br />I&#39;m pretty lost and I swear I&#39;ve given it my best, but the knowledge gap is huge, just trying to learn. Throw a dog a bone! Thanks! Please help. :) <br /> <br /><br /></p><span id='bc_0_55MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1496786157'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=2009347919869559340'>Delete</a></span></span></div><div id='bc_0_55BR' class='comment-replies'></div><div id='bc_0_55B_box' class='comment-replybox-single'></div></li><li id='bc_0_57B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh4.googleusercontent.com/-JGEwNJ-8Lak/AAAAAAAAAAI/AAAAAAAAAFc/do2Zaz8-vmk/s35-c/photo.jpg'></img></div><div id='c8855917887345931689' class='comment-block'><div id='bc_0_57M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/01466040431775523017'>Maxime Jourdan</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1477536485482#c8855917887345931689'>27/10/2016, 05:48</a></span></div><p id='bc_0_57MC' class='comment-content'>Hi laginimaineb, what a great article !<br /><br />I&#39;ve compiled your sources from github and executed them on my Moto G LTE (MSM 8x26), and obviously it didn&#39;t work from the get go.<br /><br />I&#39;ve first had to change the path to the firmware files (no biggie), but now I think I need deeper changes, such as the start address of the secure region, and probably many other constants..<br /><br />Would you mind explaining how you deducted what the secure app region start address was on shamu ? I would like to apply that process to find the start address on my phone.<br /><br />Thanks!<br /></p><span id='bc_0_57MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1643073213'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=8855917887345931689'>Delete</a></span></span></div><div id='bc_0_57BR' class='comment-replies'><span id='bc_0_57b+seedB6uJD' kind='d'><div id='bc_0_56T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_56TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_56TA' class='thread-arrow'></span><span id='bc_0_56TN' class='thread-count'><span id='bc_0_56TNT' style='display: none;'></span><span id='bc_0_56TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_56TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_56TC' class='thread-chrome thread-expanded'><div><li id='bc_0_56B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c6786798181683600407' class='comment-block'><div id='bc_0_56M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1483376227043#c6786798181683600407'>02/01/2017, 18:57</a></span></div><p id='bc_0_56MC' class='comment-content'>Hi Maxime,<br /><br />Thank you for the kind words. You can find the start address of the secapp region by inspecting the dmesg output - the region is a part of the kernel dtb, and its address is printed when the device boots.<br /><br />All the best,<br />Gal.</p><span id='bc_0_56MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=6786798181683600407'>Delete</a></span></span></div><div id='bc_0_56BR' class='comment-replies'></div><div id='bc_0_56B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_56I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_56T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_57B_box' class='comment-replybox-single'></div></li><li id='bc_0_59B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c5365896378821373782' class='comment-block'><div id='bc_0_59M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/13817919605757672826'>kingson</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1482296810814#c5365896378821373782'>21/12/2016, 07:06</a></span></div><p id='bc_0_59MC' class='comment-content'>hi&#65292;laginimaineb&#65292;There is one thing which I don&#39;t quite understand&#65292;how do you know that In Apple&#39;s case you can&#39;t extract the hardware key no matter what software attack you carry out (w/ the OEMs or without). I don&#39;t think the use shk is the key point.if the the encryption scheme&#65288;kemaster&#65289;implemented with software that possibly can be hacked,you are still to get the shk.There is no evidence to prove the encryption scheme&#65288;kemaster&#65289; in ios run in a isolate hardware different from the implemention of tee in arm.</p><span id='bc_0_59MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1624108397'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=5365896378821373782'>Delete</a></span></span></div><div id='bc_0_59BR' class='comment-replies'><span id='bc_0_59b+seedB6uID' kind='d'><div id='bc_0_58T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_58TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_58TA' class='thread-arrow'></span><span id='bc_0_58TN' class='thread-count'><span id='bc_0_58TNT' style='display: none;'></span><span id='bc_0_58TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_58TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_58TC' class='thread-chrome thread-expanded'><div><li id='bc_0_58B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c1489326723981469384' class='comment-block'><div id='bc_0_58M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1483376086295#c1489326723981469384'>02/01/2017, 18:54</a></span></div><p id='bc_0_58MC' class='comment-content'>Hi Kingston,<br /><br />Thank you for reading!<br /><br />Regarding the UID key - Apple claims in the iOS security guide that it is implemented in HW and cannot be accessed via SW or FW in any way. IIRC, Comex has also verified this by inspecting the AES engine.<br /><br />As for the SHK - that key is implemented as part of the crypto engine. As the engine&#39;s inner working are completely opaque, it&#39;s hard to say whether or not it can be extracted by a SW attack. To the best of my knowledge, this should not be possible.<br /><br />All the best,<br />Gal.</p><span id='bc_0_58MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=1489326723981469384'>Delete</a></span></span></div><div id='bc_0_58BR' class='comment-replies'></div><div id='bc_0_58B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_58I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_58T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_59B_box' class='comment-replybox-single'></div></li><li id='bc_0_60B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c5487678922176415947' class='comment-block'><div id='bc_0_60M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/08484840529807605282'>thayyil abhi</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1485119388175#c5487678922176415947'>22/01/2017, 23:09</a></span></div><p id='bc_0_60MC' class='comment-content'>Hi gal greetings from kerala<br /><br />Your the man came to break oem closed wall.we can now enter another world.<br /><br />   I had been trying to decrypt and reflash modem and wifi firmwire.<br /><br />But stucked because qcom encryption.<br /><br />How i apply your exploit.<br /><br /><br /><br /></p><span id='bc_0_60MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1999604216'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=5487678922176415947'>Delete</a></span></span></div><div id='bc_0_60BR' class='comment-replies'></div><div id='bc_0_60B_box' class='comment-replybox-single'></div></li><li id='bc_0_62B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c6231510109471167207' class='comment-block'><div id='bc_0_62M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/14718264764584209377'>Chris</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1486646229077#c6231510109471167207'>09/02/2017, 15:17</a></span></div><p id='bc_0_62MC' class='comment-content'>Hi, Congrats for your work.<br /><br />Just one simple question, the key inside the crypto engine is the same for all devices? If yes, and taking into account the two strings are hardcoded, this will mean that all devices will generate the same Master key?<br /><br />Chris</p><span id='bc_0_62MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-39349995'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=6231510109471167207'>Delete</a></span></span></div><div id='bc_0_62BR' class='comment-replies'><span id='bc_0_62b+seedB6uMD' kind='d'><div id='bc_0_61T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_61TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_61TA' class='thread-arrow'></span><span id='bc_0_61TN' class='thread-count'><span id='bc_0_61TNT' style='display: none;'></span><span id='bc_0_61TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_61TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_61TC' class='thread-chrome thread-expanded'><div><li id='bc_0_61B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c8536421934191064804' class='comment-block'><div id='bc_0_61M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1486656442165#c8536421934191064804'>09/02/2017, 18:07</a></span></div><p id='bc_0_61MC' class='comment-content'>Thank you! The SHK is unique per device, so no two devices should generate the same master key (w.h.p).</p><span id='bc_0_61MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=8536421934191064804'>Delete</a></span></span></div><div id='bc_0_61BR' class='comment-replies'></div><div id='bc_0_61B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_61I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_61T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_62B_box' class='comment-replybox-single'></div></li><li id='bc_0_64B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c8237621152290860920' class='comment-block'><div id='bc_0_64M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/02937694470430285718'><a href="http://www.auresumereviews.com/" rel="nofollow">auresumereviews.com</a></a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1487105089388#c8237621152290860920'>14/02/2017, 22:44</a></span></div><p id='bc_0_64MC' class='comment-content'>What about encryption? and is it that easy to break into any cell phone? don&#39;t you think this will encourage people to snatch and break into the phone and sale it?.</p><span id='bc_0_64MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-205881921'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=8237621152290860920'>Delete</a></span></span></div><div id='bc_0_64BR' class='comment-replies'><span id='bc_0_64b+seedB6uOD' kind='d'><div id='bc_0_63T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_63TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_63TA' class='thread-arrow'></span><span id='bc_0_63TN' class='thread-count'><span id='bc_0_63TNT' style='display: none;'></span><span id='bc_0_63TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_63TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_63TC' class='thread-chrome thread-expanded'><div><li id='bc_0_63B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c920002122688327734' class='comment-block'><div id='bc_0_63M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1487443904047#c920002122688327734'>18/02/2017, 20:51</a></span></div><p id='bc_0_63MC' class='comment-content'>What about encryption? I&#39;m not sure what you mean. As for the second point - on the contrary, I believe finding and fixing vulnerabilities is important to help keep devices secure.</p><span id='bc_0_63MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=920002122688327734'>Delete</a></span></span></div><div id='bc_0_63BR' class='comment-replies'></div><div id='bc_0_63B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_63I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_63T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_64B_box' class='comment-replybox-single'></div></li><li id='bc_0_70B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c4616184270459778115' class='comment-block'><div id='bc_0_70M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/18126006082885571330'>Karthik k</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1488297470505#c4616184270459778115'>28/02/2017, 17:57</a></span></div><p id='bc_0_70MC' class='comment-content'>Hi laginimaineb,<br /><br />could please explain how to extract footer.bin (crypto footer) for Nexus 6 device?<br /><br />ls -al /dev/block/platform/msm_sdcc.1/by-name/<br />   - keystore -&gt; /dev/block/mmcblk0p24<br /><br />Should I just copy this partition as it is?<br /><br />Thank you</p><span id='bc_0_70MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-22887734'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=4616184270459778115'>Delete</a></span></span></div><div id='bc_0_70BR' class='comment-replies'><span id='bc_0_70b+seedB6uQD' kind='d'><div id='bc_0_65T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_65TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_65TA' class='thread-arrow'></span><span id='bc_0_65TN' class='thread-count'><span id='bc_0_65TNT' style='display: none;'></span><span id='bc_0_65TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_65TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_65TC' class='thread-chrome thread-expanded'><div><li id='bc_0_65B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c819366530903306865' class='comment-block'><div id='bc_0_65M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1488473453053#c819366530903306865'>02/03/2017, 18:50</a></span></div><p id='bc_0_65MC' class='comment-content'>Hi Karthik,<br /><br />Yes, it&#39;s stored in one of the partitions on the Nexus 6, but unfortunately I can&#39;t remember which... If you can dump the ls output for by-name here, I&#39;ll tell you which it is.<br /><br />Gal.</p><span id='bc_0_65MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=819366530903306865'>Delete</a></span></span></div><div id='bc_0_65BR' class='comment-replies'></div><div id='bc_0_65B_box' class='comment-replybox-single'></div></li><li id='bc_0_66B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c1745422176919213593' class='comment-block'><div id='bc_0_66M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/18126006082885571330'>Karthik k</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1488723253607#c1745422176919213593'>05/03/2017, 16:14</a></span></div><p id='bc_0_66MC' class='comment-content'>Hi laginimaineb, <br /><br />Thanks again for the reply. I figured out /dev/block/platform/msm_sdcc.1/by-name/metadata is the crypto footer partition for Nexus 6.<br /><br />I have another question, could you please help me with this? <br /><br />I flashed the vulnerable firmware image, and leaked the Encryption key and HMAC key using your exploit. Now I am testing whether it is possible to brutefore pin of a patched Android version say Android 6. <br /><br />1. So I flashed the Android 6 to my device<br />2. set a new password.<br />3. extracted the crypto footer from it<br /><br />Then I was trying to bruteforce the password of Android version 6 using your script, but it failed.<br /><br />1. First it threw invalid HMAC mismatch! error<br />    -&gt; Reason for this could be that this version of firmware is using a different HMAC key? correct?<br /><br />I anyway ignored the HMAC validation part. <br /><br />2. Then it threw &quot;invalid encryption key&quot; error. <br />   -&gt; Does this mean this version of firmware is using a different encryption key? From your blog I understood that the hardware keys cannot be changed; however, they might have changed the salt used to create the master from hardware key for this version? Making it to impossible to bruteforce pin for a patched version? This is a valid patch from Google, correct?<br /><br />Now we need to either find a new trustzone kernel vuln to leak the encryption key for latest firmware version. Reversing the Keymaster trustlet and figuring out the new encryption key used for a new version is not possible, right?  <br /><br />Thanks again</p><span id='bc_0_66MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-22887734'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=1745422176919213593'>Delete</a></span></span></div><div id='bc_0_66BR' class='comment-replies'></div><div id='bc_0_66B_box' class='comment-replybox-single'></div></li><li id='bc_0_67B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c7495006173707630726' class='comment-block'><div id='bc_0_67M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1489259902829#c7495006173707630726'>11/03/2017, 21:18</a></span></div><p id='bc_0_67MC' class='comment-content'>Hi Karthik,<br /><br />Yes, you&#39;re right that it&#39;s the &quot;metadata&quot; partition, I forgot about that.<br /><br />I think the reason you&#39;re seeing errors is *not* that the key is somehow changed (remember, the SHK is *constant*), but rather that the format of the KeyMaster keyblob may be different in the newer versions. Remember that what I demonstrated was for KeyMaster version 1, which was what was used at the time. I believe the format used in newer versions is slightly different.<br /><br />Here&#39;s what I suggest: take the key-blob and output the second DWORD (version_num), and post that value here. Then we could see whether it&#39;s just a matter of adding support in the script itself, or whether the KDF in the KeyMaster TA has been changed in newer versions.<br /><br />All the best,<br />Gal.</p><span id='bc_0_67MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=7495006173707630726'>Delete</a></span></span></div><div id='bc_0_67BR' class='comment-replies'></div><div id='bc_0_67B_box' class='comment-replybox-single'></div></li><li id='bc_0_68B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c7142259454261294274' class='comment-block'><div id='bc_0_68M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/18126006082885571330'>Karthik k</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1489332722739#c7142259454261294274'>12/03/2017, 17:32</a></span></div><p id='bc_0_68MC' class='comment-content'>Hi laginimaineb,<br /><br /><br />(Pdb) print keyblob<br />{&#39;version_num&#39;: 0, &#39;encrypted_private_exponent&#39;: &quot;\x1d2\x13O\x98\n`Y\...<br /><br />It says, key blob version is &#39;0&#39;. Here is the complete output. https://gist.github.com/anonymous/561e6c94bc565f56c48b5b57cc0e684e<br /><br />Also, I see keyblob version as &#39;0&#39; (same) in the vulnerable version (Android 5.1). But private key exponent size is huge for Android version 6. Gist for vulnerable version of Android is here https://gist.github.com/anonymous/b7d11bb76b95a5f03e482ad55dadd039.<br /><br />Yes, I understand SHK is constant, but here we are using KEK. So, KEK might have changed for the newer version of Firmware, right? May be they might have just changed  two hardcoded strings used to generate KEK from SHK. <br /><br />KEK is here https://gist.github.com/anonymous/44dbe8882693df0accacbb7204711e8e<br /><br />Here is the metadata partition for Android 6, if you would like to have a look at it.<br />https://dropfile.to/6YWWg15 accesskey:bAGpDKG <br /><br />Thank you,<br />Karthik</p><span id='bc_0_68MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-22887734'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=7142259454261294274'>Delete</a></span></span></div><div id='bc_0_68BR' class='comment-replies'></div><div id='bc_0_68B_box' class='comment-replybox-single'></div></li><li id='bc_0_69B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c8153010807281157292' class='comment-block'><div id='bc_0_69M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1489695460331#c8153010807281157292'>16/03/2017, 22:17</a></span></div><p id='bc_0_69MC' class='comment-content'>Hi Karthik,<br /><br />Yes, these are all valid options. My initial thought was that the keyblob format must have changed. Anyway, I looked at the trustlet in the newer version, it seems to use the same hardcoded strings, so unless something around the key derivation changed, this is rather strange.<br /><br />I tried to download the metadata partition in the link you sent, but it already expired. Could you send it over again? I&#39;ll take a look.<br /><br />Thanks,<br />Gal.</p><span id='bc_0_69MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=8153010807281157292'>Delete</a></span></span></div><div id='bc_0_69BR' class='comment-replies'></div><div id='bc_0_69B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_65I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_65T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_70B_box' class='comment-replybox-single'></div></li><li id='bc_0_74B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c1945434757639676396' class='comment-block'><div id='bc_0_74M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/17768758405050233161'>Unknown</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1491087860871#c1945434757639676396'>02/04/2017, 02:04</a></span></div><p id='bc_0_74MC' class='comment-content'>Hi laginimaineb,<br /><br />This is an incredibly informative article and I admire the effort you&#39;ve put in to find this exploit. I&#39;m trying to execute it on a Nexus 6P running Marshmallow (specifically 6.0 security patch level Nov 1, 2015). I&#39;ve compiled your code and have it running on a rooted device. However, it seems to be failing to find the widevine application in the secure memory region. I&#39;ve modified the start address of the secure memory region per my dmesg output:<br /><br />adb shell dmesg | grep secure<br />[    0.000000] cma: Found secure_region@0, memory base 0x0000000000000000, size 300 MiB, limit 0xffffffffffffffff<br />[    0.000000] cma: CMA: reserved 300 MiB at 0x00000000cd400000 for secure_mem<br /><br />Here&#39;s the output of the execution:<br />/data/local/tmp/extract_keymaster<br />[+] Widevine load res: 0<br />[+] Keymaster load res: 0<br />[+] Trying to probe 0xCD42D000<br />[+] Didn&#39;t crash, starting to scan linearly<br />[+] Scanning page CD42D000 for sync pattern<br />[-] Unknown deriviation result: 29, aborting!<br />[+] Crashed in linear scan, jumping ahead<br />...<br />[+] Trying to probe 0xDF1FF000<br />[+] Didn&#39;t crash, starting to scan linearly<br />[+] Scanning page DF1FF000 for sync pattern<br />[-] Unknown deriviation result: 29, aborting!<br />[+] Crashed in linear scan, jumping ahead<br />[-] Failed to find application<br /><br />Here is my git diff as well:<br /><br />git diff<br />diff --git a/jni/Application.mk b/jni/Application.mk<br />index 4337f7c..f01ebf5 100644<br />--- a/jni/Application.mk<br />+++ b/jni/Application.mk<br />@@ -1 +1,2 @@<br /> APP_PLATFORM := android-16<br />+APP_ABI := armeabi #arm64-v8a<br />diff --git a/jni/defs.h b/jni/defs.h<br />index 3900bed..8afe874 100644<br />--- a/jni/defs.h<br />+++ b/jni/defs.h<br />@@ -14,12 +14,12 @@<br /> /**<br />  * The path to the widevine application<br />  */<br />-#define WIDEVINE_PATH (&quot;/vendor/firmware&quot;)<br />+#define WIDEVINE_PATH (&quot;/system/vendor/firmware&quot;)<br /><br /> /**<br />  * The path to the keymaster application.<br />  */<br />-#define KEYMASTER_PATH (&quot;/vendor/firmware/keymaster&quot;)<br />+#define KEYMASTER_PATH (&quot;/dev/block/mmcblk0p24&quot;) ///vendor/firmware/keymaster<br /><br /> /**<br />  * The name of the widevine application<br />diff --git a/jni/symbols.h b/jni/symbols.h<br />index 2f3769b..673b3f4 100644<br />--- a/jni/symbols.h<br />+++ b/jni/symbols.h<br />@@ -14,12 +14,12 @@<br /> /**<br />  * The start address of the secure app region (on shamu)<br />  */<br />-#define SECURE_APP_REGION_START (0xD600000)<br />+#define SECURE_APP_REGION_START (0xcd400000)<br /><br /> /**<br />  * The size of the secure app region<br />  */<br />-#define SECURE_APP_REGION_SIZE (0x500000)<br />+#define SECURE_APP_REGION_SIZE (0x11E1A300) // (0x500000)<br /><br />It looks like the scan just can&#39;t find where it&#39;s located in the secure memory region? Am I missing other values I should modify? Is the Nexus 6P being 64bit perhaps causing issues? Would really appreciate some help on this.<br /><br />Thanks</p><span id='bc_0_74MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-269233671'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=1945434757639676396'>Delete</a></span></span></div><div id='bc_0_74BR' class='comment-replies'><span id='bc_0_74b+seedB6uXD' kind='d'><div id='bc_0_71T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_71TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_71TA' class='thread-arrow'></span><span id='bc_0_71TN' class='thread-count'><span id='bc_0_71TNT' style='display: none;'></span><span id='bc_0_71TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_71TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_71TC' class='thread-chrome thread-expanded'><div><li id='bc_0_71B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c7745830541308941192' class='comment-block'><div id='bc_0_71M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1497815874870#c7745830541308941192'>18/06/2017, 22:57</a></span></div><p id='bc_0_71MC' class='comment-content'>Hi,<br /><br />Have you checked whether the Widevine trustlet on the Nexus 6P is vulnerable to the PRDiag vulnerability? If I recall correctly, the affected code was removed from the trustlet that shipped on the Nexus 6P.<br /><br />All the best,<br />Gal.</p><span id='bc_0_71MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=7745830541308941192'>Delete</a></span></span></div><div id='bc_0_71BR' class='comment-replies'></div><div id='bc_0_71B_box' class='comment-replybox-single'></div></li><li id='bc_0_72B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c5406165508474166476' class='comment-block'><div id='bc_0_72M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/05870681509316487664'>Josh Cowan</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1512533085199#c5406165508474166476'>06/12/2017, 06:04</a></span></div><p id='bc_0_72MC' class='comment-content'><span class='deleted-comment'>This comment has been removed by the author.</span></p><span id='bc_0_72MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin '><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=5406165508474166476'>Delete</a></span></span></div><div id='bc_0_72BR' class='comment-replies'></div><div id='bc_0_72B_box' class='comment-replybox-single'></div></li><li id='bc_0_73B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c6689970706959498264' class='comment-block'><div id='bc_0_73M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/17768758405050233161'>Unknown</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1512533677659#c6689970706959498264'>06/12/2017, 06:14</a></span></div><p id='bc_0_73MC' class='comment-content'>I tried using &quot;grep -r PRDiag /&quot; and it didn&#39;t work so I believe this won&#39;t work on a nexus 6P</p><span id='bc_0_73MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-269233671'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=6689970706959498264'>Delete</a></span></span></div><div id='bc_0_73BR' class='comment-replies'></div><div id='bc_0_73B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_71I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_71T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_74B_box' class='comment-replybox-single'></div></li><li id='bc_0_75B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c7489604684026705976' class='comment-block'><div id='bc_0_75M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/03999668448432084460'>jimmydo</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1491958570881#c7489604684026705976'>12/04/2017, 03:56</a></span></div><p id='bc_0_75MC' class='comment-content'>Hello,<br />when I encrypt my phone using a patched Android version, is the encrpytion still vulnerable for a downgrade attack by flashing to a vulnerable Android version? Then all these Qualcomm CPU&#180;s would be vulnerable forever....</p><span id='bc_0_75MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1120927031'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=7489604684026705976'>Delete</a></span></span></div><div id='bc_0_75BR' class='comment-replies'></div><div id='bc_0_75B_box' class='comment-replybox-single'></div></li><li id='bc_0_77B' class='comment' kind='b'><div class='avatar-image-container'><img src='//lh3.googleusercontent.com/zFdxGE77vvD2w5xHy6jkVuElKv-U9_9qLkRYK8OnbDeJPtjSZ82UPq5w6hJ-SA=s35'></img></div><div id='c6561628012932100659' class='comment-block'><div id='bc_0_77M' class='comment-header' kind='m'><cite class='user'><a rel='nofollow' href='https://www.blogger.com/profile/13726103556438574778'>Anirban</a></cite><span class='icon user'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1507564225476#c6561628012932100659'>09/10/2017, 18:50</a></span></div><p id='bc_0_77MC' class='comment-content'>Hi, <br />   What happens if the motherboard of the phone is replaced. Will this approach work?</p><span id='bc_0_77MN' class='comment-actions secondary-text' kind='m'><a kind='i' href='javascript:;' target='_self' o='r'>Reply</a><span class='item-control blog-admin pid-1408150783'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=6561628012932100659'>Delete</a></span></span></div><div id='bc_0_77BR' class='comment-replies'><span id='bc_0_77b+seedB6uZD' kind='d'><div id='bc_0_76T' class='comment-thread inline-thread' kind='t'   t='0' u='0'><span id='bc_0_76TT' class='thread-toggle thread-expanded' kind='g'><span id='bc_0_76TA' class='thread-arrow'></span><span id='bc_0_76TN' class='thread-count'><span id='bc_0_76TNT' style='display: none;'></span><span id='bc_0_76TNU' style='display: none;'></span><a href='javascript:;' target='_self'>Replies</a><div id='bc_0_76TD' class='thread-dropContainer thread-expanded'><span class='thread-drop'></span></div></span></span><ol id='bc_0_76TC' class='thread-chrome thread-expanded'><div><li id='bc_0_76B' class='comment' kind='b'><div class='avatar-image-container'><img src='//3.bp.blogspot.com/-l6dnDFetIWg/VEq81MZW-KI/AAAAAAAABnE/RD4xgUI2Ftc/s35/hedge2.jpg'></img></div><div id='c6425101334167561716' class='comment-block'><div id='bc_0_76M' class='comment-header' kind='m'><cite class='user blog-author'><a rel='nofollow' href='https://www.blogger.com/profile/00867710965331025912'>laginimaineb</a></cite><span class='icon user blog-author'></span><span class='datetime secondary-text'><a rel='nofollow' href='https://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html?showComment=1507564415683#c6425101334167561716'>09/10/2017, 18:53</a></span></div><p id='bc_0_76MC' class='comment-content'>Hi,<br /><br />I would imagine that replacing the SoC would imply replacing the hardware fuses as well, so the SHK would be different (therefore the approach would not work, as the KDF is bound to the SHK).<br /><br />All the best,<br />Gal.</p><span id='bc_0_76MN' class='comment-actions secondary-text' kind='m'><span class='item-control blog-admin pid-1869888142'><a o='d' target='_self' href='https://www.blogger.com/delete-comment.g?blogID=2029700426505953971&amp;postID=6425101334167561716'>Delete</a></span></span></div><div id='bc_0_76BR' class='comment-replies'></div><div id='bc_0_76B_box' class='comment-replybox-single'></div></li></div><div id='bc_0_76I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Reply</a></div></ol><div id='bc_0_76T_box' class='comment-replybox-thread'></div></div></span></div><div id='bc_0_77B_box' class='comment-replybox-single'></div></li></ol><div id='bc_0_78I' class='continue' kind='ci'><a href='javascript:;' target='_self'>Add comment</a></div><div id='bc_0_78T_box' class='comment-replybox-thread'></div><div id='bc_0_78L' class='loadmore loaded' kind='rb'><a href='javascript:;' target='_self'>Load more...</a></div></div></div></div>
</div>
</div>
<p class='comment-footer'>
<div class='comment-form'>
<a name='comment-form'></a>
<p>
</p>
<a href='https://www.blogger.com/comment-iframe.g?blogID=2029700426505953971&postID=4923895734931327947' id='comment-editor-src'></a>
<iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' frameborder='0' height='410px' id='comment-editor' name='comment-editor' src='' width='100%'></iframe>
<script src='https://www.blogger.com/static/v1/jsbin/2244480862-comment_from_post_iframe.js' type='text/javascript'></script>
<script type='text/javascript'>
      BLOG_CMT_createIframe('https://www.blogger.com/rpc_relay.html');
    </script>
</div>
</p>
<div id='backlinks-container'>
<div id='Blog1_backlinks-container'>
</div>
</div>
</div>
</div>

        </div></div>
      
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='https://bits-please.blogspot.it/2016/06/trustzone-kernel-privilege-escalation.html' id='Blog1_blog-pager-older-link' title='Older Post'>Older Post</a>
</span>
<a class='home-link' href='https://bits-please.blogspot.it/'>Home</a>
</div>
<div class='clear'></div>
<div class='post-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='https://bits-please.blogspot.com/feeds/4923895734931327947/comments/default' target='_blank' type='application/atom+xml'>Post Comments (Atom)</a>
</div>
</div>
<script type='text/javascript'>
    window.___gcfg = { 'lang': 'en-GB' };
  </script>
</div></div>
</div>
</div>
<div class='column-left-outer'>
<div class='column-left-inner'>
<aside>
</aside>
</div>
</div>
<div class='column-right-outer'>
<div class='column-right-inner'>
<aside>
</aside>
</div>
</div>
</div>
<div style='clear: both'></div>
<!-- columns -->
</div>
<!-- main -->
</div>
</div>
<div class='main-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<footer>
<div class='footer-outer'>
<div class='footer-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left footer-fauxborder-left'>
<div class='fauxborder-right footer-fauxborder-right'></div>
<div class='region-inner footer-inner'>
<div class='foot section' id='footer-1'><div class='widget Profile' data-version='1' id='Profile1'>
<h2>About Me</h2>
<div class='widget-content'>
<a href='https://www.blogger.com/profile/00867710965331025912'><img alt='My photo' class='profile-img' height='80' src='//3.bp.blogspot.com/-qf1mmrRg93g/VEq8YMFevXI/AAAAAAAABmg/eQCfldgcjPo/s80/hedge2.jpg' width='79'/></a>
<dl class='profile-datablock'>
<dt class='profile-data'>
<a class='profile-name-link g-profile' href='https://www.blogger.com/profile/00867710965331025912' rel='author' style='background-image: url(//www.blogger.com/img/logo-16.png);'>
laginimaineb
</a>
</dt>
</dl>
<a class='profile-link' href='https://www.blogger.com/profile/00867710965331025912' rel='author'>View my complete profile</a>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=2029700426505953971&widgetType=Profile&widgetId=Profile1&action=editWidget&sectionId=footer-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("Profile1"));' target='configProfile1' title='Edit'>
<img alt='' height='18' src='https://resources.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div>
</div></div>
<table border='0' cellpadding='0' cellspacing='0' class='section-columns columns-2'>
<tbody>
<tr>
<td class='first columns-cell'>
<div class='foot section' id='footer-2-1'><div class='widget BlogArchive' data-version='1' id='BlogArchive1'>
<h2>Blog Archive</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://bits-please.blogspot.it/2016/'>
2016
</a>
<span class='post-count' dir='ltr'>(7)</span>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://bits-please.blogspot.it/2016/06/'>
June
</a>
<span class='post-count' dir='ltr'>(2)</span>
<ul class='posts'>
<li><a href='https://bits-please.blogspot.it/2016/06/extracting-qualcomms-keymaster-keys.html'>Extracting Qualcomm&#39;s KeyMaster Keys - Breaking An...</a></li>
<li><a href='https://bits-please.blogspot.it/2016/06/trustzone-kernel-privilege-escalation.html'>TrustZone Kernel Privilege Escalation (CVE-2016-24...</a></li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://bits-please.blogspot.it/2016/05/'>
May
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://bits-please.blogspot.it/2016/04/'>
April
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://bits-please.blogspot.it/2016/02/'>
February
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://bits-please.blogspot.it/2016/01/'>
January
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://bits-please.blogspot.it/2015/'>
2015
</a>
<span class='post-count' dir='ltr'>(6)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://bits-please.blogspot.it/2015/08/'>
August
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://bits-please.blogspot.it/2015/03/'>
March
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://bits-please.blogspot.it/2014/'>
2014
</a>
<span class='post-count' dir='ltr'>(1)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://bits-please.blogspot.it/2014/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=2029700426505953971&widgetType=BlogArchive&widgetId=BlogArchive1&action=editWidget&sectionId=footer-2-1' onclick='return _WidgetManager._PopupConfig(document.getElementById("BlogArchive1"));' target='configBlogArchive1' title='Edit'>
<img alt='' height='18' src='https://resources.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div>
</div></div>
</td>
<td class='columns-cell'>
<div class='foot no-items section' id='footer-2-2'></div>
</td>
</tr>
</tbody>
</table>
<!-- outside of the include in order to lock Attribution widget -->
<div class='foot section' id='footer-3' name='Footer'><div class='widget Attribution' data-version='1' id='Attribution1'>
<div class='widget-content' style='text-align: center;'>
Picture Window theme. Powered by <a href='https://www.blogger.com' target='_blank'>Blogger</a>.
</div>
<div class='clear'></div>
<span class='widget-item-control'>
<span class='item-control blog-admin'>
<a class='quickedit' href='//www.blogger.com/rearrange?blogID=2029700426505953971&widgetType=Attribution&widgetId=Attribution1&action=editWidget&sectionId=footer-3' onclick='return _WidgetManager._PopupConfig(document.getElementById("Attribution1"));' target='configAttribution1' title='Edit'>
<img alt='' height='18' src='https://resources.blogblog.com/img/icon18_wrench_allbkg.png' width='18'/>
</a>
</span>
</span>
<div class='clear'></div>
</div></div>
</div>
</div>
<div class='footer-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</footer>
<!-- content -->
</div>
</div>
<div class='content-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<script type='text/javascript'>
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>
<script src='https://apis.google.com/js/plusone.js' type='text/javascript'></script>
<!--\u60a8\u6709\u8d23\u4efb\u901a\u77e5\u8bbf\u95ee\u8005\u60a8\u5728\u535a\u5ba2\u4e0a\u4f7f\u7528\u7684 Cookie\u3002\u8bf7\u53c2\u9605 http://www.blogger.com/go/cookiechoices \u4e86\u89e3\u8be6\u60c5\u3002-->
<script defer='' src='/js/cookiechoices.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function(event) {
      window.cookieChoices && cookieChoices.showCookieConsentBar && cookieChoices.showCookieConsentBar(
          (window.cookieOptions && cookieOptions.msg) || '\u6b64\u7f51\u7ad9\u501f\u52a9 Google \u7684 Cookie \u6765\u63d0\u4f9b\u670d\u52a1\u3001\u5236\u4f5c\u4e2a\u6027\u5316\u5e7f\u544a\u548c\u5206\u6790\u6d41\u91cf\uff0c\u5e76\u4e0e Google \u5206\u4eab\u6709\u5173\u60a8\u5982\u4f55\u4f7f\u7528\u6b64\u7f51\u7ad9\u7684\u4fe1\u606f\u3002\u4f7f\u7528\u6b64\u7f51\u7ad9\u5373\u8868\u793a\u60a8\u540c\u610f\u6211\u4eec\u4f7f\u7528 Cookie\u3002',
          (window.cookieOptions && cookieOptions.close) || '\u660e\u767d\u4e86',
          (window.cookieOptions && cookieOptions.learn) || '\u4e86\u89e3\u8be6\u7ec6\u4fe1\u606f',
          (window.cookieOptions && cookieOptions.link) || 'https://www.blogger.com/go/blogspot-cookies');
    });
  </script>

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/3953819307-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY4sV4hx2qd7p_ZHYfNOADQN2HD-WQ:1518050609725';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d2029700426505953971','//bits-please.blogspot.it/2016/06/extracting-qualcomms-keymaster-keys.html','2029700426505953971');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '2029700426505953971', 'title': 'Bits, Please!', 'url': 'https://bits-please.blogspot.it/2016/06/extracting-qualcomms-keymaster-keys.html', 'canonicalUrl': 'http://bits-please.blogspot.com/2016/06/extracting-qualcomms-keymaster-keys.html', 'homepageUrl': 'https://bits-please.blogspot.it/', 'searchUrl': 'https://bits-please.blogspot.it/search', 'canonicalHomepageUrl': 'http://bits-please.blogspot.com/', 'blogspotFaviconUrl': 'https://bits-please.blogspot.it/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': false, 'httpsEnabled': true, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': '', 'encoding': 'UTF-8', 'locale': 'en-GB', 'localeUnderscoreDelimited': 'en_gb', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Bits, Please! - Atom\x22 href\x3d\x22https://bits-please.blogspot.com/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22Bits, Please! - RSS\x22 href\x3d\x22https://bits-please.blogspot.com/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Bits, Please! - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/2029700426505953971/posts/default\x22 /\x3e\n\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Bits, Please! - Atom\x22 href\x3d\x22https://bits-please.blogspot.com/feeds/4923895734931327947/comments/default\x22 /\x3e\n', 'meTag': '', 'openIdOpTag': '', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': false, 'ieCssRetrofitLinks': '\x3c!--[if IE]\x3e\x3cscript type\x3d\x22text/javascript\x22 src\x3d\x22https://www.blogger.com/static/v1/jsbin/3061962209-ieretrofit.js\x22\x3e\x3c/script\x3e\n\x3c![endif]--\x3e', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/2c0662265d8e8627', 'plusOneApiSrc': 'https://apis.google.com/js/plusone.js', 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'Twitter', 'key': 'twitter', 'shareMessage': 'Share to Twitter', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Google+', 'key': 'googlePlus', 'shareMessage': 'Share to Google+', 'target': 'googleplus'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'googlePlusShareButtonWidth': 300, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en_GB\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'item', 'postId': '4923895734931327947', 'postImageThumbnailUrl': 'https://3.bp.blogspot.com/-lDwYrS4KH4Y/V2R6l3cEkxI/AAAAAAAAEDY/wdtH87j5vtgxeFzGIVi81iIh0xFgUEx4QCLcB/s72-c/Screenshot%2Bfrom%2B2016-06-18%2B01%253A29%253A24.png', 'postImageUrl': 'https://3.bp.blogspot.com/-lDwYrS4KH4Y/V2R6l3cEkxI/AAAAAAAAEDY/wdtH87j5vtgxeFzGIVi81iIh0xFgUEx4QCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B01%253A29%253A24.png', 'pageName': 'Extracting Qualcomm\x27s KeyMaster Keys - Breaking Android Full Disk Encryption', 'pageTitle': 'Bits, Please!: Extracting Qualcomm\x27s KeyMaster Keys - Breaking Android Full Disk Encryption', 'metaDescription': ''}}, {'name': 'features', 'data': {'lazy_images': 'false', 'unsupported_browser_message': 'false', 'sharing_get_link_dialog': 'true', 'sharing_native': 'false'}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard', 'ok': 'Ok', 'postLink': 'Post link'}}, {'name': 'template', 'data': {'name': 'Picture Window', 'localizedName': 'Picture Window', 'isResponsive': false, 'isAlternateRendering': false, 'isCustom': false, 'variant': 'shade', 'variantId': 'shade'}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'Extracting Qualcomm\x27s KeyMaster Keys - Breaking Android Full Disk Encryption', 'description': 'A security blog focusing on Android, the Linux Kernel and everything nice.', 'featuredImage': 'https://3.bp.blogspot.com/-lDwYrS4KH4Y/V2R6l3cEkxI/AAAAAAAAEDY/wdtH87j5vtgxeFzGIVi81iIh0xFgUEx4QCLcB/s1600/Screenshot%2Bfrom%2B2016-06-18%2B01%253A29%253A24.png', 'url': 'https://bits-please.blogspot.it/2016/06/extracting-qualcomms-keymaster-keys.html', 'type': 'item', 'isSingleItem': true, 'isMultipleItems': false, 'isError': false, 'isPage': false, 'isPost': true, 'isHomepage': false, 'isArchive': false, 'isLabelSearch': false, 'postId': 4923895734931327947}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', null, document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', null, document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', null, document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'useNgc': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/760749880-lbx__en_gb.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/368954415-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_ProfileView', new _WidgetInfo('Profile1', 'footer-1', null, document.getElementById('Profile1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'footer-2-1', null, document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', null, document.getElementById('Attribution1'), {}, 'displayModeFull'));
</script>
</body>
</html>